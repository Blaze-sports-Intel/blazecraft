{"version":3,"file":"index-D0Moz3tF.js","sources":["../../src/game-state.js","../../src/map.js","../../src/sprites.js","../../src/buildings.js","../../src/renderer.js","../../src/ui-panels.js","../../src/mock-data.js","../../src/commands.js","../../node_modules/three/examples/jsm/controls/OrbitControls.js","../../node_modules/three/examples/jsm/loaders/RGBELoader.js","../../src/lighting-presets.js","../../src/vfx-system.js","../../src/renderer3d.js","../../src/mascot-controller.js","../../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../node_modules/three/examples/jsm/loaders/DRACOLoader.js","../../src/asset-loader.js","../../src/building-3d.js","../../src/worker-3d.js","../../src/real-bridge.js","../../src/faction-system.js","../../src/game-bridge.js","../../src/faction-selector.js","../../src/predictions/types.js","../../src/predictions/odds-engine.js","../../src/predictions/prediction-manager.js","../../src/predictions/prediction-ui.js","../../src/main.js"],"sourcesContent":["/**\n * Minimal state store with pub/sub.\n * @typedef {'idle'|'working'|'moving'|'blocked'|'complete'|'terminated'|'hold'} WorkerStatus\n * @typedef {{x:number,y:number}} Vec2\n * @typedef {{id:string,name:string,status:WorkerStatus,currentTask:string|null,targetRegion:string,position:Vec2,spawnedAt:number,tokensUsed:number,progress:number,errorMessage:string|null,updatedAt:number}} Worker\n * @typedef {'spawn'|'task_start'|'task_complete'|'error'|'terminate'|'command'|'status'|'sports_update'|'sports_final'|'injury'|'highlight'} EventType\n * @typedef {'command'|'production'|'research'|'repair'|'storage'|'defense'|'general'} EventCategory\n * @typedef {{timestamp:number,type:EventType,workerId:string,details:string,category?:EventCategory}} GameEvent\n */\n\nexport class GameState {\n  constructor() {\n    /** @type {Map<string, Worker>} */\n    this.workers = new Map();\n    /** @type {GameEvent[]} */\n    this.events = [];\n    /** @type {Set<string>} */\n    this.selected = new Set();\n\n    this.startedAt = Date.now();\n\n    /** @type {string[]} */\n    this.scout = [\n      'No threats detected.',\n      'Demo mode is generating worker activity.',\n    ];\n\n    this.stats = {\n      completed: 0,\n      files: 0,\n      failed: 0,\n      tokens: 0,\n    };\n\n    // Event-driven building progression counters\n    // Each category maps to specific building types\n    this.eventStats = {\n      spawns: 0,      // townhall - worker rallying\n      commands: 0,    // barracks - military coordination\n      production: 0,  // farm/workshop - resource gathering & crafting\n      research: 0,    // library - analysis & investigation\n      repairs: 0,     // forge - error recovery & fixes\n      storage: 0,     // archive - data management\n      defense: 0,     // tower - monitoring & patrol\n    };\n\n    /** @type {Set<Function>} */\n    this.listeners = new Set();\n  }\n\n  /** @param {number} n */\n  bumpCompleted(n) {\n    this.stats.completed += n;\n    this.notify();\n  }\n\n  /** @param {number} n */\n  bumpFiles(n) {\n    this.stats.files += n;\n    this.notify();\n  }\n\n  /** @param {number} n */\n  bumpFailed(n) {\n    this.stats.failed += n;\n    this.notify();\n  }\n\n  /** @param {string} line */\n  pushScoutLine(line) {\n    // newest first\n    this.scout = [line, ...this.scout].slice(0, 3);\n    this.notify();\n  }\n\n  /** @param {(s:GameState)=>void} fn */\n  subscribe(fn) {\n    this.listeners.add(fn);\n    fn(this);\n    return () => this.listeners.delete(fn);\n  }\n\n  notify() {\n    for (const fn of this.listeners) fn(this);\n  }\n\n  /** @param {GameEvent} evt */\n  pushEvent(evt) {\n    // Track event category for building progression\n    this.trackEventCategory(evt);\n\n    this.events.unshift(evt);\n    if (this.events.length > 250) this.events.length = 250;\n    this.notify();\n  }\n\n  /**\n   * Track event for building progression based on event type and category.\n   * @param {GameEvent} evt\n   */\n  trackEventCategory(evt) {\n    // Map event types and categories to building stats\n    switch (evt.type) {\n      case 'spawn':\n        this.eventStats.spawns++;\n        break;\n      case 'command':\n        this.eventStats.commands++;\n        break;\n      case 'error':\n      case 'injury':\n        // Errors and injuries need repair/attention\n        this.eventStats.repairs++;\n        break;\n      case 'status':\n        // Status updates = monitoring (tower)\n        this.eventStats.defense++;\n        break;\n      case 'sports_update':\n      case 'highlight':\n        // Sports updates and highlights drive production\n        this.eventStats.production++;\n        break;\n      case 'sports_final':\n        // Game finals are command-level events\n        this.eventStats.commands++;\n        break;\n      case 'task_start':\n      case 'task_complete':\n        // Use category if provided, otherwise infer from details\n        if (evt.category) {\n          this.bumpEventCategory(evt.category);\n        } else {\n          // Infer from task details\n          this.inferAndBumpCategory(evt.details);\n        }\n        break;\n    }\n  }\n\n  /**\n   * Bump a specific event category counter.\n   * @param {EventCategory} category\n   */\n  bumpEventCategory(category) {\n    switch (category) {\n      case 'command':\n        this.eventStats.commands++;\n        break;\n      case 'production':\n        this.eventStats.production++;\n        break;\n      case 'research':\n        this.eventStats.research++;\n        break;\n      case 'repair':\n        this.eventStats.repairs++;\n        break;\n      case 'storage':\n        this.eventStats.storage++;\n        break;\n      case 'defense':\n        this.eventStats.defense++;\n        break;\n      default:\n        this.eventStats.production++; // default to production\n    }\n  }\n\n  /**\n   * Infer category from task details and bump the appropriate counter.\n   * @param {string} details\n   */\n  inferAndBumpCategory(details) {\n    const lower = details.toLowerCase();\n\n    if (lower.includes('fix') || lower.includes('bug') || lower.includes('error') || lower.includes('conflict')) {\n      this.eventStats.repairs++;\n    } else if (lower.includes('test') || lower.includes('investigate') || lower.includes('research') || lower.includes('analyze')) {\n      this.eventStats.research++;\n    } else if (lower.includes('refactor') || lower.includes('wire') || lower.includes('add') || lower.includes('component')) {\n      this.eventStats.production++;\n    } else if (lower.includes('extract') || lower.includes('store') || lower.includes('archive') || lower.includes('data')) {\n      this.eventStats.storage++;\n    } else if (lower.includes('monitor') || lower.includes('patrol') || lower.includes('scout') || lower.includes('watch')) {\n      this.eventStats.defense++;\n    } else if (lower.includes('assign') || lower.includes('command') || lower.includes('order')) {\n      this.eventStats.commands++;\n    } else {\n      // Default: count as production work\n      this.eventStats.production++;\n    }\n  }\n\n  /**\n   * Get a copy of current event stats for building system.\n   * @returns {typeof this.eventStats}\n   */\n  getEventStats() {\n    return { ...this.eventStats };\n  }\n\n  /** @param {Worker} worker */\n  upsertWorker(worker) {\n    this.workers.set(worker.id, worker);\n    this.notify();\n  }\n\n  /** @param {string} workerId */\n  removeWorker(workerId) {\n    this.workers.delete(workerId);\n    this.selected.delete(workerId);\n    this.notify();\n  }\n\n  /** @param {string[]} ids */\n  setSelected(ids) {\n    this.selected = new Set(ids);\n    this.notify();\n  }\n\n  /** @returns {Worker[]} */\n  getSelectedWorkers() {\n    const out = [];\n    for (const id of this.selected) {\n      const w = this.workers.get(id);\n      if (w) out.push(w);\n    }\n    return out;\n  }\n\n  /** @returns {Worker[]} */\n  getIdleOrBlocked() {\n    const out = [];\n    for (const w of this.workers.values()) {\n      if (w.status === 'idle' || w.status === 'blocked') out.push(w);\n    }\n    return out;\n  }\n\n  tickStats() {\n    // aggregate tokens from worker objects\n    let tokens = 0;\n    for (const w of this.workers.values()) tokens += w.tokensUsed;\n    this.stats.tokens = tokens;\n  }\n\n  getSessionDurationMs() {\n    return Date.now() - this.startedAt;\n  }\n}\n\n/** @param {number} ms */\nexport function formatDuration(ms) {\n  const total = Math.max(0, Math.floor(ms / 1000));\n  const m = Math.floor(total / 60);\n  const s = total % 60;\n  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;\n}\n","/**\n * Workspace map regions.\n * This is a stylized abstraction of a codebase.\n * @typedef {'goldmine'|'lumber'|'townhall'|'ground'} RegionType\n * @typedef {{x:number,y:number,width:number,height:number}} Rect\n * @typedef {{id:string,name:string,type:RegionType,bounds:Rect}} MapRegion\n */\n\n/** @type {MapRegion[]} */\nexport const REGIONS = [\n  { id: 'townhall', name: 'Town Hall', type: 'townhall', bounds: { x: 540, y: 280, width: 240, height: 180 } },\n  { id: 'src_core', name: 'src/core', type: 'goldmine', bounds: { x: 180, y: 170, width: 260, height: 180 } },\n  { id: 'src_ui', name: 'src/ui', type: 'goldmine', bounds: { x: 860, y: 150, width: 260, height: 170 } },\n  { id: 'tests', name: 'tests', type: 'lumber', bounds: { x: 850, y: 400, width: 280, height: 160 } },\n  { id: 'config', name: 'config', type: 'lumber', bounds: { x: 190, y: 390, width: 240, height: 150 } },\n  { id: 'docs', name: 'docs', type: 'ground', bounds: { x: 460, y: 500, width: 360, height: 140 } },\n];\n\n/**\n * @param {number} x\n * @param {number} y\n * @returns {MapRegion|null}\n */\nexport function regionAt(x, y) {\n  for (const r of REGIONS) {\n    const b = r.bounds;\n    if (x >= b.x && x <= b.x + b.width && y >= b.y && y <= b.y + b.height) return r;\n  }\n  return null;\n}\n\n/**\n * @param {MapRegion} region\n */\nexport function randomPointIn(region) {\n  const b = region.bounds;\n  const pad = 18;\n  return {\n    x: b.x + pad + Math.random() * (b.width - pad * 2),\n    y: b.y + pad + Math.random() * (b.height - pad * 2),\n  };\n}\n\nexport function clamp(v, lo, hi) {\n  return Math.max(lo, Math.min(hi, v));\n}\n\n/**\n * @param {{x:number,y:number}} a\n * @param {{x:number,y:number}} b\n */\nexport function dist(a, b) {\n  const dx = a.x - b.x;\n  const dy = a.y - b.y;\n  return Math.hypot(dx, dy);\n}\n","/**\n * Sprite loading and rendering for BlazeCraft.\n *\n * Handles pre-rendered isometric sprites from Tiny RTS asset pack.\n * Workers: 8 directions (0-7, clockwise from South)\n * Buildings: Single isometric view per type/tier\n */\n\n/** @typedef {0|1|2|3|4|5|6|7} Direction */\n\n/**\n * Direction mapping for movement vectors.\n * Index 0 = South (down-right in isometric)\n */\nexport const DIRECTIONS = {\n  S: 0,   // South (0Â°)\n  SW: 1,  // Southwest (45Â°)\n  W: 2,   // West (90Â°)\n  NW: 3,  // Northwest (135Â°)\n  N: 4,   // North (180Â°)\n  NE: 5,  // Northeast (225Â°)\n  E: 6,   // East (270Â°)\n  SE: 7,  // Southeast (315Â°)\n};\n\n/**\n * Calculate direction index from movement vector.\n * @param {number} dx - X velocity\n * @param {number} dy - Y velocity\n * @returns {Direction}\n */\nexport function directionFromVector(dx, dy) {\n  if (dx === 0 && dy === 0) return DIRECTIONS.S;\n\n  const angle = Math.atan2(dy, dx);\n  // Convert to 0-2PI range\n  const normalizedAngle = angle < 0 ? angle + Math.PI * 2 : angle;\n  // Map to 8 directions (each 45Â°)\n  const dirIndex = Math.round(normalizedAngle / (Math.PI / 4)) % 8;\n\n  // Rotate to match sprite sheet orientation (0 = South)\n  return /** @type {Direction} */ ((dirIndex + 2) % 8);\n}\n\n/**\n * SpriteManager handles loading and caching of sprite images.\n */\nexport class SpriteManager {\n  constructor() {\n    /** @type {Map<string, HTMLImageElement>} */\n    this.cache = new Map();\n\n    /** @type {boolean} */\n    this.loaded = false;\n\n    /** @type {Promise<void>|null} */\n    this.loadPromise = null;\n\n    this.basePath = 'assets/sprites';\n  }\n\n  /**\n   * Preload all required sprites.\n   * @returns {Promise<void>}\n   */\n  async preload() {\n    if (this.loadPromise) return this.loadPromise;\n\n    this.loadPromise = this._loadAll();\n    await this.loadPromise;\n    this.loaded = true;\n    return this.loadPromise;\n  }\n\n  async _loadAll() {\n    const loads = [];\n\n    // Worker sprites (8 directions)\n    for (let d = 0; d < 8; d++) {\n      loads.push(this._loadImage(`units/worker_d${d}.png`, `worker_d${d}`));\n    }\n\n    // Building sprites\n    const buildings = [\n      'townhall_t1', 'townhall_t2', 'townhall_t3',\n      'barracks', 'farm', 'forge', 'library',\n      'tower', 'tower_b', 'workshop', 'archive', 'granary'\n    ];\n    for (const name of buildings) {\n      loads.push(this._loadImage(`buildings/${name}.png`, `building_${name}`));\n    }\n\n    await Promise.all(loads);\n  }\n\n  /**\n   * @param {string} path\n   * @param {string} key\n   * @returns {Promise<HTMLImageElement>}\n   */\n  _loadImage(path, key) {\n    return new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => {\n        this.cache.set(key, img);\n        resolve(img);\n      };\n      img.onerror = () => {\n        console.warn(`Failed to load sprite: ${path}`);\n        resolve(img); // Don't fail entire load\n      };\n      img.src = `${this.basePath}/${path}`;\n    });\n  }\n\n  /**\n   * Get worker sprite for given direction.\n   * @param {Direction} direction\n   * @returns {HTMLImageElement|null}\n   */\n  getWorkerSprite(direction) {\n    return this.cache.get(`worker_d${direction}`) || null;\n  }\n\n  /**\n   * Get building sprite.\n   * @param {string} buildingType - e.g., 'townhall', 'barracks'\n   * @param {number} tier - 1, 2, or 3 (only townhall has tiers currently)\n   * @returns {HTMLImageElement|null}\n   */\n  getBuildingSprite(buildingType, tier = 1) {\n    // Townhall has tier variants\n    if (buildingType === 'townhall') {\n      return this.cache.get(`building_townhall_t${tier}`) || null;\n    }\n\n    // Map BlazeCraft building types to sprite names\n    const spriteMap = {\n      barracks: 'barracks',\n      farm: 'farm',\n      forge: 'forge',\n      library: 'library',\n      tower: tier >= 2 ? 'tower_b' : 'tower',\n      workshop: 'workshop',\n      archive: 'archive',\n    };\n\n    const spriteName = spriteMap[buildingType] || buildingType;\n    return this.cache.get(`building_${spriteName}`) || null;\n  }\n}\n\n/**\n * Draw a worker sprite on canvas.\n * @param {CanvasRenderingContext2D} ctx\n * @param {SpriteManager} sprites\n * @param {number} x - World X position\n * @param {number} y - World Y position\n * @param {Direction} direction\n * @param {Object} options\n * @param {number} [options.scale=1]\n * @param {number} [options.alpha=1]\n * @param {string} [options.tint] - Optional color tint (CSS color)\n * @param {number} [options.bob=0] - Vertical bob offset\n */\nexport function drawWorkerSprite(ctx, sprites, x, y, direction, options = {}) {\n  const { scale = 1, alpha = 1, tint, bob = 0 } = options;\n  const sprite = sprites.getWorkerSprite(direction);\n\n  if (!sprite || !sprite.complete) {\n    // Fallback to circle if sprite not loaded\n    ctx.beginPath();\n    ctx.fillStyle = tint || 'rgba(244,244,247,0.7)';\n    ctx.arc(x, y + bob, 7.5, 0, Math.PI * 2);\n    ctx.fill();\n    return;\n  }\n\n  const w = sprite.width * scale;\n  const h = sprite.height * scale;\n\n  ctx.save();\n  ctx.globalAlpha = alpha;\n\n  // Draw sprite centered at position\n  ctx.drawImage(\n    sprite,\n    x - w / 2,\n    y - h / 2 + bob,\n    w,\n    h\n  );\n\n  // Optional tint overlay\n  if (tint) {\n    ctx.globalCompositeOperation = 'source-atop';\n    ctx.fillStyle = tint;\n    ctx.globalAlpha = 0.3;\n    ctx.fillRect(x - w / 2, y - h / 2 + bob, w, h);\n  }\n\n  ctx.restore();\n}\n\n/**\n * Draw a building sprite on canvas.\n * @param {CanvasRenderingContext2D} ctx\n * @param {SpriteManager} sprites\n * @param {number} x - World X position (center)\n * @param {number} y - World Y position (center)\n * @param {string} buildingType\n * @param {number} tier\n * @param {Object} options\n * @param {number} [options.scale=1]\n * @param {number} [options.alpha=1]\n */\nexport function drawBuildingSprite(ctx, sprites, x, y, buildingType, tier, options = {}) {\n  const { scale = 1, alpha = 1 } = options;\n  const sprite = sprites.getBuildingSprite(buildingType, tier);\n\n  if (!sprite || !sprite.complete) {\n    // Fallback to rectangle\n    ctx.fillStyle = 'rgba(30,30,35,0.8)';\n    ctx.fillRect(x - 48, y - 36, 96, 72);\n    return;\n  }\n\n  const w = sprite.width * scale;\n  const h = sprite.height * scale;\n\n  ctx.save();\n  ctx.globalAlpha = alpha;\n\n  ctx.drawImage(\n    sprite,\n    x - w / 2,\n    y - h / 2,\n    w,\n    h\n  );\n\n  ctx.restore();\n}\n\n// Singleton instance for easy access\nexport const spriteManager = new SpriteManager();\n","/**\n * Building system for BlazeCraft.\n * Inspired by WC3 Frozen Throne + Civ Rev visual progression.\n *\n * Buildings evolve as the session progresses:\n * - Town Hall â†’ Keep â†’ Fortress (based on total completed tasks)\n * - Production buildings appear and upgrade\n * - Visual density increases with activity\n *\n * Now uses pre-rendered isometric sprites from Tiny RTS asset pack.\n */\n\nimport { spriteManager, drawBuildingSprite } from './sprites.js';\n\n/** @typedef {'townhall'|'barracks'|'farm'|'forge'|'library'|'tower'|'workshop'|'archive'} BuildingType */\n/** @typedef {1|2|3} BuildingTier */\n\n/**\n * @typedef {{\n *   id: string,\n *   type: BuildingType,\n *   tier: BuildingTier,\n *   position: {x: number, y: number},\n *   size: {w: number, h: number},\n *   constructionProgress: number,\n *   isConstructing: boolean,\n *   spawnedAt: number,\n *   lastActivity: number\n * }} Building\n */\n\n/**\n * Building definitions with tier-based appearance.\n * Each building is driven by a specific event category:\n * - townhall: spawns (workers rally here)\n * - barracks: commands (military coordination)\n * - farm: production (resource gathering)\n * - forge: repairs (error recovery & fixes)\n * - library: research (investigation & analysis)\n * - tower: defense (monitoring & status)\n * - workshop: production (crafting & building)\n * - archive: storage (data management)\n */\nexport const BUILDING_DEFS = {\n  townhall: {\n    name: ['Town Hall', 'Keep', 'Fortress'],\n    baseSize: { w: 96, h: 72 },\n    eventKey: 'spawns', // Driven by spawn events\n    tiers: [\n      { eventsRequired: 0, color: '#1A1A1A', accent: '#BF5700' },\n      { eventsRequired: 5, color: '#1F1F1F', accent: '#D96B1A' },\n      { eventsRequired: 12, color: '#242424', accent: '#FF6B35' },\n    ],\n  },\n  barracks: {\n    name: ['Barracks', 'War Hall', 'Command Center'],\n    baseSize: { w: 64, h: 56 },\n    eventKey: 'commands', // Driven by command/assignment events\n    tiers: [\n      { eventsRequired: 2, color: '#1A1614', accent: '#8B4513' },\n      { eventsRequired: 8, color: '#1F1A16', accent: '#A0522D' },\n      { eventsRequired: 18, color: '#24201A', accent: '#CD853F' },\n    ],\n  },\n  farm: {\n    name: ['Farm', 'Mill', 'Granary'],\n    baseSize: { w: 52, h: 44 },\n    eventKey: 'production', // Driven by production events\n    tiers: [\n      { eventsRequired: 2, color: '#141A14', accent: '#2E8B57' },\n      { eventsRequired: 10, color: '#161F16', accent: '#3CB371' },\n      { eventsRequired: 22, color: '#1A241A', accent: '#66CDAA' },\n    ],\n  },\n  forge: {\n    name: ['Forge', 'Armory', 'War Factory'],\n    baseSize: { w: 56, h: 48 },\n    eventKey: 'repairs', // Driven by error/repair events\n    tiers: [\n      { eventsRequired: 1, color: '#1A1414', accent: '#8B0000' },\n      { eventsRequired: 5, color: '#1F1616', accent: '#B22222' },\n      { eventsRequired: 12, color: '#241A1A', accent: '#DC143C' },\n    ],\n  },\n  library: {\n    name: ['Library', 'Archives', 'Sanctum'],\n    baseSize: { w: 58, h: 50 },\n    eventKey: 'research', // Driven by research/investigation events\n    tiers: [\n      { eventsRequired: 2, color: '#14141A', accent: '#4169E1' },\n      { eventsRequired: 8, color: '#16161F', accent: '#6495ED' },\n      { eventsRequired: 16, color: '#1A1A24', accent: '#87CEEB' },\n    ],\n  },\n  tower: {\n    name: ['Scout Tower', 'Guard Tower', 'Citadel'],\n    baseSize: { w: 36, h: 36 },\n    eventKey: 'defense', // Driven by monitoring/status events\n    tiers: [\n      { eventsRequired: 3, color: '#181818', accent: '#696969' },\n      { eventsRequired: 12, color: '#1C1C1C', accent: '#808080' },\n      { eventsRequired: 25, color: '#202020', accent: '#A9A9A9' },\n    ],\n  },\n  workshop: {\n    name: ['Workshop', 'Factory', 'Foundry'],\n    baseSize: { w: 60, h: 52 },\n    eventKey: 'production', // Also driven by production events\n    tiers: [\n      { eventsRequired: 4, color: '#1A1816', accent: '#DAA520' },\n      { eventsRequired: 14, color: '#1F1C18', accent: '#FFD700' },\n      { eventsRequired: 28, color: '#24201A', accent: '#FFA500' },\n    ],\n  },\n  archive: {\n    name: ['Archive', 'Repository', 'Nexus'],\n    baseSize: { w: 48, h: 40 },\n    eventKey: 'storage', // Driven by storage/data events\n    tiers: [\n      { eventsRequired: 2, color: '#161618', accent: '#9932CC' },\n      { eventsRequired: 8, color: '#1A1A1C', accent: '#BA55D3' },\n      { eventsRequired: 18, color: '#1E1E22', accent: '#DA70D6' },\n    ],\n  },\n};\n\n/**\n * City layout positions (relative to center).\n * Buildings radiate outward from the Town Hall.\n */\nconst CITY_LAYOUT = [\n  { type: 'townhall', offset: { x: 0, y: 0 }, priority: 0 },\n  { type: 'barracks', offset: { x: -110, y: -60 }, priority: 1 },\n  { type: 'farm', offset: { x: 110, y: -50 }, priority: 2 },\n  { type: 'forge', offset: { x: -100, y: 70 }, priority: 3 },\n  { type: 'library', offset: { x: 100, y: 60 }, priority: 4 },\n  { type: 'tower', offset: { x: -160, y: 0 }, priority: 5 },\n  { type: 'tower', offset: { x: 160, y: 0 }, priority: 6 },\n  { type: 'workshop', offset: { x: 0, y: -100 }, priority: 7 },\n  { type: 'archive', offset: { x: 0, y: 100 }, priority: 8 },\n];\n\n/**\n * CityManager handles building state and progression.\n */\nexport class CityManager {\n  /**\n   * @param {number} centerX - City center X coordinate\n   * @param {number} centerY - City center Y coordinate\n   */\n  constructor(centerX = 660, centerY = 370) {\n    /** @type {Map<string, Building>} */\n    this.buildings = new Map();\n    this.centerX = centerX;\n    this.centerY = centerY;\n    this.cityLevel = 0;\n    this.lastTaskCount = 0;\n\n    // Always start with Town Hall\n    this.spawnBuilding('townhall', 0);\n  }\n\n  /**\n   * @param {BuildingType} type\n   * @param {number} layoutIndex\n   * @returns {Building}\n   */\n  spawnBuilding(type, layoutIndex) {\n    const layout = CITY_LAYOUT[layoutIndex];\n    const def = BUILDING_DEFS[type];\n    const now = Date.now();\n\n    const building = {\n      id: `${type}_${layoutIndex}`,\n      type,\n      tier: 1,\n      position: {\n        x: this.centerX + layout.offset.x,\n        y: this.centerY + layout.offset.y,\n      },\n      size: { ...def.baseSize },\n      constructionProgress: type === 'townhall' ? 100 : 0,\n      isConstructing: type !== 'townhall',\n      spawnedAt: now,\n      lastActivity: now,\n    };\n\n    this.buildings.set(building.id, building);\n    return building;\n  }\n\n  /**\n   * @typedef {{spawns:number,commands:number,production:number,research:number,repairs:number,storage:number,defense:number}} EventStats\n   */\n\n  /**\n   * Update city based on event statistics from real agent events.\n   * Each building type is driven by a specific event category.\n   * @param {EventStats} eventStats - Event counts by category\n   */\n  updateProgress(eventStats) {\n    const now = Date.now();\n\n    // Calculate total events for city level\n    const totalEvents = Object.values(eventStats).reduce((a, b) => a + b, 0);\n\n    // Check for new buildings to spawn based on their event category\n    for (let i = 0; i < CITY_LAYOUT.length; i++) {\n      const layout = CITY_LAYOUT[i];\n      const def = BUILDING_DEFS[layout.type];\n      const tier0 = def.tiers[0];\n      const buildingId = `${layout.type}_${i}`;\n\n      // Get the event count for this building's category\n      const eventCount = eventStats[def.eventKey] || 0;\n\n      // Spawn if we have enough events and building doesn't exist\n      if (eventCount >= tier0.eventsRequired && !this.buildings.has(buildingId)) {\n        this.spawnBuilding(layout.type, i);\n      }\n    }\n\n    // Update existing buildings based on their event category\n    for (const building of this.buildings.values()) {\n      const def = BUILDING_DEFS[building.type];\n      const eventCount = eventStats[def.eventKey] || 0;\n\n      // Progress construction\n      if (building.isConstructing) {\n        building.constructionProgress += 2;\n        if (building.constructionProgress >= 100) {\n          building.constructionProgress = 100;\n          building.isConstructing = false;\n        }\n      }\n\n      // Check for tier upgrades based on event count for this building type\n      for (let t = 2; t >= 0; t--) {\n        const tierDef = def.tiers[t];\n        if (eventCount >= tierDef.eventsRequired && building.tier <= t) {\n          if (building.tier < t + 1) {\n            building.tier = /** @type {BuildingTier} */ (t + 1);\n            building.lastActivity = now;\n            // Size grows slightly with tier\n            building.size.w = def.baseSize.w + (t * 8);\n            building.size.h = def.baseSize.h + (t * 6);\n          }\n          break;\n        }\n      }\n    }\n\n    // Update city level based on total events\n    this.cityLevel = this.calculateCityLevel(totalEvents);\n    this.lastTaskCount = totalEvents;\n  }\n\n  /**\n   * Calculate city level based on total events.\n   * @param {number} totalEvents\n   * @returns {number}\n   */\n  calculateCityLevel(totalEvents) {\n    if (totalEvents >= 80) return 5;\n    if (totalEvents >= 50) return 4;\n    if (totalEvents >= 25) return 3;\n    if (totalEvents >= 10) return 2;\n    return 1;\n  }\n\n  /**\n   * @returns {Building[]}\n   */\n  getAllBuildings() {\n    return Array.from(this.buildings.values());\n  }\n\n  /**\n   * @param {string} buildingId\n   * @returns {Building|undefined}\n   */\n  getBuilding(buildingId) {\n    return this.buildings.get(buildingId);\n  }\n\n  /**\n   * Get city stats for UI display.\n   */\n  getCityStats() {\n    const buildings = this.getAllBuildings();\n    const constructed = buildings.filter(b => !b.isConstructing).length;\n    const maxTier = Math.max(...buildings.map(b => b.tier), 1);\n\n    return {\n      level: this.cityLevel,\n      buildingsTotal: buildings.length,\n      buildingsConstructed: constructed,\n      maxTier,\n    };\n  }\n}\n\n/**\n * Render a building on the canvas using isometric sprites.\n * Falls back to procedural rendering if sprites not loaded.\n * @param {CanvasRenderingContext2D} ctx\n * @param {Building} building\n * @param {number} now - performance.now()\n */\nexport function renderBuilding(ctx, building, now) {\n  const def = BUILDING_DEFS[building.type];\n  const tierIndex = building.tier - 1;\n  const tierDef = def.tiers[tierIndex];\n  const name = def.name[tierIndex];\n\n  const { x, y } = building.position;\n  const { w, h } = building.size;\n\n  ctx.save();\n\n  // Construction animation\n  const constructionAlpha = building.isConstructing\n    ? 0.4 + (building.constructionProgress / 100) * 0.6\n    : 1;\n\n  // Shadow\n  ctx.fillStyle = 'rgba(0,0,0,0.35)';\n  ctx.beginPath();\n  ctx.ellipse(x, y + 40, 44, 16, 0, 0, Math.PI * 2);\n  ctx.fill();\n\n  // Try sprite rendering first\n  if (spriteManager.loaded) {\n    drawBuildingSprite(ctx, spriteManager, x, y, building.type, building.tier, {\n      scale: 1 + (building.tier - 1) * 0.1,  // Slight scale increase per tier\n      alpha: constructionAlpha,\n    });\n  } else {\n    // Fallback: procedural rendering\n    ctx.globalAlpha = constructionAlpha;\n\n    const bodyGradient = ctx.createLinearGradient(x - w/2, y - h/2, x + w/2, y + h/2);\n    bodyGradient.addColorStop(0, tierDef.color);\n    bodyGradient.addColorStop(1, adjustBrightness(tierDef.color, -20));\n    ctx.fillStyle = bodyGradient;\n    ctx.fillRect(x - w/2, y - h/2, w, h);\n\n    ctx.strokeStyle = tierDef.accent;\n    ctx.lineWidth = 2 + (building.tier - 1) * 0.5;\n    ctx.strokeRect(x - w/2, y - h/2, w, h);\n\n    ctx.fillStyle = tierDef.accent;\n    ctx.font = `${14 + building.tier * 2}px Inter, system-ui, sans-serif`;\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n    ctx.fillText(getBuildingIcon(building.type), x, y - 4);\n  }\n\n  // Name label (always show)\n  ctx.globalAlpha = constructionAlpha;\n  ctx.font = '11px Inter, system-ui, sans-serif';\n  ctx.fillStyle = 'rgba(255,255,255,0.85)';\n  ctx.textAlign = 'center';\n  ctx.shadowColor = 'rgba(0,0,0,0.9)';\n  ctx.shadowBlur = 4;\n  ctx.fillText(name, x, y + 56);\n\n  // Construction progress bar\n  if (building.isConstructing) {\n    const barW = 72;\n    const barH = 4;\n    const barX = x - barW/2;\n    const barY = y + 65;\n\n    ctx.fillStyle = 'rgba(0,0,0,0.6)';\n    ctx.fillRect(barX, barY, barW, barH);\n\n    ctx.fillStyle = '#BF5700';\n    ctx.fillRect(barX, barY, barW * (building.constructionProgress / 100), barH);\n  }\n\n  // Activity pulse for recently upgraded buildings\n  const activityAge = now - building.lastActivity;\n  if (activityAge < 3000 && !building.isConstructing) {\n    const pulse = Math.sin((now / 200)) * 0.3 + 0.7;\n    ctx.strokeStyle = hexToRgba(tierDef.accent, pulse * 0.6);\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.arc(x, y, 50 + building.tier * 4, 0, Math.PI * 2);\n    ctx.stroke();\n  }\n\n  ctx.restore();\n}\n\n/**\n * @param {BuildingType} type\n * @returns {string}\n */\nfunction getBuildingIcon(type) {\n  const icons = {\n    townhall: 'â›«',\n    barracks: 'âš”',\n    farm: 'âš˜',\n    forge: 'âš’',\n    library: 'ðŸ“œ',\n    tower: 'â›‰',\n    workshop: 'âš™',\n    archive: 'â—‰',\n  };\n  return icons[type] || 'â—»';\n}\n\n/**\n * @param {string} hex\n * @param {number} amount\n * @returns {string}\n */\nfunction adjustBrightness(hex, amount) {\n  const num = parseInt(hex.replace('#', ''), 16);\n  const r = Math.max(0, Math.min(255, ((num >> 16) & 0xFF) + amount));\n  const g = Math.max(0, Math.min(255, ((num >> 8) & 0xFF) + amount));\n  const b = Math.max(0, Math.min(255, (num & 0xFF) + amount));\n  return `rgb(${r},${g},${b})`;\n}\n\n/**\n * @param {string} hex\n * @param {number} alpha\n * @returns {string}\n */\nfunction hexToRgba(hex, alpha) {\n  const num = parseInt(hex.replace('#', ''), 16);\n  const r = (num >> 16) & 0xFF;\n  const g = (num >> 8) & 0xFF;\n  const b = num & 0xFF;\n  return `rgba(${r},${g},${b},${alpha})`;\n}\n","import { REGIONS, clamp, regionAt } from './map.js';\nimport { renderBuilding } from './buildings.js';\nimport { spriteManager, drawWorkerSprite, directionFromVector, DIRECTIONS } from './sprites.js';\n\n/**\n * Canvas renderer for the main map + minimap.\n *\n * Notes:\n * - Deliberately keeps rendering lightweight (2D canvas, no WebGL).\n * - Styling leans Blaze Sports Intel: dark UI with orange accent.\n * - City buildings layer on top for WC3+Civ Rev progression feel.\n */\nexport class Renderer {\n  /**\n   * @param {HTMLCanvasElement|null} mapCanvas - null if 3D renderer handles main viewport\n   * @param {HTMLCanvasElement} minimapCanvas\n   */\n  constructor(mapCanvas, minimapCanvas) {\n    this.mapCanvas = mapCanvas;\n    this.minimapCanvas = minimapCanvas;\n    this.ctx = mapCanvas ? mapCanvas.getContext('2d', { alpha: false }) : null;\n    this.mctx = minimapCanvas.getContext('2d', { alpha: false });\n\n    this.dpr = Math.max(1, window.devicePixelRatio || 1);\n\n    this.camera = { x: 0, y: 0, zoom: 1 };\n\n    this.selection = {\n      active: false,\n      x0: 0,\n      y0: 0,\n      x1: 0,\n      y1: 0,\n    };\n\n    /** @type {HTMLImageElement|null} */\n    this.texNoise = null;\n\n    this.lastEventTs = 0;\n    /** @type {{x:number,y:number,kind:'spawn'|'error',t:number}[]} */\n    this.pings = [];\n\n    /** @type {Map<string, number>} */\n    this.regionActivity = new Map();\n\n    /** @type {import('./buildings.js').CityManager|null} */\n    this.cityManager = null;\n\n    this.world = { w: 1280, h: 720 };\n\n    this.resize();\n    window.addEventListener('resize', () => this.resize());\n  }\n\n  /**\n   * @param {import('./buildings.js').CityManager} cityManager\n   */\n  setCityManager(cityManager) {\n    this.cityManager = cityManager;\n  }\n\n  /**\n   * Load all textures and sprites with optional progress callback.\n   * @param {(progress: number) => void} [onProgress] - Callback with progress 0-1\n   */\n  async loadTextures(onProgress) {\n    const reportProgress = onProgress || (() => {});\n    let loaded = 0;\n    const total = 2; // noise texture + sprites\n\n    const load = (src) => new Promise((resolve, reject) => {\n      const img = new Image();\n      img.onload = () => resolve(img);\n      img.onerror = reject;\n      img.src = src;\n    });\n\n    try {\n      this.texNoise = await load('styles/textures/noise.png');\n    } catch {\n      // texture load failing is non-fatal; we fall back to flat fills.\n      this.texNoise = null;\n    }\n    loaded++;\n    reportProgress(loaded / total);\n\n    // Preload isometric sprites\n    try {\n      await spriteManager.preload();\n      this.spritesLoaded = true;\n    } catch {\n      this.spritesLoaded = false;\n    }\n    loaded++;\n    reportProgress(loaded / total);\n  }\n\n  resize() {\n    // Main canvas (skip if 3D renderer handles it)\n    if (this.mapCanvas && this.ctx) {\n      const rect = this.mapCanvas.getBoundingClientRect();\n      const w = Math.max(320, Math.floor(rect.width));\n      const h = Math.max(240, Math.floor(rect.height));\n\n      this.mapCanvas.width = Math.floor(w * this.dpr);\n      this.mapCanvas.height = Math.floor(h * this.dpr);\n      this.mapCanvas.style.width = `${w}px`;\n      this.mapCanvas.style.height = `${h}px`;\n\n      this.ctx.setTransform(this.dpr, 0, 0, this.dpr, 0, 0);\n    }\n\n    // minimap\n    const mrect = this.minimapCanvas.getBoundingClientRect();\n    const mw = Math.floor(mrect.width);\n    const mh = Math.floor(mrect.height);\n    this.minimapCanvas.width = Math.floor(mw * this.dpr);\n    this.minimapCanvas.height = Math.floor(mh * this.dpr);\n    this.minimapCanvas.style.width = `${mw}px`;\n    this.minimapCanvas.style.height = `${mh}px`;\n    this.mctx.setTransform(this.dpr, 0, 0, this.dpr, 0, 0);\n  }\n\n  /**\n   * @param {number} clientX\n   * @param {number} clientY\n   */\n  screenToWorld(clientX, clientY) {\n    const rect = this.mapCanvas.getBoundingClientRect();\n    const sx = clientX - rect.left;\n    const sy = clientY - rect.top;\n\n    const cx = sx - rect.width / 2;\n    const cy = sy - rect.height / 2;\n\n    const wx = (cx / this.camera.zoom) + this.camera.x;\n    const wy = (cy / this.camera.zoom) + this.camera.y;\n\n    return { x: wx, y: wy };\n  }\n\n  worldToScreen(wx, wy) {\n    const rect = this.mapCanvas.getBoundingClientRect();\n    const sx = (wx - this.camera.x) * this.camera.zoom + rect.width / 2;\n    const sy = (wy - this.camera.y) * this.camera.zoom + rect.height / 2;\n    return { x: sx, y: sy };\n  }\n\n  setSelection(active, x0, y0, x1, y1) {\n    this.selection.active = active;\n    this.selection.x0 = x0;\n    this.selection.y0 = y0;\n    this.selection.x1 = x1;\n    this.selection.y1 = y1;\n  }\n\n  addPing(x, y, kind) {\n    this.pings.push({ x, y, kind, t: performance.now() });\n    if (this.pings.length > 32) this.pings.shift();\n  }\n\n  /**\n   * @param {import('./game-state.js').GameState} state\n   */\n  render(state) {\n    const now = performance.now();\n\n    // activity (fog)\n    for (const w of state.workers.values()) {\n      const last = this.regionActivity.get(w.targetRegion) || 0;\n      this.regionActivity.set(w.targetRegion, Math.max(last, w.updatedAt));\n    }\n\n    // detect new events for pings\n    if (state.events.length) {\n      const latest = state.events[state.events.length - 1];\n      if (latest.timestamp > this.lastEventTs) {\n        this.lastEventTs = latest.timestamp;\n        const w = state.workers.get(latest.workerId);\n        if (w) {\n          if (latest.type === 'spawn') this.addPing(w.position.x, w.position.y, 'spawn');\n          if (latest.type === 'error') this.addPing(w.position.x, w.position.y, 'error');\n        }\n      }\n    }\n\n    // Main canvas rendering (skip if 3D renderer handles it)\n    if (this.mapCanvas && this.ctx) {\n      // clear\n      const rect = this.mapCanvas.getBoundingClientRect();\n      this.ctx.clearRect(0, 0, rect.width, rect.height);\n\n      // background\n      this.drawBackground(rect.width, rect.height);\n\n      // world transform\n      this.ctx.save();\n      this.ctx.translate(rect.width / 2, rect.height / 2);\n      this.ctx.scale(this.camera.zoom, this.camera.zoom);\n      this.ctx.translate(-this.camera.x, -this.camera.y);\n\n      // base world fog\n      this.ctx.fillStyle = 'rgba(0,0,0,0.22)';\n      this.ctx.fillRect(0, 0, this.world.w, this.world.h);\n\n      // regions\n      for (const r of REGIONS) this.drawRegion(r, now);\n\n      // buildings (WC3+Civ Rev city layer)\n      if (this.cityManager) {\n        for (const building of this.cityManager.getAllBuildings()) {\n          renderBuilding(this.ctx, building, now);\n        }\n      }\n\n      // pings\n      for (const p of this.pings) this.drawPing(p, now);\n\n      // workers\n      for (const w of state.workers.values()) {\n        this.drawWorker(w, state.selected.has(w.id), now);\n      }\n\n      // selection marquee\n      if (this.selection.active) {\n        this.ctx.save();\n        this.ctx.strokeStyle = 'rgba(232,108,44,0.85)';\n        this.ctx.lineWidth = 2 / this.camera.zoom;\n        this.ctx.setLineDash([6 / this.camera.zoom, 4 / this.camera.zoom]);\n        const x = Math.min(this.selection.x0, this.selection.x1);\n        const y = Math.min(this.selection.y0, this.selection.y1);\n        const w = Math.abs(this.selection.x1 - this.selection.x0);\n        const h = Math.abs(this.selection.y1 - this.selection.y0);\n        this.ctx.strokeRect(x, y, w, h);\n        this.ctx.restore();\n      }\n\n      this.ctx.restore();\n    }\n\n    // minimap\n    this.drawMinimap(state);\n  }\n\n  drawBackground(w, h) {\n    const ctx = this.ctx;\n\n    // base\n    ctx.fillStyle = '#0b0b0f';\n    ctx.fillRect(0, 0, w, h);\n\n    // soft glow\n    const g1 = ctx.createRadialGradient(w * 0.22, h * 0.12, 20, w * 0.22, h * 0.12, Math.max(w, h) * 0.85);\n    g1.addColorStop(0, 'rgba(232,108,44,0.18)');\n    g1.addColorStop(1, 'rgba(232,108,44,0)');\n    ctx.fillStyle = g1;\n    ctx.fillRect(0, 0, w, h);\n\n    // subtle grid\n    ctx.save();\n    ctx.globalAlpha = 0.25;\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)';\n    ctx.lineWidth = 1;\n    const step = 48;\n    for (let x = 0; x <= w; x += step) {\n      ctx.beginPath();\n      ctx.moveTo(x + 0.5, 0);\n      ctx.lineTo(x + 0.5, h);\n      ctx.stroke();\n    }\n    for (let y = 0; y <= h; y += step) {\n      ctx.beginPath();\n      ctx.moveTo(0, y + 0.5);\n      ctx.lineTo(w, y + 0.5);\n      ctx.stroke();\n    }\n    ctx.restore();\n\n    // noise\n    if (this.texNoise) {\n      const pat = ctx.createPattern(this.texNoise, 'repeat');\n      if (pat) {\n        ctx.save();\n        ctx.globalAlpha = 0.16;\n        ctx.fillStyle = pat;\n        ctx.fillRect(0, 0, w, h);\n        ctx.restore();\n      }\n    }\n\n    // vignette\n    const v = ctx.createRadialGradient(w * 0.5, h * 0.5, 30, w * 0.5, h * 0.5, Math.max(w, h));\n    v.addColorStop(0, 'rgba(0,0,0,0.08)');\n    v.addColorStop(1, 'rgba(0,0,0,0.72)');\n    ctx.fillStyle = v;\n    ctx.fillRect(0, 0, w, h);\n  }\n\n  drawRegion(region, now) {\n    const ctx = this.ctx;\n    const b = region.bounds;\n\n    const palette = {\n      townhall: { fill: 'rgba(18,18,26,0.78)', edge: 'rgba(232,108,44,0.82)' },\n      goldmine: { fill: 'rgba(30,20,16,0.72)', edge: 'rgba(255,177,122,0.70)' },\n      lumber: { fill: 'rgba(16,26,20,0.66)', edge: 'rgba(55,214,122,0.62)' },\n      ground: { fill: 'rgba(14,14,18,0.58)', edge: 'rgba(255,255,255,0.10)' },\n    }[region.type];\n\n    // shadow\n    ctx.save();\n    ctx.fillStyle = 'rgba(0,0,0,0.52)';\n    ctx.fillRect(b.x + 5, b.y + 6, b.width, b.height);\n    ctx.restore();\n\n    // fill\n    ctx.save();\n    ctx.fillStyle = palette.fill;\n    ctx.fillRect(b.x, b.y, b.width, b.height);\n\n    // edge\n    ctx.strokeStyle = palette.edge;\n    ctx.lineWidth = 2;\n    ctx.strokeRect(b.x, b.y, b.width, b.height);\n\n    // inner edge\n    ctx.strokeStyle = 'rgba(0,0,0,0.55)';\n    ctx.lineWidth = 2;\n    ctx.strokeRect(b.x + 2, b.y + 2, b.width - 4, b.height - 4);\n\n    // label\n    ctx.font = '600 14px Inter, system-ui, sans-serif';\n    ctx.fillStyle = 'rgba(244,244,247,0.86)';\n    ctx.shadowColor = 'rgba(0,0,0,0.9)';\n    ctx.shadowBlur = 6;\n    ctx.fillText(region.name, b.x + 12, b.y + 22);\n\n    ctx.restore();\n\n    // activity pulse\n    const last = this.regionActivity.get(region.id) || 0;\n    const age = Date.now() - last;\n    if (last && age < 5000) {\n      const t = (now / 1000) % 1;\n      ctx.save();\n      ctx.globalAlpha = (1 - age / 5000) * 0.65;\n      ctx.strokeStyle = 'rgba(55,214,122,0.75)';\n      ctx.lineWidth = 2;\n      ctx.strokeRect(b.x + 4 + t * 6, b.y + 4 + t * 6, b.width - 8 - t * 12, b.height - 8 - t * 12);\n      ctx.restore();\n    }\n  }\n\n  drawWorker(worker, selected, now) {\n    const ctx = this.ctx;\n    const x = worker.position.x;\n    const y = worker.position.y;\n\n    // Calculate direction from velocity (or default to South)\n    const vx = worker.velocity?.x || 0;\n    const vy = worker.velocity?.y || 0;\n    const direction = worker.status === 'moving'\n      ? directionFromVector(vx, vy)\n      : worker.lastDirection || DIRECTIONS.S;\n\n    // Store last direction for when stopped\n    if (worker.status === 'moving') {\n      worker.lastDirection = direction;\n    }\n\n    const bob = Math.sin((now / 250) + (x + y) * 0.01) * 1.6;\n\n    // Status-based tint colors\n    const tintColors = {\n      idle: null,\n      moving: null,\n      working: 'rgba(55,214,122,0.4)',\n      blocked: 'rgba(255,77,77,0.4)',\n      complete: 'rgba(55,214,122,0.3)',\n      terminated: 'rgba(80,80,90,0.6)',\n      hold: 'rgba(247,201,72,0.3)',\n    };\n\n    const alpha = worker.status === 'terminated' ? 0.5 : 1;\n\n    // Selection ring\n    if (selected) {\n      ctx.save();\n      ctx.beginPath();\n      ctx.strokeStyle = 'rgba(232,108,44,0.92)';\n      ctx.lineWidth = 3;\n      ctx.arc(x, y + bob, 36, 0, Math.PI * 2);\n      ctx.stroke();\n      ctx.restore();\n    }\n\n    // Draw sprite (or fallback to circle if sprites not loaded)\n    if (this.spritesLoaded) {\n      drawWorkerSprite(ctx, spriteManager, x, y, direction, {\n        scale: 1,\n        alpha,\n        tint: tintColors[worker.status],\n        bob,\n      });\n    } else {\n      // Fallback procedural rendering\n      const colors = {\n        idle: 'rgba(244,244,247,0.70)',\n        moving: 'rgba(255,177,122,0.95)',\n        working: 'rgba(55,214,122,0.95)',\n        blocked: 'rgba(255,77,77,0.95)',\n        complete: 'rgba(55,214,122,0.95)',\n        terminated: 'rgba(140,140,150,0.55)',\n        hold: 'rgba(247,201,72,0.95)',\n      }[worker.status] || 'rgba(244,244,247,0.85)';\n\n      ctx.save();\n      ctx.beginPath();\n      ctx.fillStyle = colors;\n      ctx.arc(x, y + bob, 7.5, 0, Math.PI * 2);\n      ctx.fill();\n      ctx.restore();\n    }\n\n    // Status pip (top-right of sprite)\n    ctx.save();\n    ctx.beginPath();\n    ctx.fillStyle = 'rgba(0,0,0,0.60)';\n    ctx.arc(x + 24, y + bob - 24, 5, 0, Math.PI * 2);\n    ctx.fill();\n\n    const pipColor = worker.status === 'working' ? 'rgba(55,214,122,1)'\n      : worker.status === 'blocked' ? 'rgba(255,77,77,1)'\n      : worker.status === 'hold' ? 'rgba(247,201,72,1)'\n      : worker.status === 'moving' ? 'rgba(255,177,122,1)'\n      : 'rgba(244,244,247,0.95)';\n\n    ctx.beginPath();\n    ctx.fillStyle = pipColor;\n    ctx.arc(x + 24, y + bob - 24, 3, 0, Math.PI * 2);\n    ctx.fill();\n    ctx.restore();\n\n    // Working sparks effect\n    if (worker.status === 'working') {\n      ctx.save();\n      ctx.strokeStyle = 'rgba(232,108,44,0.78)';\n      ctx.lineWidth = 2;\n      const t = (now / 120) % 1;\n      ctx.beginPath();\n      ctx.moveTo(x - 20, y + bob - 10);\n      ctx.lineTo(x - 10 - t * 10, y + bob - 4);\n      ctx.stroke();\n      ctx.restore();\n    }\n\n    // Blocked distress ring\n    if (worker.status === 'blocked') {\n      ctx.save();\n      ctx.strokeStyle = 'rgba(255,77,77,0.75)';\n      ctx.lineWidth = 2;\n      ctx.beginPath();\n      ctx.arc(x, y + bob, 38, 0, Math.PI * 2);\n      ctx.stroke();\n      ctx.restore();\n    }\n\n    // Complete checkmark overlay\n    if (worker.status === 'complete') {\n      ctx.save();\n      ctx.strokeStyle = 'rgba(244,244,247,0.95)';\n      ctx.lineWidth = 3;\n      ctx.beginPath();\n      ctx.moveTo(x - 8, y + bob);\n      ctx.lineTo(x - 2, y + bob + 6);\n      ctx.lineTo(x + 12, y + bob - 8);\n      ctx.stroke();\n      ctx.restore();\n    }\n\n    // Nameplate\n    ctx.save();\n    ctx.font = '12px Inter, system-ui, sans-serif';\n    ctx.fillStyle = 'rgba(244,244,247,0.78)';\n    ctx.shadowColor = 'rgba(0,0,0,0.90)';\n    ctx.shadowBlur = 6;\n    ctx.textAlign = 'center';\n    ctx.fillText(worker.name, x, y + bob + 44);\n    ctx.restore();\n  }\n\n  drawPing(p, now) {\n    const age = (now - p.t) / 1000;\n    if (age > 1.4) return;\n    const ctx = this.ctx;\n    const r = 8 + age * 40;\n    const a = (1 - age / 1.4) * 0.8;\n    ctx.save();\n    // Different colors for different ping kinds\n    const colors = {\n      error: `rgba(255,77,77,${a})`,\n      spawn: `rgba(232,108,44,${a})`,\n      select: `rgba(232,108,44,${a * 0.7})`,\n    };\n    ctx.strokeStyle = colors[p.kind] || colors.spawn;\n    ctx.lineWidth = p.kind === 'select' ? 2 : 3;\n    ctx.beginPath();\n    ctx.arc(p.x, p.y, r, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.restore();\n  }\n\n  /**\n   * Spawn selection pulses on workers.\n   * @param {Array<{x: number, y: number}>} positions\n   */\n  spawnSelectionPulses(positions) {\n    const now = performance.now();\n    for (const pos of positions) {\n      this.pings.push({ x: pos.x, y: pos.y, kind: 'select', t: now });\n    }\n    // Limit total pings\n    while (this.pings.length > 48) this.pings.shift();\n  }\n\n  drawMinimap(state) {\n    const ctx = this.mctx;\n    const rect = this.minimapCanvas.getBoundingClientRect();\n    const w = rect.width;\n    const h = rect.height;\n\n    // base\n    ctx.fillStyle = '#070709';\n    ctx.fillRect(0, 0, w, h);\n\n    // noise\n    if (this.texNoise) {\n      const pat = ctx.createPattern(this.texNoise, 'repeat');\n      if (pat) {\n        ctx.save();\n        ctx.globalAlpha = 0.20;\n        ctx.fillStyle = pat;\n        ctx.fillRect(0, 0, w, h);\n        ctx.restore();\n      }\n    }\n\n    const sx = w / this.world.w;\n    const sy = h / this.world.h;\n\n    // regions\n    for (const r of REGIONS) {\n      const b = r.bounds;\n      ctx.save();\n      const last = this.regionActivity.get(r.id) || 0;\n      const age = last ? (Date.now() - last) : 999999;\n      const fog = clamp(age / 20000, 0, 1);\n\n      ctx.fillStyle = `rgba(0,0,0,${0.28 + fog * 0.60})`;\n      ctx.fillRect(b.x * sx, b.y * sy, b.width * sx, b.height * sy);\n\n      ctx.strokeStyle = 'rgba(232,108,44,0.35)';\n      ctx.lineWidth = 1;\n      ctx.strokeRect(b.x * sx, b.y * sy, b.width * sx, b.height * sy);\n      ctx.restore();\n    }\n\n    // buildings on minimap\n    if (this.cityManager) {\n      for (const building of this.cityManager.getAllBuildings()) {\n        const bx = building.position.x * sx;\n        const by = building.position.y * sy;\n        const bw = (building.size.w * 0.4) * sx;\n        const bh = (building.size.h * 0.4) * sy;\n\n        // Building color based on tier\n        const tierColors = ['rgba(191,87,0,0.7)', 'rgba(217,107,26,0.8)', 'rgba(255,107,53,0.9)'];\n        ctx.fillStyle = tierColors[building.tier - 1] || tierColors[0];\n        ctx.fillRect(bx - bw/2, by - bh/2, bw, bh);\n      }\n    }\n\n    // workers\n    for (const wkr of state.workers.values()) {\n      const x = wkr.position.x * sx;\n      const y = wkr.position.y * sy;\n      const col = wkr.status === 'blocked' ? 'rgba(255,77,77,0.95)'\n        : wkr.status === 'working' ? 'rgba(55,214,122,0.95)'\n        : wkr.status === 'hold' ? 'rgba(247,201,72,0.95)'\n        : wkr.status === 'moving' ? 'rgba(255,177,122,0.95)'\n        : 'rgba(244,244,247,0.75)';\n      ctx.fillStyle = col;\n      ctx.fillRect(x - 2, y - 2, 4, 4);\n    }\n\n    // camera box\n    const mapRect = this.mapCanvas.getBoundingClientRect();\n    const viewW = mapRect.width / this.camera.zoom;\n    const viewH = mapRect.height / this.camera.zoom;\n\n    const vx = (this.camera.x - viewW / 2) * sx;\n    const vy = (this.camera.y - viewH / 2) * sy;\n\n    ctx.strokeStyle = 'rgba(244,244,247,0.65)';\n    ctx.lineWidth = 1;\n    ctx.strokeRect(vx, vy, viewW * sx, viewH * sy);\n  }\n\n  /**\n   * @param {number} clientX\n   * @param {number} clientY\n   */\n  minimapToWorld(clientX, clientY) {\n    const rect = this.minimapCanvas.getBoundingClientRect();\n    const sx = (clientX - rect.left) / rect.width;\n    const sy = (clientY - rect.top) / rect.height;\n\n    return {\n      x: clamp(sx, 0, 1) * this.world.w,\n      y: clamp(sy, 0, 1) * this.world.h,\n    };\n  }\n\n  /**\n   * Find region by world point.\n   * @param {number} wx\n   * @param {number} wy\n   */\n  regionAt(wx, wy) {\n    return regionAt(wx, wy);\n  }\n}\n","import { formatDuration } from './game-state.js';\n\nconst ICONS = {\n  spawn: 'âš¡',\n  task_start: 'â›',\n  task_complete: 'âœ…',\n  error: 'â—',\n  terminate: 'âœ–',\n  command: 'âŒ˜',\n  status: 'â€¢',\n};\n\nfunction el(id) { return document.getElementById(id); }\n\nexport class UIPanels {\n  /**\n   * @param {import('./game-state.js').GameState} state\n   * @param {import('./renderer.js').Renderer} renderer\n   */\n  constructor(state, renderer) {\n    this.state = state;\n    this.renderer = renderer;\n\n    this.$resCompleted = el('resCompleted');\n    this.$resFiles = el('resFiles');\n    this.$resWorkers = el('resWorkers');\n    this.$resFailed = el('resFailed');\n    this.$resDuration = el('resDuration');\n    this.$resTokens = el('resTokens');\n\n    this.$idleAlert = el('idleAlert');\n    this.$idleAlertCount = el('idleAlertCount');\n\n    this.$portraitIcon = el('portraitIcon');\n    this.$portraitName = el('portraitName');\n    this.$portraitTask = el('portraitTask');\n    this.$portraitMeter = el('portraitMeter');\n    this.$portraitStatus = el('portraitStatus');\n    this.$portraitElapsed = el('portraitElapsed');\n    this.$portraitTokens = el('portraitTokens');\n\n    this.$logFeed = el('logFeed');\n    this.$logStatus = el('logStatus');\n\n    this.$scoutReport = el('scoutReport');\n\n    this._idleIndex = 0;\n    this._lastLogRenderKey = '';\n\n    this.$idleAlert.addEventListener('click', () => this.cycleIdle());\n  }\n\n  cycleIdle() {\n    const list = this.state.getIdleOrBlocked();\n    if (!list.length) return;\n    this._idleIndex = (this._idleIndex + 1) % list.length;\n    const w = list[this._idleIndex];\n    this.state.setSelected([w.id]);\n    this.renderer.camera.x = w.position.x;\n    this.renderer.camera.y = w.position.y;\n  }\n\n  render() {\n    const s = this.state;\n\n    // resources\n    this.$resCompleted.textContent = String(s.stats.completed);\n    this.$resFiles.textContent = String(s.stats.files);\n    this.$resWorkers.textContent = String(s.workers.size);\n    this.$resFailed.textContent = String(s.stats.failed);\n    this.$resTokens.textContent = String(s.stats.tokens);\n    this.$resDuration.textContent = formatDuration(s.getSessionDurationMs());\n\n    // idle alert\n    const idleOrBlocked = s.getIdleOrBlocked();\n    if (idleOrBlocked.length) {\n      this.$idleAlert.hidden = false;\n      this.$idleAlertCount.textContent = String(idleOrBlocked.length);\n      const hasBlocked = idleOrBlocked.some(w => w.status === 'blocked');\n      this.$idleAlert.classList.toggle('has-blocked', hasBlocked);\n    } else {\n      this.$idleAlert.hidden = true;\n    }\n\n    // portrait\n    const selected = s.getSelectedWorkers();\n    if (selected.length === 1) {\n      const w = selected[0];\n      this.$portraitIcon.textContent = w.name.slice(0, 1).toUpperCase();\n      this.$portraitName.textContent = w.name;\n      this.$portraitTask.textContent = w.currentTask || 'No current task.';\n      this.$portraitStatus.textContent = w.status;\n      this.$portraitElapsed.textContent = formatDuration(Date.now() - w.spawnedAt);\n      this.$portraitTokens.textContent = String(w.tokensUsed);\n      const pct = (w.progress >= 0 && w.progress <= 100) ? w.progress : 0;\n      this.$portraitMeter.style.width = `${pct}%`;\n      this.$portraitMeter.className = `meter-fill status-${w.status}`;\n    } else if (selected.length > 1) {\n      this.$portraitIcon.textContent = String(selected.length);\n      this.$portraitName.textContent = `${selected.length} units selected`;\n      this.$portraitTask.textContent = 'Multiple tasks.';\n      this.$portraitStatus.textContent = '-';\n      this.$portraitElapsed.textContent = '-';\n      this.$portraitTokens.textContent = '-';\n      this.$portraitMeter.style.width = '0%';\n      this.$portraitMeter.className = 'meter-fill';\n    } else {\n      this.$portraitIcon.textContent = '?';\n      this.$portraitName.textContent = 'No selection';\n      this.$portraitTask.textContent = 'Select a worker on the map.';\n      this.$portraitStatus.textContent = '-';\n      this.$portraitElapsed.textContent = '-';\n      this.$portraitTokens.textContent = '-';\n      this.$portraitMeter.style.width = '0%';\n      this.$portraitMeter.className = 'meter-fill';\n    }\n\n    // scout report (null-safe)\n    if (this.$scoutReport && Array.isArray(s.scout)) {\n      this.$scoutReport.textContent = '';\n      s.scout.forEach((line, idx) => {\n        const div = document.createElement('div');\n        div.className = idx === 0 ? 'scout-line' : 'scout-line muted';\n        div.textContent = line;\n        this.$scoutReport.appendChild(div);\n      });\n    }\n\n    // log\n    const key = `${s.events.length}:${s.selected.size}:${s.workers.size}:${s.stats.completed}:${s.stats.failed}`;\n    if (key !== this._lastLogRenderKey) {\n      this._lastLogRenderKey = key;\n      this.renderLog();\n    }\n  }\n\n  renderLog() {\n    const s = this.state;\n    const max = 80;\n    const items = s.events.slice(0, max);\n\n    this.$logStatus.textContent = s.workers.size ? 'Live' : 'Idle';\n\n    this.$logFeed.innerHTML = items.map(evt => {\n      const icon = ICONS[evt.type] || 'â€¢';\n      const t = new Date(evt.timestamp);\n      const hh = String(t.getHours()).padStart(2,'0');\n      const mm = String(t.getMinutes()).padStart(2,'0');\n      const ss = String(t.getSeconds()).padStart(2,'0');\n      const stamp = `${hh}:${mm}:${ss}`;\n      const cls = evt.type === 'error' ? 'err' : evt.type === 'task_complete' ? 'ok' : evt.type === 'spawn' ? 'spawn' : '';\n\n      return `<button class=\"log-item ${cls}\" data-worker=\"${evt.workerId}\">\n        <span class=\"log-time\">${stamp}</span>\n        <span class=\"log-ico\">${icon}</span>\n        <span class=\"log-text\">${escapeHtml(evt.details)}</span>\n      </button>`;\n    }).join('');\n\n    // click handlers\n    this.$logFeed.querySelectorAll('button.log-item').forEach((b) => {\n      b.addEventListener('click', () => {\n        const wid = b.getAttribute('data-worker');\n        if (!wid) return;\n        const w = s.workers.get(wid);\n        if (!w) return;\n        s.setSelected([wid]);\n        this.renderer.camera.x = w.position.x;\n        this.renderer.camera.y = w.position.y;\n      });\n    });\n  }\n}\n\nfunction escapeHtml(str) {\n  return String(str)\n    .replaceAll('&', '&amp;')\n    .replaceAll('<', '&lt;')\n    .replaceAll('>', '&gt;')\n    .replaceAll('\"', '&quot;')\n    .replaceAll(\"'\", '&#039;');\n}\n","import { REGIONS, randomPointIn, dist, clamp } from './map.js';\n\n/**\n * Mock AgentBridge that simulates Claude subagents.\n * @typedef {import('./game-state.js').GameState} GameState\n */\n\n/**\n * Task definitions with categories that map to building types.\n * Categories: command, production, research, repair, storage, defense\n * @type {{task: string, category: import('./game-state.js').EventCategory}[]}\n */\nconst TASK_DEFS = [\n  // Production tasks (farm, workshop)\n  { task: 'Refactor component boundary', category: 'production' },\n  { task: 'Wire endpoint to UI', category: 'production' },\n  { task: 'Add keyboard shortcuts and focus states', category: 'production' },\n  { task: 'Polish textures and gold frames', category: 'production' },\n  { task: 'Build new feature module', category: 'production' },\n  { task: 'Implement API integration', category: 'production' },\n\n  // Research tasks (library)\n  { task: 'Investigate regression in renderer loop', category: 'research' },\n  { task: 'Hunt down a flaky integration test', category: 'research' },\n  { task: 'Analyze performance bottlenecks', category: 'research' },\n  { task: 'Review architecture decisions', category: 'research' },\n\n  // Repair tasks (forge)\n  { task: 'Fix failing unit tests', category: 'repair' },\n  { task: 'Tighten types and remove implicit any', category: 'repair' },\n  { task: 'Resolve merge conflicts', category: 'repair' },\n  { task: 'Debug memory leak issue', category: 'repair' },\n\n  // Storage tasks (archive)\n  { task: 'Extract state store and event bus', category: 'storage' },\n  { task: 'Trim bundle and remove dead code', category: 'storage' },\n  { task: 'Migrate data to new schema', category: 'storage' },\n  { task: 'Archive deprecated modules', category: 'storage' },\n\n  // Defense tasks (tower)\n  { task: 'Add security validation layer', category: 'defense' },\n  { task: 'Monitor system metrics', category: 'defense' },\n  { task: 'Set up alerting pipelines', category: 'defense' },\n\n  // Command tasks (barracks)\n  { task: 'Coordinate deployment rollout', category: 'command' },\n  { task: 'Orchestrate parallel builds', category: 'command' },\n];\n\nfunction rnd(arr) { return arr[Math.floor(Math.random() * arr.length)]; }\n\nfunction id() {\n  return Math.random().toString(16).slice(2, 10);\n}\n\nfunction now() { return Date.now(); }\n\nfunction pickRegion() {\n  // bias to goldmine + lumber\n  const weighted = [];\n  for (const r of REGIONS) {\n    const w = r.type === 'goldmine' ? 5 : r.type === 'lumber' ? 3 : r.type === 'townhall' ? 2 : 1;\n    for (let i = 0; i < w; i++) weighted.push(r);\n  }\n  return rnd(weighted);\n}\n\n/** @param {number} n */\nfunction formatInt(n) {\n  return n.toLocaleString(undefined, { maximumFractionDigits: 0 });\n}\n\n/**\n * @param {GameState} state\n */\nexport class MockBridge {\n  constructor(state) {\n    this.state = state;\n    this.running = false;\n    this.timers = [];\n\n    /** @type {Map<string, {vx:number,vy:number,goal:{x:number,y:number},speed:number}>} */\n    this.motion = new Map();\n  }\n\n  /**\n   * Manual assignment hook used by the command card (right-click a region).\n   * @param {string[]} workerIds\n   * @param {import('./map.js').MapRegion} region\n   */\n  manualAssign(workerIds, region) {\n    for (const wid of workerIds) {\n      const w = this.state.workers.get(wid);\n      if (!w) continue;\n\n      w.targetRegion = region.id;\n      w.status = 'moving';\n      w.progress = 0;\n      w.errorMessage = null;\n      w.updatedAt = now();\n\n      const goal = randomPointIn(region);\n      this.motion.set(w.id, { vx: 0, vy: 0, goal, speed: 1.7 + Math.random() * 1.8 });\n\n      this.state.upsertWorker({ ...w });\n      this.state.pushEvent({ type: 'command', workerId: w.id, details: `Assigned to ${region.name}.`, category: 'command' });\n    }\n  }\n\n  async connect() {\n    this.running = true;\n\n    // initial trickle\n    this.spawn();\n    this.spawn();\n\n    this.timers.push(setInterval(() => this.maybeSpawn(), 1600));\n    this.timers.push(setInterval(() => this.step(), 50));\n    this.timers.push(setInterval(() => this.heartbeat(), 1000));\n  }\n\n  disconnect() {\n    this.running = false;\n    for (const t of this.timers) clearInterval(t);\n    this.timers = [];\n  }\n\n  maybeSpawn() {\n    if (!this.running) return;\n    const max = 10;\n    if (this.state.workers.size >= max) return;\n    if (Math.random() < 0.35) this.spawn();\n  }\n\n  spawn() {\n    const town = REGIONS.find(r => r.id === 'townhall') || REGIONS[0];\n    const start = randomPointIn(town);\n    const target = pickRegion();\n\n    // Pick a task with its category\n    const taskDef = rnd(TASK_DEFS);\n\n    const wid = `w-${id()}`;\n    const w = {\n      id: wid,\n      name: `Subagent-${Math.floor(1 + Math.random() * 99)}`,\n      status: 'moving',\n      currentTask: taskDef.task,\n      taskCategory: taskDef.category, // Store category for event emission\n      targetRegion: target.id,\n      position: { x: start.x, y: start.y },\n      spawnedAt: now(),\n      tokensUsed: Math.floor(200 + Math.random() * 800),\n      progress: 0,\n      errorMessage: null,\n      updatedAt: now(),\n    };\n\n    this.state.upsertWorker(w);\n    this.state.pushEvent({ type: 'spawn', workerId: w.id, details: `${w.name} rallied.`, category: 'general' });\n\n    // movement goal is a random point in target region\n    const goal = randomPointIn(target);\n    this.motion.set(w.id, { vx: 0, vy: 0, goal, speed: 1.6 + Math.random() * 1.6 });\n  }\n\n  step() {\n    if (!this.running) return;\n\n    for (const w of this.state.workers.values()) {\n      if (w.status === 'terminated') continue;\n\n      // move\n      if (w.status === 'moving') {\n        const m = this.motion.get(w.id);\n        if (!m) continue;\n        const dx = m.goal.x - w.position.x;\n        const dy = m.goal.y - w.position.y;\n        const d = Math.hypot(dx, dy) || 1;\n        const step = m.speed;\n        w.position.x += (dx / d) * step;\n        w.position.y += (dy / d) * step;\n        w.updatedAt = now();\n\n        if (d < 10) {\n          // arrive\n          w.position.x = m.goal.x;\n          w.position.y = m.goal.y;\n          this.motion.delete(w.id);\n          w.status = Math.random() < 0.12 ? 'idle' : 'working';\n          w.progress = w.status === 'working' ? Math.floor(5 + Math.random() * 14) : 0;\n          w.updatedAt = now();\n\n          if (w.status === 'working') {\n            this.state.pushEvent({ type: 'task_start', workerId: w.id, details: `Started: ${w.currentTask}`, category: w.taskCategory || 'production' });\n          } else {\n            this.state.pushEvent({ type: 'status', workerId: w.id, details: `Awaiting orders.`, category: 'general' });\n          }\n        }\n\n        this.state.upsertWorker({ ...w });\n        continue;\n      }\n\n      // hold\n      if (w.status === 'hold') {\n        // slight token burn\n        w.tokensUsed += 1 + Math.floor(Math.random() * 3);\n        w.updatedAt = now();\n        this.state.upsertWorker({ ...w });\n        continue;\n      }\n\n      // idle\n      if (w.status === 'idle') {\n        if (Math.random() < 0.03) {\n          // reassign self with new task\n          const target = pickRegion();\n          const taskDef = rnd(TASK_DEFS);\n          w.targetRegion = target.id;\n          w.status = 'moving';\n          w.currentTask = taskDef.task;\n          w.taskCategory = taskDef.category;\n          w.errorMessage = null;\n          w.updatedAt = now();\n          this.motion.set(w.id, { vx: 0, vy: 0, goal: randomPointIn(target), speed: 1.6 + Math.random() * 1.6 });\n          this.state.pushEvent({ type: 'status', workerId: w.id, details: `Re-tasked.`, category: 'command' });\n        }\n        this.state.upsertWorker({ ...w });\n        continue;\n      }\n\n      // blocked\n      if (w.status === 'blocked') {\n        // sometimes auto-recovers\n        if (Math.random() < 0.02) {\n          w.status = 'working';\n          w.errorMessage = null;\n          w.updatedAt = now();\n          this.state.pushEvent({ type: 'status', workerId: w.id, details: `Recovered; resumed.`, category: 'repair' });\n        }\n        this.state.upsertWorker({ ...w });\n        continue;\n      }\n\n      // working\n      if (w.status === 'working') {\n        w.tokensUsed += 4 + Math.floor(Math.random() * 18);\n        const bump = 0.6 + Math.random() * 2.4;\n        w.progress = clamp(w.progress + bump, 0, 100);\n        w.updatedAt = now();\n\n        // files touched trickle\n        if (Math.random() < 0.12) this.state.bumpFiles(1);\n\n        // occasional failure\n        if (Math.random() < 0.006) {\n          w.status = 'blocked';\n          w.errorMessage = 'Merge conflict in core module.';\n          this.state.bumpFailed(1);\n          this.state.pushEvent({ type: 'error', workerId: w.id, details: `Blocked: ${w.errorMessage}`, category: 'repair' });\n          this.state.upsertWorker({ ...w });\n          continue;\n        }\n\n        if (w.progress >= 100) {\n          w.status = 'complete';\n          w.updatedAt = now();\n          this.state.bumpCompleted(1);\n          this.state.pushEvent({ type: 'task_complete', workerId: w.id, details: `Completed: ${w.currentTask}`, category: w.taskCategory || 'production' });\n\n          // despawn soon\n          setTimeout(() => {\n            if (!this.running) return;\n            const still = this.state.workers.get(w.id);\n            if (!still) return;\n            still.status = 'terminated';\n            still.updatedAt = now();\n            this.state.upsertWorker({ ...still });\n            this.state.pushEvent({ type: 'terminate', workerId: still.id, details: `${still.name} dismissed.`, category: 'general' });\n            setTimeout(() => this.state.removeWorker(still.id), 900);\n          }, 1400);\n        }\n\n        this.state.upsertWorker({ ...w });\n        continue;\n      }\n\n      if (w.status === 'complete') {\n        this.state.upsertWorker({ ...w });\n      }\n    }\n  }\n\n  heartbeat() {\n    this.state.tickStats();\n\n    // keep scout report fresh\n    const idle = this.state.getIdleOrBlocked().filter(w => w.status === 'idle').length;\n    const blocked = this.state.getIdleOrBlocked().filter(w => w.status === 'blocked').length;\n    const active = this.state.workers.size;\n\n    const msg = blocked\n      ? `${formatInt(blocked)} worker${blocked === 1 ? '' : 's'} blocked. Conflicts or missing info.`\n      : idle\n        ? `${formatInt(idle)} worker${idle === 1 ? '' : 's'} idle. Assign tasks to keep momentum.`\n        : `${formatInt(active)} worker${active === 1 ? '' : 's'} executing cleanly.`;\n\n    this.state.pushScoutLine(msg);\n  }\n}\n","/**\n * @typedef {import('./game-state.js').GameState} GameState\n */\n\nexport class CommandCenter {\n  /**\n   * @param {GameState} state\n   * @param {{manualAssign?: (workerIds: string[], region: any) => void}=} bridge\n   */\n  constructor(state, bridge) {\n    this.state = state;\n    this.bridge = bridge || {};\n    this.assignMode = false;\n  }\n\n  /**\n   * @param {'stop'|'hold'|'resume'|'reassign'|'inspect'|'terminate'} cmd\n   */\n  exec(cmd) {\n    const sel = this.state.getSelectedWorkers();\n    if (!sel.length) return;\n\n    if (cmd === 'reassign') {\n      this.assignMode = true;\n      this.state.pushEvent({ type: 'command', workerId: sel[0].id, details: `Assign mode: right-click a region.` });\n      this.state.pushScoutLine('Assign mode: right-click a region to send selected workers.');\n      return;\n    }\n\n    for (const w of sel) {\n      if (cmd === 'stop') {\n        w.status = 'idle';\n        w.progress = 0;\n        w.currentTask = w.currentTask;\n        w.updatedAt = Date.now();\n        this.state.upsertWorker({ ...w });\n        this.state.pushEvent({ type: 'command', workerId: w.id, details: `Stopped.` });\n      }\n\n      if (cmd === 'hold') {\n        if (w.status === 'working' || w.status === 'moving') {\n          w.status = 'hold';\n          w.updatedAt = Date.now();\n          this.state.upsertWorker({ ...w });\n          this.state.pushEvent({ type: 'command', workerId: w.id, details: `Held.` });\n        }\n      }\n\n      if (cmd === 'resume') {\n        if (w.status === 'hold' || w.status === 'idle') {\n          w.status = 'working';\n          w.updatedAt = Date.now();\n          this.state.upsertWorker({ ...w });\n          this.state.pushEvent({ type: 'command', workerId: w.id, details: `Resumed.` });\n        }\n      }\n\n      if (cmd === 'inspect') {\n        const detail = w.errorMessage\n          ? `Inspect: ${w.errorMessage}`\n          : `Inspect: ${w.currentTask || 'No task'}`;\n        this.state.pushEvent({ type: 'command', workerId: w.id, details: detail });\n        this.state.pushScoutLine(detail);\n      }\n\n      if (cmd === 'terminate') {\n        w.status = 'terminated';\n        w.updatedAt = Date.now();\n        this.state.upsertWorker({ ...w });\n        this.state.pushEvent({ type: 'terminate', workerId: w.id, details: `${w.name} terminated.` });\n        setTimeout(() => this.state.removeWorker(w.id), 800);\n      }\n    }\n  }\n\n  /**\n   * @param {import('./map.js').MapRegion} region\n   */\n  assignSelectedTo(region) {\n    const sel = this.state.getSelectedWorkers();\n    if (!sel.length) return;\n\n    const ids = sel.map(w => w.id);\n    if (this.bridge.manualAssign) {\n      this.bridge.manualAssign(ids, region);\n    } else {\n      // fallback: just mark as moving (no pathing)\n      for (const w of sel) {\n        w.targetRegion = region.id;\n        w.status = 'moving';\n        w.updatedAt = Date.now();\n        this.state.upsertWorker({ ...w });\n      }\n      this.state.pushEvent({ type: 'command', workerId: sel[0].id, details: `Assigned to ${region.name}.` });\n    }\n\n    this.assignMode = false;\n  }\n}\n","import {\n\tControls,\n\tMOUSE,\n\tQuaternion,\n\tSpherical,\n\tTOUCH,\n\tVector2,\n\tVector3,\n\tPlane,\n\tRay,\n\tMathUtils\n} from 'three';\n\n// OrbitControls performs orbiting, dollying (zooming), and panning.\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\n//\n//    Orbit - left mouse / touch: one-finger move\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\n\nconst _changeEvent = { type: 'change' };\nconst _startEvent = { type: 'start' };\nconst _endEvent = { type: 'end' };\nconst _ray = new Ray();\nconst _plane = new Plane();\nconst _TILT_LIMIT = Math.cos( 70 * MathUtils.DEG2RAD );\n\nconst _v = new Vector3();\nconst _twoPI = 2 * Math.PI;\n\nconst _STATE = {\n\tNONE: - 1,\n\tROTATE: 0,\n\tDOLLY: 1,\n\tPAN: 2,\n\tTOUCH_ROTATE: 3,\n\tTOUCH_PAN: 4,\n\tTOUCH_DOLLY_PAN: 5,\n\tTOUCH_DOLLY_ROTATE: 6\n};\nconst _EPS = 0.000001;\n\nclass OrbitControls extends Controls {\n\n\tconstructor( object, domElement = null ) {\n\n\t\tsuper( object, domElement );\n\n\t\tthis.state = _STATE.NONE;\n\n\t\t// Set to false to disable this control\n\t\tthis.enabled = true;\n\n\t\t// \"target\" sets the location of focus, where the object orbits around\n\t\tthis.target = new Vector3();\n\n\t\t// Sets the 3D cursor (similar to Blender), from which the maxTargetRadius takes effect\n\t\tthis.cursor = new Vector3();\n\n\t\t// How far you can dolly in and out ( PerspectiveCamera only )\n\t\tthis.minDistance = 0;\n\t\tthis.maxDistance = Infinity;\n\n\t\t// How far you can zoom in and out ( OrthographicCamera only )\n\t\tthis.minZoom = 0;\n\t\tthis.maxZoom = Infinity;\n\n\t\t// Limit camera target within a spherical area around the cursor\n\t\tthis.minTargetRadius = 0;\n\t\tthis.maxTargetRadius = Infinity;\n\n\t\t// How far you can orbit vertically, upper and lower limits.\n\t\t// Range is 0 to Math.PI radians.\n\t\tthis.minPolarAngle = 0; // radians\n\t\tthis.maxPolarAngle = Math.PI; // radians\n\n\t\t// How far you can orbit horizontally, upper and lower limits.\n\t\t// If set, the interval [ min, max ] must be a sub-interval of [ - 2 PI, 2 PI ], with ( max - min < 2 PI )\n\t\tthis.minAzimuthAngle = - Infinity; // radians\n\t\tthis.maxAzimuthAngle = Infinity; // radians\n\n\t\t// Set to true to enable damping (inertia)\n\t\t// If damping is enabled, you must call controls.update() in your animation loop\n\t\tthis.enableDamping = false;\n\t\tthis.dampingFactor = 0.05;\n\n\t\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\n\t\t// Set to false to disable zooming\n\t\tthis.enableZoom = true;\n\t\tthis.zoomSpeed = 1.0;\n\n\t\t// Set to false to disable rotating\n\t\tthis.enableRotate = true;\n\t\tthis.rotateSpeed = 1.0;\n\n\t\t// Set to false to disable panning\n\t\tthis.enablePan = true;\n\t\tthis.panSpeed = 1.0;\n\t\tthis.screenSpacePanning = true; // if false, pan orthogonal to world-space direction camera.up\n\t\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\n\t\tthis.zoomToCursor = false;\n\n\t\t// Set to true to automatically rotate around the target\n\t\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\n\t\tthis.autoRotate = false;\n\t\tthis.autoRotateSpeed = 2.0; // 30 seconds per orbit when fps is 60\n\n\t\t// The four arrow keys\n\t\tthis.keys = { LEFT: 'ArrowLeft', UP: 'ArrowUp', RIGHT: 'ArrowRight', BOTTOM: 'ArrowDown' };\n\n\t\t// Mouse buttons\n\t\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\n\n\t\t// Touch fingers\n\t\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\n\n\t\t// for reset\n\t\tthis.target0 = this.target.clone();\n\t\tthis.position0 = this.object.position.clone();\n\t\tthis.zoom0 = this.object.zoom;\n\n\t\t// the target DOM element for key events\n\t\tthis._domElementKeyEvents = null;\n\n\t\t// internals\n\n\t\tthis._lastPosition = new Vector3();\n\t\tthis._lastQuaternion = new Quaternion();\n\t\tthis._lastTargetPosition = new Vector3();\n\n\t\t// so camera.up is the orbit axis\n\t\tthis._quat = new Quaternion().setFromUnitVectors( object.up, new Vector3( 0, 1, 0 ) );\n\t\tthis._quatInverse = this._quat.clone().invert();\n\n\t\t// current position in spherical coordinates\n\t\tthis._spherical = new Spherical();\n\t\tthis._sphericalDelta = new Spherical();\n\n\t\tthis._scale = 1;\n\t\tthis._panOffset = new Vector3();\n\n\t\tthis._rotateStart = new Vector2();\n\t\tthis._rotateEnd = new Vector2();\n\t\tthis._rotateDelta = new Vector2();\n\n\t\tthis._panStart = new Vector2();\n\t\tthis._panEnd = new Vector2();\n\t\tthis._panDelta = new Vector2();\n\n\t\tthis._dollyStart = new Vector2();\n\t\tthis._dollyEnd = new Vector2();\n\t\tthis._dollyDelta = new Vector2();\n\n\t\tthis._dollyDirection = new Vector3();\n\t\tthis._mouse = new Vector2();\n\t\tthis._performCursorZoom = false;\n\n\t\tthis._pointers = [];\n\t\tthis._pointerPositions = {};\n\n\t\tthis._controlActive = false;\n\n\t\t// event listeners\n\n\t\tthis._onPointerMove = onPointerMove.bind( this );\n\t\tthis._onPointerDown = onPointerDown.bind( this );\n\t\tthis._onPointerUp = onPointerUp.bind( this );\n\t\tthis._onContextMenu = onContextMenu.bind( this );\n\t\tthis._onMouseWheel = onMouseWheel.bind( this );\n\t\tthis._onKeyDown = onKeyDown.bind( this );\n\n\t\tthis._onTouchStart = onTouchStart.bind( this );\n\t\tthis._onTouchMove = onTouchMove.bind( this );\n\n\t\tthis._onMouseDown = onMouseDown.bind( this );\n\t\tthis._onMouseMove = onMouseMove.bind( this );\n\n\t\tthis._interceptControlDown = interceptControlDown.bind( this );\n\t\tthis._interceptControlUp = interceptControlUp.bind( this );\n\n\t\t//\n\n\t\tif ( this.domElement !== null ) {\n\n\t\t\tthis.connect();\n\n\t\t}\n\n\t\tthis.update();\n\n\t}\n\n\tconnect() {\n\n\t\tthis.domElement.addEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.addEventListener( 'pointercancel', this._onPointerUp );\n\n\t\tthis.domElement.addEventListener( 'contextmenu', this._onContextMenu );\n\t\tthis.domElement.addEventListener( 'wheel', this._onMouseWheel, { passive: false } );\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\t\tdocument.addEventListener( 'keydown', this._interceptControlDown, { passive: true, capture: true } );\n\n\t\tthis.domElement.style.touchAction = 'none'; // disable touch scroll\n\n\t}\n\n\tdisconnect() {\n\n\t\tthis.domElement.removeEventListener( 'pointerdown', this._onPointerDown );\n\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\t\tthis.domElement.removeEventListener( 'pointercancel', this._onPointerUp );\n\n\t\tthis.domElement.removeEventListener( 'wheel', this._onMouseWheel );\n\t\tthis.domElement.removeEventListener( 'contextmenu', this._onContextMenu );\n\n\t\tthis.stopListenToKeyEvents();\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\t\tdocument.removeEventListener( 'keydown', this._interceptControlDown, { capture: true } );\n\n\t\tthis.domElement.style.touchAction = 'auto';\n\n\t}\n\n\tdispose() {\n\n\t\tthis.disconnect();\n\n\t}\n\n\tgetPolarAngle() {\n\n\t\treturn this._spherical.phi;\n\n\t}\n\n\tgetAzimuthalAngle() {\n\n\t\treturn this._spherical.theta;\n\n\t}\n\n\tgetDistance() {\n\n\t\treturn this.object.position.distanceTo( this.target );\n\n\t}\n\n\tlistenToKeyEvents( domElement ) {\n\n\t\tdomElement.addEventListener( 'keydown', this._onKeyDown );\n\t\tthis._domElementKeyEvents = domElement;\n\n\t}\n\n\tstopListenToKeyEvents() {\n\n\t\tif ( this._domElementKeyEvents !== null ) {\n\n\t\t\tthis._domElementKeyEvents.removeEventListener( 'keydown', this._onKeyDown );\n\t\t\tthis._domElementKeyEvents = null;\n\n\t\t}\n\n\t}\n\n\tsaveState() {\n\n\t\tthis.target0.copy( this.target );\n\t\tthis.position0.copy( this.object.position );\n\t\tthis.zoom0 = this.object.zoom;\n\n\t}\n\n\treset() {\n\n\t\tthis.target.copy( this.target0 );\n\t\tthis.object.position.copy( this.position0 );\n\t\tthis.object.zoom = this.zoom0;\n\n\t\tthis.object.updateProjectionMatrix();\n\t\tthis.dispatchEvent( _changeEvent );\n\n\t\tthis.update();\n\n\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tupdate( deltaTime = null ) {\n\n\t\tconst position = this.object.position;\n\n\t\t_v.copy( position ).sub( this.target );\n\n\t\t// rotate offset to \"y-axis-is-up\" space\n\t\t_v.applyQuaternion( this._quat );\n\n\t\t// angle from z-axis around y-axis\n\t\tthis._spherical.setFromVector3( _v );\n\n\t\tif ( this.autoRotate && this.state === _STATE.NONE ) {\n\n\t\t\tthis._rotateLeft( this._getAutoRotationAngle( deltaTime ) );\n\n\t\t}\n\n\t\tif ( this.enableDamping ) {\n\n\t\t\tthis._spherical.theta += this._sphericalDelta.theta * this.dampingFactor;\n\t\t\tthis._spherical.phi += this._sphericalDelta.phi * this.dampingFactor;\n\n\t\t} else {\n\n\t\t\tthis._spherical.theta += this._sphericalDelta.theta;\n\t\t\tthis._spherical.phi += this._sphericalDelta.phi;\n\n\t\t}\n\n\t\t// restrict theta to be between desired limits\n\n\t\tlet min = this.minAzimuthAngle;\n\t\tlet max = this.maxAzimuthAngle;\n\n\t\tif ( isFinite( min ) && isFinite( max ) ) {\n\n\t\t\tif ( min < - Math.PI ) min += _twoPI; else if ( min > Math.PI ) min -= _twoPI;\n\n\t\t\tif ( max < - Math.PI ) max += _twoPI; else if ( max > Math.PI ) max -= _twoPI;\n\n\t\t\tif ( min <= max ) {\n\n\t\t\t\tthis._spherical.theta = Math.max( min, Math.min( max, this._spherical.theta ) );\n\n\t\t\t} else {\n\n\t\t\t\tthis._spherical.theta = ( this._spherical.theta > ( min + max ) / 2 ) ?\n\t\t\t\t\tMath.max( min, this._spherical.theta ) :\n\t\t\t\t\tMath.min( max, this._spherical.theta );\n\n\t\t\t}\n\n\t\t}\n\n\t\t// restrict phi to be between desired limits\n\t\tthis._spherical.phi = Math.max( this.minPolarAngle, Math.min( this.maxPolarAngle, this._spherical.phi ) );\n\n\t\tthis._spherical.makeSafe();\n\n\n\t\t// move target to panned location\n\n\t\tif ( this.enableDamping === true ) {\n\n\t\t\tthis.target.addScaledVector( this._panOffset, this.dampingFactor );\n\n\t\t} else {\n\n\t\t\tthis.target.add( this._panOffset );\n\n\t\t}\n\n\t\t// Limit the target distance from the cursor to create a sphere around the center of interest\n\t\tthis.target.sub( this.cursor );\n\t\tthis.target.clampLength( this.minTargetRadius, this.maxTargetRadius );\n\t\tthis.target.add( this.cursor );\n\n\t\tlet zoomChanged = false;\n\t\t// adjust the camera position based on zoom only if we're not zooming to the cursor or if it's an ortho camera\n\t\t// we adjust zoom later in these cases\n\t\tif ( this.zoomToCursor && this._performCursorZoom || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._spherical.radius = this._clampDistance( this._spherical.radius );\n\n\t\t} else {\n\n\t\t\tconst prevRadius = this._spherical.radius;\n\t\t\tthis._spherical.radius = this._clampDistance( this._spherical.radius * this._scale );\n\t\t\tzoomChanged = prevRadius != this._spherical.radius;\n\n\t\t}\n\n\t\t_v.setFromSpherical( this._spherical );\n\n\t\t// rotate offset back to \"camera-up-vector-is-up\" space\n\t\t_v.applyQuaternion( this._quatInverse );\n\n\t\tposition.copy( this.target ).add( _v );\n\n\t\tthis.object.lookAt( this.target );\n\n\t\tif ( this.enableDamping === true ) {\n\n\t\t\tthis._sphericalDelta.theta *= ( 1 - this.dampingFactor );\n\t\t\tthis._sphericalDelta.phi *= ( 1 - this.dampingFactor );\n\n\t\t\tthis._panOffset.multiplyScalar( 1 - this.dampingFactor );\n\n\t\t} else {\n\n\t\t\tthis._sphericalDelta.set( 0, 0, 0 );\n\n\t\t\tthis._panOffset.set( 0, 0, 0 );\n\n\t\t}\n\n\t\t// adjust camera position\n\t\tif ( this.zoomToCursor && this._performCursorZoom ) {\n\n\t\t\tlet newRadius = null;\n\t\t\tif ( this.object.isPerspectiveCamera ) {\n\n\t\t\t\t// move the camera down the pointer ray\n\t\t\t\t// this method avoids floating point error\n\t\t\t\tconst prevRadius = _v.length();\n\t\t\t\tnewRadius = this._clampDistance( prevRadius * this._scale );\n\n\t\t\t\tconst radiusDelta = prevRadius - newRadius;\n\t\t\t\tthis.object.position.addScaledVector( this._dollyDirection, radiusDelta );\n\t\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\t\tzoomChanged = !! radiusDelta;\n\n\t\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\t\t// adjust the ortho camera position based on zoom changes\n\t\t\t\tconst mouseBefore = new Vector3( this._mouse.x, this._mouse.y, 0 );\n\t\t\t\tmouseBefore.unproject( this.object );\n\n\t\t\t\tconst prevZoom = this.object.zoom;\n\t\t\t\tthis.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );\n\t\t\t\tthis.object.updateProjectionMatrix();\n\n\t\t\t\tzoomChanged = prevZoom !== this.object.zoom;\n\n\t\t\t\tconst mouseAfter = new Vector3( this._mouse.x, this._mouse.y, 0 );\n\t\t\t\tmouseAfter.unproject( this.object );\n\n\t\t\t\tthis.object.position.sub( mouseAfter ).add( mouseBefore );\n\t\t\t\tthis.object.updateMatrixWorld();\n\n\t\t\t\tnewRadius = _v.length();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled.' );\n\t\t\t\tthis.zoomToCursor = false;\n\n\t\t\t}\n\n\t\t\t// handle the placement of the target\n\t\t\tif ( newRadius !== null ) {\n\n\t\t\t\tif ( this.screenSpacePanning ) {\n\n\t\t\t\t\t// position the orbit target in front of the new camera position\n\t\t\t\t\tthis.target.set( 0, 0, - 1 )\n\t\t\t\t\t\t.transformDirection( this.object.matrix )\n\t\t\t\t\t\t.multiplyScalar( newRadius )\n\t\t\t\t\t\t.add( this.object.position );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// get the ray and translation plane to compute target\n\t\t\t\t\t_ray.origin.copy( this.object.position );\n\t\t\t\t\t_ray.direction.set( 0, 0, - 1 ).transformDirection( this.object.matrix );\n\n\t\t\t\t\t// if the camera is 20 degrees above the horizon then don't adjust the focus target to avoid\n\t\t\t\t\t// extremely large values\n\t\t\t\t\tif ( Math.abs( this.object.up.dot( _ray.direction ) ) < _TILT_LIMIT ) {\n\n\t\t\t\t\t\tthis.object.lookAt( this.target );\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t_plane.setFromNormalAndCoplanarPoint( this.object.up, this.target );\n\t\t\t\t\t\t_ray.intersectPlane( _plane, this.target );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\tconst prevZoom = this.object.zoom;\n\t\t\tthis.object.zoom = Math.max( this.minZoom, Math.min( this.maxZoom, this.object.zoom / this._scale ) );\n\n\t\t\tif ( prevZoom !== this.object.zoom ) {\n\n\t\t\t\tthis.object.updateProjectionMatrix();\n\t\t\t\tzoomChanged = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis._scale = 1;\n\t\tthis._performCursorZoom = false;\n\n\t\t// update condition is:\n\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\n\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\n\n\t\tif ( zoomChanged ||\n\t\t\tthis._lastPosition.distanceToSquared( this.object.position ) > _EPS ||\n\t\t\t8 * ( 1 - this._lastQuaternion.dot( this.object.quaternion ) ) > _EPS ||\n\t\t\tthis._lastTargetPosition.distanceToSquared( this.target ) > _EPS ) {\n\n\t\t\tthis.dispatchEvent( _changeEvent );\n\n\t\t\tthis._lastPosition.copy( this.object.position );\n\t\t\tthis._lastQuaternion.copy( this.object.quaternion );\n\t\t\tthis._lastTargetPosition.copy( this.target );\n\n\t\t\treturn true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t_getAutoRotationAngle( deltaTime ) {\n\n\t\tif ( deltaTime !== null ) {\n\n\t\t\treturn ( _twoPI / 60 * this.autoRotateSpeed ) * deltaTime;\n\n\t\t} else {\n\n\t\t\treturn _twoPI / 60 / 60 * this.autoRotateSpeed;\n\n\t\t}\n\n\t}\n\n\t_getZoomScale( delta ) {\n\n\t\tconst normalizedDelta = Math.abs( delta * 0.01 );\n\t\treturn Math.pow( 0.95, this.zoomSpeed * normalizedDelta );\n\n\t}\n\n\t_rotateLeft( angle ) {\n\n\t\tthis._sphericalDelta.theta -= angle;\n\n\t}\n\n\t_rotateUp( angle ) {\n\n\t\tthis._sphericalDelta.phi -= angle;\n\n\t}\n\n\t_panLeft( distance, objectMatrix ) {\n\n\t\t_v.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\n\t\t_v.multiplyScalar( - distance );\n\n\t\tthis._panOffset.add( _v );\n\n\t}\n\n\t_panUp( distance, objectMatrix ) {\n\n\t\tif ( this.screenSpacePanning === true ) {\n\n\t\t\t_v.setFromMatrixColumn( objectMatrix, 1 );\n\n\t\t} else {\n\n\t\t\t_v.setFromMatrixColumn( objectMatrix, 0 );\n\t\t\t_v.crossVectors( this.object.up, _v );\n\n\t\t}\n\n\t\t_v.multiplyScalar( distance );\n\n\t\tthis._panOffset.add( _v );\n\n\t}\n\n\t// deltaX and deltaY are in pixels; right and down are positive\n\t_pan( deltaX, deltaY ) {\n\n\t\tconst element = this.domElement;\n\n\t\tif ( this.object.isPerspectiveCamera ) {\n\n\t\t\t// perspective\n\t\t\tconst position = this.object.position;\n\t\t\t_v.copy( position ).sub( this.target );\n\t\t\tlet targetDistance = _v.length();\n\n\t\t\t// half of the fov is center to top of screen\n\t\t\ttargetDistance *= Math.tan( ( this.object.fov / 2 ) * Math.PI / 180.0 );\n\n\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\n\t\t\tthis._panLeft( 2 * deltaX * targetDistance / element.clientHeight, this.object.matrix );\n\t\t\tthis._panUp( 2 * deltaY * targetDistance / element.clientHeight, this.object.matrix );\n\n\t\t} else if ( this.object.isOrthographicCamera ) {\n\n\t\t\t// orthographic\n\t\t\tthis._panLeft( deltaX * ( this.object.right - this.object.left ) / this.object.zoom / element.clientWidth, this.object.matrix );\n\t\t\tthis._panUp( deltaY * ( this.object.top - this.object.bottom ) / this.object.zoom / element.clientHeight, this.object.matrix );\n\n\t\t} else {\n\n\t\t\t// camera neither orthographic nor perspective\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\n\t\t\tthis.enablePan = false;\n\n\t\t}\n\n\t}\n\n\t_dollyOut( dollyScale ) {\n\n\t\tif ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._scale /= dollyScale;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tthis.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t_dollyIn( dollyScale ) {\n\n\t\tif ( this.object.isPerspectiveCamera || this.object.isOrthographicCamera ) {\n\n\t\t\tthis._scale *= dollyScale;\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\n\t\t\tthis.enableZoom = false;\n\n\t\t}\n\n\t}\n\n\t_updateZoomParameters( x, y ) {\n\n\t\tif ( ! this.zoomToCursor ) {\n\n\t\t\treturn;\n\n\t\t}\n\n\t\tthis._performCursorZoom = true;\n\n\t\tconst rect = this.domElement.getBoundingClientRect();\n\t\tconst dx = x - rect.left;\n\t\tconst dy = y - rect.top;\n\t\tconst w = rect.width;\n\t\tconst h = rect.height;\n\n\t\tthis._mouse.x = ( dx / w ) * 2 - 1;\n\t\tthis._mouse.y = - ( dy / h ) * 2 + 1;\n\n\t\tthis._dollyDirection.set( this._mouse.x, this._mouse.y, 1 ).unproject( this.object ).sub( this.object.position ).normalize();\n\n\t}\n\n\t_clampDistance( dist ) {\n\n\t\treturn Math.max( this.minDistance, Math.min( this.maxDistance, dist ) );\n\n\t}\n\n\t//\n\t// event callbacks - update the object state\n\t//\n\n\t_handleMouseDownRotate( event ) {\n\n\t\tthis._rotateStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseDownDolly( event ) {\n\n\t\tthis._updateZoomParameters( event.clientX, event.clientX );\n\t\tthis._dollyStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseDownPan( event ) {\n\n\t\tthis._panStart.set( event.clientX, event.clientY );\n\n\t}\n\n\t_handleMouseMoveRotate( event ) {\n\n\t\tthis._rotateEnd.set( event.clientX, event.clientY );\n\n\t\tthis._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );\n\n\t\tconst element = this.domElement;\n\n\t\tthis._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tthis._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );\n\n\t\tthis._rotateStart.copy( this._rotateEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseMoveDolly( event ) {\n\n\t\tthis._dollyEnd.set( event.clientX, event.clientY );\n\n\t\tthis._dollyDelta.subVectors( this._dollyEnd, this._dollyStart );\n\n\t\tif ( this._dollyDelta.y > 0 ) {\n\n\t\t\tthis._dollyOut( this._getZoomScale( this._dollyDelta.y ) );\n\n\t\t} else if ( this._dollyDelta.y < 0 ) {\n\n\t\t\tthis._dollyIn( this._getZoomScale( this._dollyDelta.y ) );\n\n\t\t}\n\n\t\tthis._dollyStart.copy( this._dollyEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseMovePan( event ) {\n\n\t\tthis._panEnd.set( event.clientX, event.clientY );\n\n\t\tthis._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );\n\n\t\tthis._pan( this._panDelta.x, this._panDelta.y );\n\n\t\tthis._panStart.copy( this._panEnd );\n\n\t\tthis.update();\n\n\t}\n\n\t_handleMouseWheel( event ) {\n\n\t\tthis._updateZoomParameters( event.clientX, event.clientY );\n\n\t\tif ( event.deltaY < 0 ) {\n\n\t\t\tthis._dollyIn( this._getZoomScale( event.deltaY ) );\n\n\t\t} else if ( event.deltaY > 0 ) {\n\n\t\t\tthis._dollyOut( this._getZoomScale( event.deltaY ) );\n\n\t\t}\n\n\t\tthis.update();\n\n\t}\n\n\t_handleKeyDown( event ) {\n\n\t\tlet needsUpdate = false;\n\n\t\tswitch ( event.code ) {\n\n\t\t\tcase this.keys.UP:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tthis._rotateUp( _twoPI * this.rotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._pan( 0, this.keyPanSpeed );\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.BOTTOM:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tthis._rotateUp( - _twoPI * this.rotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._pan( 0, - this.keyPanSpeed );\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.LEFT:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tthis._rotateLeft( _twoPI * this.rotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._pan( this.keyPanSpeed, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t\tcase this.keys.RIGHT:\n\n\t\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\t\tthis._rotateLeft( - _twoPI * this.rotateSpeed / this.domElement.clientHeight );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthis._pan( - this.keyPanSpeed, 0 );\n\n\t\t\t\t}\n\n\t\t\t\tneedsUpdate = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tif ( needsUpdate ) {\n\n\t\t\t// prevent the browser from scrolling on cursor keys\n\t\t\tevent.preventDefault();\n\n\t\t\tthis.update();\n\n\t\t}\n\n\n\t}\n\n\t_handleTouchStartRotate( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._rotateStart.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._rotateStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\t_handleTouchStartPan( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._panStart.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._panStart.set( x, y );\n\n\t\t}\n\n\t}\n\n\t_handleTouchStartDolly( event ) {\n\n\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\tconst dx = event.pageX - position.x;\n\t\tconst dy = event.pageY - position.y;\n\n\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tthis._dollyStart.set( 0, distance );\n\n\t}\n\n\t_handleTouchStartDollyPan( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchStartDolly( event );\n\n\t\tif ( this.enablePan ) this._handleTouchStartPan( event );\n\n\t}\n\n\t_handleTouchStartDollyRotate( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchStartDolly( event );\n\n\t\tif ( this.enableRotate ) this._handleTouchStartRotate( event );\n\n\t}\n\n\t_handleTouchMoveRotate( event ) {\n\n\t\tif ( this._pointers.length == 1 ) {\n\n\t\t\tthis._rotateEnd.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._rotateEnd.set( x, y );\n\n\t\t}\n\n\t\tthis._rotateDelta.subVectors( this._rotateEnd, this._rotateStart ).multiplyScalar( this.rotateSpeed );\n\n\t\tconst element = this.domElement;\n\n\t\tthis._rotateLeft( _twoPI * this._rotateDelta.x / element.clientHeight ); // yes, height\n\n\t\tthis._rotateUp( _twoPI * this._rotateDelta.y / element.clientHeight );\n\n\t\tthis._rotateStart.copy( this._rotateEnd );\n\n\t}\n\n\t_handleTouchMovePan( event ) {\n\n\t\tif ( this._pointers.length === 1 ) {\n\n\t\t\tthis._panEnd.set( event.pageX, event.pageY );\n\n\t\t} else {\n\n\t\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\t\tconst x = 0.5 * ( event.pageX + position.x );\n\t\t\tconst y = 0.5 * ( event.pageY + position.y );\n\n\t\t\tthis._panEnd.set( x, y );\n\n\t\t}\n\n\t\tthis._panDelta.subVectors( this._panEnd, this._panStart ).multiplyScalar( this.panSpeed );\n\n\t\tthis._pan( this._panDelta.x, this._panDelta.y );\n\n\t\tthis._panStart.copy( this._panEnd );\n\n\t}\n\n\t_handleTouchMoveDolly( event ) {\n\n\t\tconst position = this._getSecondPointerPosition( event );\n\n\t\tconst dx = event.pageX - position.x;\n\t\tconst dy = event.pageY - position.y;\n\n\t\tconst distance = Math.sqrt( dx * dx + dy * dy );\n\n\t\tthis._dollyEnd.set( 0, distance );\n\n\t\tthis._dollyDelta.set( 0, Math.pow( this._dollyEnd.y / this._dollyStart.y, this.zoomSpeed ) );\n\n\t\tthis._dollyOut( this._dollyDelta.y );\n\n\t\tthis._dollyStart.copy( this._dollyEnd );\n\n\t\tconst centerX = ( event.pageX + position.x ) * 0.5;\n\t\tconst centerY = ( event.pageY + position.y ) * 0.5;\n\n\t\tthis._updateZoomParameters( centerX, centerY );\n\n\t}\n\n\t_handleTouchMoveDollyPan( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchMoveDolly( event );\n\n\t\tif ( this.enablePan ) this._handleTouchMovePan( event );\n\n\t}\n\n\t_handleTouchMoveDollyRotate( event ) {\n\n\t\tif ( this.enableZoom ) this._handleTouchMoveDolly( event );\n\n\t\tif ( this.enableRotate ) this._handleTouchMoveRotate( event );\n\n\t}\n\n\t// pointers\n\n\t_addPointer( event ) {\n\n\t\tthis._pointers.push( event.pointerId );\n\n\t}\n\n\t_removePointer( event ) {\n\n\t\tdelete this._pointerPositions[ event.pointerId ];\n\n\t\tfor ( let i = 0; i < this._pointers.length; i ++ ) {\n\n\t\t\tif ( this._pointers[ i ] == event.pointerId ) {\n\n\t\t\t\tthis._pointers.splice( i, 1 );\n\t\t\t\treturn;\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_isTrackingPointer( event ) {\n\n\t\tfor ( let i = 0; i < this._pointers.length; i ++ ) {\n\n\t\t\tif ( this._pointers[ i ] == event.pointerId ) return true;\n\n\t\t}\n\n\t\treturn false;\n\n\t}\n\n\t_trackPointer( event ) {\n\n\t\tlet position = this._pointerPositions[ event.pointerId ];\n\n\t\tif ( position === undefined ) {\n\n\t\t\tposition = new Vector2();\n\t\t\tthis._pointerPositions[ event.pointerId ] = position;\n\n\t\t}\n\n\t\tposition.set( event.pageX, event.pageY );\n\n\t}\n\n\t_getSecondPointerPosition( event ) {\n\n\t\tconst pointerId = ( event.pointerId === this._pointers[ 0 ] ) ? this._pointers[ 1 ] : this._pointers[ 0 ];\n\n\t\treturn this._pointerPositions[ pointerId ];\n\n\t}\n\n\t//\n\n\t_customWheelEvent( event ) {\n\n\t\tconst mode = event.deltaMode;\n\n\t\t// minimal wheel event altered to meet delta-zoom demand\n\t\tconst newEvent = {\n\t\t\tclientX: event.clientX,\n\t\t\tclientY: event.clientY,\n\t\t\tdeltaY: event.deltaY,\n\t\t};\n\n\t\tswitch ( mode ) {\n\n\t\t\tcase 1: // LINE_MODE\n\t\t\t\tnewEvent.deltaY *= 16;\n\t\t\t\tbreak;\n\n\t\t\tcase 2: // PAGE_MODE\n\t\t\t\tnewEvent.deltaY *= 100;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t// detect if event was triggered by pinching\n\t\tif ( event.ctrlKey && ! this._controlActive ) {\n\n\t\t\tnewEvent.deltaY *= 10;\n\n\t\t}\n\n\t\treturn newEvent;\n\n\t}\n\n}\n\nfunction onPointerDown( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tif ( this._pointers.length === 0 ) {\n\n\t\tthis.domElement.setPointerCapture( event.pointerId );\n\n\t\tthis.domElement.addEventListener( 'pointermove', this._onPointerMove );\n\t\tthis.domElement.addEventListener( 'pointerup', this._onPointerUp );\n\n\t}\n\n\t//\n\n\tif ( this._isTrackingPointer( event ) ) return;\n\n\t//\n\n\tthis._addPointer( event );\n\n\tif ( event.pointerType === 'touch' ) {\n\n\t\tthis._onTouchStart( event );\n\n\t} else {\n\n\t\tthis._onMouseDown( event );\n\n\t}\n\n}\n\nfunction onPointerMove( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tif ( event.pointerType === 'touch' ) {\n\n\t\tthis._onTouchMove( event );\n\n\t} else {\n\n\t\tthis._onMouseMove( event );\n\n\t}\n\n}\n\nfunction onPointerUp( event ) {\n\n\tthis._removePointer( event );\n\n\tswitch ( this._pointers.length ) {\n\n\t\tcase 0:\n\n\t\t\tthis.domElement.releasePointerCapture( event.pointerId );\n\n\t\t\tthis.domElement.removeEventListener( 'pointermove', this._onPointerMove );\n\t\t\tthis.domElement.removeEventListener( 'pointerup', this._onPointerUp );\n\n\t\t\tthis.dispatchEvent( _endEvent );\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t\t\tbreak;\n\n\t\tcase 1:\n\n\t\t\tconst pointerId = this._pointers[ 0 ];\n\t\t\tconst position = this._pointerPositions[ pointerId ];\n\n\t\t\t// minimal placeholder event - allows state correction on pointer-up\n\t\t\tthis._onTouchStart( { pointerId: pointerId, pageX: position.x, pageY: position.y } );\n\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onMouseDown( event ) {\n\n\tlet mouseAction;\n\n\tswitch ( event.button ) {\n\n\t\tcase 0:\n\n\t\t\tmouseAction = this.mouseButtons.LEFT;\n\t\t\tbreak;\n\n\t\tcase 1:\n\n\t\t\tmouseAction = this.mouseButtons.MIDDLE;\n\t\t\tbreak;\n\n\t\tcase 2:\n\n\t\t\tmouseAction = this.mouseButtons.RIGHT;\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tmouseAction = - 1;\n\n\t}\n\n\tswitch ( mouseAction ) {\n\n\t\tcase MOUSE.DOLLY:\n\n\t\t\tif ( this.enableZoom === false ) return;\n\n\t\t\tthis._handleMouseDownDolly( event );\n\n\t\t\tthis.state = _STATE.DOLLY;\n\n\t\t\tbreak;\n\n\t\tcase MOUSE.ROTATE:\n\n\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\tthis._handleMouseDownPan( event );\n\n\t\t\t\tthis.state = _STATE.PAN;\n\n\t\t\t} else {\n\n\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\tthis._handleMouseDownRotate( event );\n\n\t\t\t\tthis.state = _STATE.ROTATE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase MOUSE.PAN:\n\n\t\t\tif ( event.ctrlKey || event.metaKey || event.shiftKey ) {\n\n\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\tthis._handleMouseDownRotate( event );\n\n\t\t\t\tthis.state = _STATE.ROTATE;\n\n\t\t\t} else {\n\n\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\tthis._handleMouseDownPan( event );\n\n\t\t\t\tthis.state = _STATE.PAN;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tif ( this.state !== _STATE.NONE ) {\n\n\t\tthis.dispatchEvent( _startEvent );\n\n\t}\n\n}\n\nfunction onMouseMove( event ) {\n\n\tswitch ( this.state ) {\n\n\t\tcase _STATE.ROTATE:\n\n\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\tthis._handleMouseMoveRotate( event );\n\n\t\t\tbreak;\n\n\t\tcase _STATE.DOLLY:\n\n\t\t\tif ( this.enableZoom === false ) return;\n\n\t\t\tthis._handleMouseMoveDolly( event );\n\n\t\t\tbreak;\n\n\t\tcase _STATE.PAN:\n\n\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\tthis._handleMouseMovePan( event );\n\n\t\t\tbreak;\n\n\t}\n\n}\n\nfunction onMouseWheel( event ) {\n\n\tif ( this.enabled === false || this.enableZoom === false || this.state !== _STATE.NONE ) return;\n\n\tevent.preventDefault();\n\n\tthis.dispatchEvent( _startEvent );\n\n\tthis._handleMouseWheel( this._customWheelEvent( event ) );\n\n\tthis.dispatchEvent( _endEvent );\n\n}\n\nfunction onKeyDown( event ) {\n\n\tif ( this.enabled === false || this.enablePan === false ) return;\n\n\tthis._handleKeyDown( event );\n\n}\n\nfunction onTouchStart( event ) {\n\n\tthis._trackPointer( event );\n\n\tswitch ( this._pointers.length ) {\n\n\t\tcase 1:\n\n\t\t\tswitch ( this.touches.ONE ) {\n\n\t\t\t\tcase TOUCH.ROTATE:\n\n\t\t\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartRotate( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_ROTATE;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TOUCH.PAN:\n\n\t\t\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartPan( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_PAN;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tthis.state = _STATE.NONE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tcase 2:\n\n\t\t\tswitch ( this.touches.TWO ) {\n\n\t\t\t\tcase TOUCH.DOLLY_PAN:\n\n\t\t\t\t\tif ( this.enableZoom === false && this.enablePan === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartDollyPan( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_DOLLY_PAN;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase TOUCH.DOLLY_ROTATE:\n\n\t\t\t\t\tif ( this.enableZoom === false && this.enableRotate === false ) return;\n\n\t\t\t\t\tthis._handleTouchStartDollyRotate( event );\n\n\t\t\t\t\tthis.state = _STATE.TOUCH_DOLLY_ROTATE;\n\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\n\t\t\t\t\tthis.state = _STATE.NONE;\n\n\t\t\t}\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n\tif ( this.state !== _STATE.NONE ) {\n\n\t\tthis.dispatchEvent( _startEvent );\n\n\t}\n\n}\n\nfunction onTouchMove( event ) {\n\n\tthis._trackPointer( event );\n\n\tswitch ( this.state ) {\n\n\t\tcase _STATE.TOUCH_ROTATE:\n\n\t\t\tif ( this.enableRotate === false ) return;\n\n\t\t\tthis._handleTouchMoveRotate( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_PAN:\n\n\t\t\tif ( this.enablePan === false ) return;\n\n\t\t\tthis._handleTouchMovePan( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_DOLLY_PAN:\n\n\t\t\tif ( this.enableZoom === false && this.enablePan === false ) return;\n\n\t\t\tthis._handleTouchMoveDollyPan( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tcase _STATE.TOUCH_DOLLY_ROTATE:\n\n\t\t\tif ( this.enableZoom === false && this.enableRotate === false ) return;\n\n\t\t\tthis._handleTouchMoveDollyRotate( event );\n\n\t\t\tthis.update();\n\n\t\t\tbreak;\n\n\t\tdefault:\n\n\t\t\tthis.state = _STATE.NONE;\n\n\t}\n\n}\n\nfunction onContextMenu( event ) {\n\n\tif ( this.enabled === false ) return;\n\n\tevent.preventDefault();\n\n}\n\nfunction interceptControlDown( event ) {\n\n\tif ( event.key === 'Control' ) {\n\n\t\tthis._controlActive = true;\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\n\t\tdocument.addEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );\n\n\t}\n\n}\n\nfunction interceptControlUp( event ) {\n\n\tif ( event.key === 'Control' ) {\n\n\t\tthis._controlActive = false;\n\n\t\tconst document = this.domElement.getRootNode(); // offscreen canvas compatibility\n\n\t\tdocument.removeEventListener( 'keyup', this._interceptControlUp, { passive: true, capture: true } );\n\n\t}\n\n}\n\nexport { OrbitControls };\n","import {\n\tDataTextureLoader,\n\tDataUtils,\n\tFloatType,\n\tHalfFloatType,\n\tLinearFilter,\n\tLinearSRGBColorSpace\n} from 'three';\n\n// https://github.com/mrdoob/three.js/issues/5552\n// http://en.wikipedia.org/wiki/RGBE_image_format\n\nclass RGBELoader extends DataTextureLoader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.type = HalfFloatType;\n\n\t}\n\n\t// adapted from http://www.graphics.cornell.edu/~bjw/rgbe.html\n\n\tparse( buffer ) {\n\n\t\tconst\n\t\t\t/* default error routine.  change this to change error handling */\n\t\t\trgbe_read_error = 1,\n\t\t\trgbe_write_error = 2,\n\t\t\trgbe_format_error = 3,\n\t\t\trgbe_memory_error = 4,\n\t\t\trgbe_error = function ( rgbe_error_code, msg ) {\n\n\t\t\t\tswitch ( rgbe_error_code ) {\n\n\t\t\t\t\tcase rgbe_read_error: throw new Error( 'THREE.RGBELoader: Read Error: ' + ( msg || '' ) );\n\t\t\t\t\tcase rgbe_write_error: throw new Error( 'THREE.RGBELoader: Write Error: ' + ( msg || '' ) );\n\t\t\t\t\tcase rgbe_format_error: throw new Error( 'THREE.RGBELoader: Bad File Format: ' + ( msg || '' ) );\n\t\t\t\t\tdefault:\n\t\t\t\t\tcase rgbe_memory_error: throw new Error( 'THREE.RGBELoader: Memory Error: ' + ( msg || '' ) );\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\t/* offsets to red, green, and blue components in a data (float) pixel */\n\t\t\t//RGBE_DATA_RED = 0,\n\t\t\t//RGBE_DATA_GREEN = 1,\n\t\t\t//RGBE_DATA_BLUE = 2,\n\n\t\t\t/* number of floats per pixel, use 4 since stored in rgba image format */\n\t\t\t//RGBE_DATA_SIZE = 4,\n\n\t\t\t/* flags indicating which fields in an rgbe_header_info are valid */\n\t\t\tRGBE_VALID_PROGRAMTYPE = 1,\n\t\t\tRGBE_VALID_FORMAT = 2,\n\t\t\tRGBE_VALID_DIMENSIONS = 4,\n\n\t\t\tNEWLINE = '\\n',\n\n\t\t\tfgets = function ( buffer, lineLimit, consume ) {\n\n\t\t\t\tconst chunkSize = 128;\n\n\t\t\t\tlineLimit = ! lineLimit ? 1024 : lineLimit;\n\t\t\t\tlet p = buffer.pos,\n\t\t\t\t\ti = - 1, len = 0, s = '',\n\t\t\t\t\tchunk = String.fromCharCode.apply( null, new Uint16Array( buffer.subarray( p, p + chunkSize ) ) );\n\n\t\t\t\twhile ( ( 0 > ( i = chunk.indexOf( NEWLINE ) ) ) && ( len < lineLimit ) && ( p < buffer.byteLength ) ) {\n\n\t\t\t\t\ts += chunk; len += chunk.length;\n\t\t\t\t\tp += chunkSize;\n\t\t\t\t\tchunk += String.fromCharCode.apply( null, new Uint16Array( buffer.subarray( p, p + chunkSize ) ) );\n\n\t\t\t\t}\n\n\t\t\t\tif ( - 1 < i ) {\n\n\t\t\t\t\t/*for (i=l-1; i>=0; i--) {\n\t\t\t\t\t\tbyteCode = m.charCodeAt(i);\n\t\t\t\t\t\tif (byteCode > 0x7f && byteCode <= 0x7ff) byteLen++;\n\t\t\t\t\t\telse if (byteCode > 0x7ff && byteCode <= 0xffff) byteLen += 2;\n\t\t\t\t\t\tif (byteCode >= 0xDC00 && byteCode <= 0xDFFF) i--; //trail surrogate\n\t\t\t\t\t}*/\n\t\t\t\t\tif ( false !== consume ) buffer.pos += len + i + 1;\n\t\t\t\t\treturn s + chunk.slice( 0, i );\n\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\n\t\t\t},\n\n\t\t\t/* minimal header reading.  modify if you want to parse more information */\n\t\t\tRGBE_ReadHeader = function ( buffer ) {\n\n\n\t\t\t\t// regexes to parse header info fields\n\t\t\t\tconst magic_token_re = /^#\\?(\\S+)/,\n\t\t\t\t\tgamma_re = /^\\s*GAMMA\\s*=\\s*(\\d+(\\.\\d+)?)\\s*$/,\n\t\t\t\t\texposure_re = /^\\s*EXPOSURE\\s*=\\s*(\\d+(\\.\\d+)?)\\s*$/,\n\t\t\t\t\tformat_re = /^\\s*FORMAT=(\\S+)\\s*$/,\n\t\t\t\t\tdimensions_re = /^\\s*\\-Y\\s+(\\d+)\\s+\\+X\\s+(\\d+)\\s*$/,\n\n\t\t\t\t\t// RGBE format header struct\n\t\t\t\t\theader = {\n\n\t\t\t\t\t\tvalid: 0, /* indicate which fields are valid */\n\n\t\t\t\t\t\tstring: '', /* the actual header string */\n\n\t\t\t\t\t\tcomments: '', /* comments found in header */\n\n\t\t\t\t\t\tprogramtype: 'RGBE', /* listed at beginning of file to identify it after \"#?\". defaults to \"RGBE\" */\n\n\t\t\t\t\t\tformat: '', /* RGBE format, default 32-bit_rle_rgbe */\n\n\t\t\t\t\t\tgamma: 1.0, /* image has already been gamma corrected with given gamma. defaults to 1.0 (no correction) */\n\n\t\t\t\t\t\texposure: 1.0, /* a value of 1.0 in an image corresponds to <exposure> watts/steradian/m^2. defaults to 1.0 */\n\n\t\t\t\t\t\twidth: 0, height: 0 /* image dimensions, width/height */\n\n\t\t\t\t\t};\n\n\t\t\t\tlet line, match;\n\n\t\t\t\tif ( buffer.pos >= buffer.byteLength || ! ( line = fgets( buffer ) ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_read_error, 'no header found' );\n\n\t\t\t\t}\n\n\t\t\t\t/* if you want to require the magic token then uncomment the next line */\n\t\t\t\tif ( ! ( match = line.match( magic_token_re ) ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'bad initial token' );\n\n\t\t\t\t}\n\n\t\t\t\theader.valid |= RGBE_VALID_PROGRAMTYPE;\n\t\t\t\theader.programtype = match[ 1 ];\n\t\t\t\theader.string += line + '\\n';\n\n\t\t\t\twhile ( true ) {\n\n\t\t\t\t\tline = fgets( buffer );\n\t\t\t\t\tif ( false === line ) break;\n\t\t\t\t\theader.string += line + '\\n';\n\n\t\t\t\t\tif ( '#' === line.charAt( 0 ) ) {\n\n\t\t\t\t\t\theader.comments += line + '\\n';\n\t\t\t\t\t\tcontinue; // comment line\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( gamma_re ) ) {\n\n\t\t\t\t\t\theader.gamma = parseFloat( match[ 1 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( exposure_re ) ) {\n\n\t\t\t\t\t\theader.exposure = parseFloat( match[ 1 ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( format_re ) ) {\n\n\t\t\t\t\t\theader.valid |= RGBE_VALID_FORMAT;\n\t\t\t\t\t\theader.format = match[ 1 ];//'32-bit_rle_rgbe';\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( match = line.match( dimensions_re ) ) {\n\n\t\t\t\t\t\theader.valid |= RGBE_VALID_DIMENSIONS;\n\t\t\t\t\t\theader.height = parseInt( match[ 1 ], 10 );\n\t\t\t\t\t\theader.width = parseInt( match[ 2 ], 10 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( ( header.valid & RGBE_VALID_FORMAT ) && ( header.valid & RGBE_VALID_DIMENSIONS ) ) break;\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! ( header.valid & RGBE_VALID_FORMAT ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'missing format specifier' );\n\n\t\t\t\t}\n\n\t\t\t\tif ( ! ( header.valid & RGBE_VALID_DIMENSIONS ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'missing image size specifier' );\n\n\t\t\t\t}\n\n\t\t\t\treturn header;\n\n\t\t\t},\n\n\t\t\tRGBE_ReadPixels_RLE = function ( buffer, w, h ) {\n\n\t\t\t\tconst scanline_width = w;\n\n\t\t\t\tif (\n\t\t\t\t\t// run length encoding is not allowed so read flat\n\t\t\t\t\t( ( scanline_width < 8 ) || ( scanline_width > 0x7fff ) ) ||\n\t\t\t\t\t// this file is not run length encoded\n\t\t\t\t\t( ( 2 !== buffer[ 0 ] ) || ( 2 !== buffer[ 1 ] ) || ( buffer[ 2 ] & 0x80 ) )\n\t\t\t\t) {\n\n\t\t\t\t\t// return the flat buffer\n\t\t\t\t\treturn new Uint8Array( buffer );\n\n\t\t\t\t}\n\n\t\t\t\tif ( scanline_width !== ( ( buffer[ 2 ] << 8 ) | buffer[ 3 ] ) ) {\n\n\t\t\t\t\trgbe_error( rgbe_format_error, 'wrong scanline width' );\n\n\t\t\t\t}\n\n\t\t\t\tconst data_rgba = new Uint8Array( 4 * w * h );\n\n\t\t\t\tif ( ! data_rgba.length ) {\n\n\t\t\t\t\trgbe_error( rgbe_memory_error, 'unable to allocate buffer space' );\n\n\t\t\t\t}\n\n\t\t\t\tlet offset = 0, pos = 0;\n\n\t\t\t\tconst ptr_end = 4 * scanline_width;\n\t\t\t\tconst rgbeStart = new Uint8Array( 4 );\n\t\t\t\tconst scanline_buffer = new Uint8Array( ptr_end );\n\t\t\t\tlet num_scanlines = h;\n\n\t\t\t\t// read in each successive scanline\n\t\t\t\twhile ( ( num_scanlines > 0 ) && ( pos < buffer.byteLength ) ) {\n\n\t\t\t\t\tif ( pos + 4 > buffer.byteLength ) {\n\n\t\t\t\t\t\trgbe_error( rgbe_read_error );\n\n\t\t\t\t\t}\n\n\t\t\t\t\trgbeStart[ 0 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 1 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 2 ] = buffer[ pos ++ ];\n\t\t\t\t\trgbeStart[ 3 ] = buffer[ pos ++ ];\n\n\t\t\t\t\tif ( ( 2 != rgbeStart[ 0 ] ) || ( 2 != rgbeStart[ 1 ] ) || ( ( ( rgbeStart[ 2 ] << 8 ) | rgbeStart[ 3 ] ) != scanline_width ) ) {\n\n\t\t\t\t\t\trgbe_error( rgbe_format_error, 'bad rgbe scanline format' );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// read each of the four channels for the scanline into the buffer\n\t\t\t\t\t// first red, then green, then blue, then exponent\n\t\t\t\t\tlet ptr = 0, count;\n\n\t\t\t\t\twhile ( ( ptr < ptr_end ) && ( pos < buffer.byteLength ) ) {\n\n\t\t\t\t\t\tcount = buffer[ pos ++ ];\n\t\t\t\t\t\tconst isEncodedRun = count > 128;\n\t\t\t\t\t\tif ( isEncodedRun ) count -= 128;\n\n\t\t\t\t\t\tif ( ( 0 === count ) || ( ptr + count > ptr_end ) ) {\n\n\t\t\t\t\t\t\trgbe_error( rgbe_format_error, 'bad scanline data' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( isEncodedRun ) {\n\n\t\t\t\t\t\t\t// a (encoded) run of the same value\n\t\t\t\t\t\t\tconst byteValue = buffer[ pos ++ ];\n\t\t\t\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\t\t\t\tscanline_buffer[ ptr ++ ] = byteValue;\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t//ptr += count;\n\n\t\t\t\t\t\t} else {\n\n\t\t\t\t\t\t\t// a literal-run\n\t\t\t\t\t\t\tscanline_buffer.set( buffer.subarray( pos, pos + count ), ptr );\n\t\t\t\t\t\t\tptr += count; pos += count;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// now convert data from buffer into rgba\n\t\t\t\t\t// first red, then green, then blue, then exponent (alpha)\n\t\t\t\t\tconst l = scanline_width; //scanline_buffer.byteLength;\n\t\t\t\t\tfor ( let i = 0; i < l; i ++ ) {\n\n\t\t\t\t\t\tlet off = 0;\n\t\t\t\t\t\tdata_rgba[ offset ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 1 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 2 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toff += scanline_width; //1;\n\t\t\t\t\t\tdata_rgba[ offset + 3 ] = scanline_buffer[ i + off ];\n\t\t\t\t\t\toffset += 4;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tnum_scanlines --;\n\n\t\t\t\t}\n\n\t\t\t\treturn data_rgba;\n\n\t\t\t};\n\n\t\tconst RGBEByteToRGBFloat = function ( sourceArray, sourceOffset, destArray, destOffset ) {\n\n\t\t\tconst e = sourceArray[ sourceOffset + 3 ];\n\t\t\tconst scale = Math.pow( 2.0, e - 128.0 ) / 255.0;\n\n\t\t\tdestArray[ destOffset + 0 ] = sourceArray[ sourceOffset + 0 ] * scale;\n\t\t\tdestArray[ destOffset + 1 ] = sourceArray[ sourceOffset + 1 ] * scale;\n\t\t\tdestArray[ destOffset + 2 ] = sourceArray[ sourceOffset + 2 ] * scale;\n\t\t\tdestArray[ destOffset + 3 ] = 1;\n\n\t\t};\n\n\t\tconst RGBEByteToRGBHalf = function ( sourceArray, sourceOffset, destArray, destOffset ) {\n\n\t\t\tconst e = sourceArray[ sourceOffset + 3 ];\n\t\t\tconst scale = Math.pow( 2.0, e - 128.0 ) / 255.0;\n\n\t\t\t// clamping to 65504, the maximum representable value in float16\n\t\t\tdestArray[ destOffset + 0 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 0 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 1 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 1 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 2 ] = DataUtils.toHalfFloat( Math.min( sourceArray[ sourceOffset + 2 ] * scale, 65504 ) );\n\t\t\tdestArray[ destOffset + 3 ] = DataUtils.toHalfFloat( 1 );\n\n\t\t};\n\n\t\tconst byteArray = new Uint8Array( buffer );\n\t\tbyteArray.pos = 0;\n\t\tconst rgbe_header_info = RGBE_ReadHeader( byteArray );\n\n\t\tconst w = rgbe_header_info.width,\n\t\t\th = rgbe_header_info.height,\n\t\t\timage_rgba_data = RGBE_ReadPixels_RLE( byteArray.subarray( byteArray.pos ), w, h );\n\n\n\t\tlet data, type;\n\t\tlet numElements;\n\n\t\tswitch ( this.type ) {\n\n\t\t\tcase FloatType:\n\n\t\t\t\tnumElements = image_rgba_data.length / 4;\n\t\t\t\tconst floatArray = new Float32Array( numElements * 4 );\n\n\t\t\t\tfor ( let j = 0; j < numElements; j ++ ) {\n\n\t\t\t\t\tRGBEByteToRGBFloat( image_rgba_data, j * 4, floatArray, j * 4 );\n\n\t\t\t\t}\n\n\t\t\t\tdata = floatArray;\n\t\t\t\ttype = FloatType;\n\t\t\t\tbreak;\n\n\t\t\tcase HalfFloatType:\n\n\t\t\t\tnumElements = image_rgba_data.length / 4;\n\t\t\t\tconst halfArray = new Uint16Array( numElements * 4 );\n\n\t\t\t\tfor ( let j = 0; j < numElements; j ++ ) {\n\n\t\t\t\t\tRGBEByteToRGBHalf( image_rgba_data, j * 4, halfArray, j * 4 );\n\n\t\t\t\t}\n\n\t\t\t\tdata = halfArray;\n\t\t\t\ttype = HalfFloatType;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tthrow new Error( 'THREE.RGBELoader: Unsupported type: ' + this.type );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn {\n\t\t\twidth: w, height: h,\n\t\t\tdata: data,\n\t\t\theader: rgbe_header_info.string,\n\t\t\tgamma: rgbe_header_info.gamma,\n\t\t\texposure: rgbe_header_info.exposure,\n\t\t\ttype: type\n\t\t};\n\n\t}\n\n\tsetDataType( value ) {\n\n\t\tthis.type = value;\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tfunction onLoadCallback( texture, texData ) {\n\n\t\t\tswitch ( texture.type ) {\n\n\t\t\t\tcase FloatType:\n\t\t\t\tcase HalfFloatType:\n\n\t\t\t\t\ttexture.colorSpace = LinearSRGBColorSpace;\n\t\t\t\t\ttexture.minFilter = LinearFilter;\n\t\t\t\t\ttexture.magFilter = LinearFilter;\n\t\t\t\t\ttexture.generateMipmaps = false;\n\t\t\t\t\ttexture.flipY = true;\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tif ( onLoad ) onLoad( texture, texData );\n\n\t\t}\n\n\t\treturn super.load( url, onLoadCallback, onProgress, onError );\n\n\t}\n\n}\n\nexport { RGBELoader };\n","/**\n * HDRI-based lighting presets for day/night cycle.\n * Switches environment maps based on game time.\n */\nimport * as THREE from 'three';\nimport { RGBELoader } from 'three/addons/loaders/RGBELoader.js';\n\nconst HDRI_BASE = '/assets/hdri';\n\nconst PRESETS = {\n  day_warm: {\n    path: `${HDRI_BASE}/day_warm.hdr`,\n    exposure: 1.2,\n    ambientIntensity: 0.6,\n    sunIntensity: 1.2,\n  },\n  day_bright: {\n    path: `${HDRI_BASE}/day_bright.hdr`,\n    exposure: 1.4,\n    ambientIntensity: 0.7,\n    sunIntensity: 1.4,\n  },\n  night_clear: {\n    path: `${HDRI_BASE}/night_clear.hdr`,\n    exposure: 0.6,\n    ambientIntensity: 0.2,\n    sunIntensity: 0.3,\n  },\n  night_starry: {\n    path: `${HDRI_BASE}/night_starry.hdr`,\n    exposure: 0.5,\n    ambientIntensity: 0.15,\n    sunIntensity: 0.2,\n  },\n};\n\nexport class LightingPresets {\n  /**\n   * @param {THREE.Scene} scene\n   * @param {THREE.WebGLRenderer} renderer\n   */\n  constructor(scene, renderer) {\n    this.scene = scene;\n    this.renderer = renderer;\n    this.loader = new RGBELoader();\n\n    /** @type {Map<string, THREE.Texture>} */\n    this.cache = new Map();\n\n    /** @type {string} */\n    this.currentPreset = 'day_warm';\n\n    /** @type {THREE.AmbientLight | null} */\n    this.ambientLight = null;\n\n    /** @type {THREE.DirectionalLight | null} */\n    this.sunLight = null;\n\n    this.findLights();\n  }\n\n  /**\n   * Find ambient and sun lights in the scene.\n   */\n  findLights() {\n    this.scene.traverse((child) => {\n      if (child instanceof THREE.AmbientLight) {\n        this.ambientLight = child;\n      }\n      if (child instanceof THREE.DirectionalLight && child.castShadow) {\n        this.sunLight = child;\n      }\n    });\n  }\n\n  /**\n   * Preload all HDRI textures.\n   * @returns {Promise<void>}\n   */\n  async preload() {\n    const promises = Object.entries(PRESETS).map(async ([name, preset]) => {\n      try {\n        const texture = await this.loadHDRI(preset.path);\n        this.cache.set(name, texture);\n      } catch (err) {\n        console.warn(`Failed to load HDRI ${name}:`, err);\n      }\n    });\n    await Promise.all(promises);\n  }\n\n  /**\n   * Load an HDRI texture.\n   * @param {string} path\n   * @returns {Promise<THREE.Texture>}\n   */\n  loadHDRI(path) {\n    return new Promise((resolve, reject) => {\n      this.loader.load(\n        path,\n        (texture) => {\n          texture.mapping = THREE.EquirectangularReflectionMapping;\n          resolve(texture);\n        },\n        undefined,\n        reject\n      );\n    });\n  }\n\n  /**\n   * Apply a lighting preset.\n   * @param {keyof typeof PRESETS} presetName\n   */\n  apply(presetName) {\n    const preset = PRESETS[presetName];\n    if (!preset) {\n      console.warn(`Unknown lighting preset: ${presetName}`);\n      return;\n    }\n\n    const texture = this.cache.get(presetName);\n    if (texture) {\n      this.scene.environment = texture;\n      this.scene.background = texture;\n    }\n\n    this.renderer.toneMappingExposure = preset.exposure;\n\n    if (this.ambientLight) {\n      this.ambientLight.intensity = preset.ambientIntensity;\n    }\n\n    if (this.sunLight) {\n      this.sunLight.intensity = preset.sunIntensity;\n    }\n\n    this.currentPreset = presetName;\n  }\n\n  /**\n   * Get preset based on game time (hour 0-23).\n   * @param {number} hour\n   * @returns {keyof typeof PRESETS}\n   */\n  getPresetForTime(hour) {\n    if (hour >= 6 && hour < 10) return 'day_warm';\n    if (hour >= 10 && hour < 18) return 'day_bright';\n    if (hour >= 18 && hour < 21) return 'day_warm';\n    return 'night_clear';\n  }\n\n  /**\n   * Update lighting based on real-world time.\n   */\n  updateForCurrentTime() {\n    const hour = new Date().getHours();\n    const preset = this.getPresetForTime(hour);\n    if (preset !== this.currentPreset) {\n      this.apply(preset);\n    }\n  }\n\n  /**\n   * Cycle to next preset (for testing).\n   */\n  cyclePreset() {\n    const presetNames = Object.keys(PRESETS);\n    const currentIndex = presetNames.indexOf(this.currentPreset);\n    const nextIndex = (currentIndex + 1) % presetNames.length;\n    this.apply(presetNames[nextIndex]);\n  }\n\n  /**\n   * Get current preset name.\n   * @returns {string}\n   */\n  getCurrentPreset() {\n    return this.currentPreset;\n  }\n\n  /**\n   * Dispose all cached textures.\n   */\n  dispose() {\n    for (const texture of this.cache.values()) {\n      texture.dispose();\n    }\n    this.cache.clear();\n  }\n}\n","/**\n * VFX System - Sprite sheet based particle effects.\n * Renders animated particle effects for construction, completion, errors.\n */\nimport * as THREE from 'three';\n\nconst SPRITES_BASE = '/assets/sprites';\n\nconst SPRITE_SHEETS = {\n  construction_sparks: {\n    path: `${SPRITES_BASE}/construction_sparks.png`,\n    frames: 16,\n    cols: 4,\n    rows: 4,\n    frameTime: 50,\n    loop: true,\n  },\n  dust_cloud: {\n    path: `${SPRITES_BASE}/dust_cloud.png`,\n    frames: 16,\n    cols: 4,\n    rows: 4,\n    frameTime: 60,\n    loop: false,\n  },\n  completion_burst: {\n    path: `${SPRITES_BASE}/completion_burst.png`,\n    frames: 16,\n    cols: 4,\n    rows: 4,\n    frameTime: 40,\n    loop: false,\n  },\n  error_explosion: {\n    path: `${SPRITES_BASE}/error_explosion.png`,\n    frames: 16,\n    cols: 4,\n    rows: 4,\n    frameTime: 45,\n    loop: false,\n  },\n  worker_teleport: {\n    path: `${SPRITES_BASE}/worker_teleport.png`,\n    frames: 16,\n    cols: 4,\n    rows: 4,\n    frameTime: 35,\n    loop: false,\n  },\n};\n\n/**\n * Active particle effect instance.\n * @typedef {{\n *   sprite: THREE.Sprite,\n *   config: typeof SPRITE_SHEETS[keyof typeof SPRITE_SHEETS],\n *   currentFrame: number,\n *   elapsed: number,\n *   position: THREE.Vector3,\n *   onComplete?: () => void,\n * }} ParticleEffect\n */\n\nexport class VFXSystem {\n  /**\n   * @param {THREE.Scene} scene\n   */\n  constructor(scene) {\n    this.scene = scene;\n    this.textureLoader = new THREE.TextureLoader();\n\n    /** @type {Map<string, THREE.Texture>} */\n    this.textures = new Map();\n\n    /** @type {ParticleEffect[]} */\n    this.activeEffects = [];\n\n    /** @type {boolean} */\n    this.loaded = false;\n  }\n\n  /**\n   * Preload all sprite sheet textures.\n   * @returns {Promise<void>}\n   */\n  async preload() {\n    const promises = Object.entries(SPRITE_SHEETS).map(async ([name, config]) => {\n      try {\n        const texture = await this.loadTexture(config.path);\n        texture.wrapS = THREE.RepeatWrapping;\n        texture.wrapT = THREE.RepeatWrapping;\n        texture.repeat.set(1 / config.cols, 1 / config.rows);\n        texture.magFilter = THREE.LinearFilter;\n        texture.minFilter = THREE.LinearFilter;\n        this.textures.set(name, texture);\n      } catch (err) {\n        console.warn(`Failed to load sprite sheet ${name}:`, err);\n      }\n    });\n    await Promise.all(promises);\n    this.loaded = true;\n  }\n\n  /**\n   * Load a texture.\n   * @param {string} path\n   * @returns {Promise<THREE.Texture>}\n   */\n  loadTexture(path) {\n    return new Promise((resolve, reject) => {\n      this.textureLoader.load(path, resolve, undefined, reject);\n    });\n  }\n\n  /**\n   * Play an effect at a position.\n   * @param {keyof typeof SPRITE_SHEETS} effectName\n   * @param {THREE.Vector3} position\n   * @param {number} scale\n   * @param {() => void} [onComplete]\n   */\n  play(effectName, position, scale = 1, onComplete) {\n    if (!this.loaded) return;\n\n    const config = SPRITE_SHEETS[effectName];\n    const texture = this.textures.get(effectName);\n    if (!config || !texture) {\n      console.warn(`Unknown VFX effect: ${effectName}`);\n      return;\n    }\n\n    const clonedTexture = texture.clone();\n    clonedTexture.needsUpdate = true;\n\n    const material = new THREE.SpriteMaterial({\n      map: clonedTexture,\n      transparent: true,\n      depthWrite: false,\n      blending: THREE.AdditiveBlending,\n    });\n\n    const sprite = new THREE.Sprite(material);\n    sprite.position.copy(position);\n    sprite.scale.setScalar(scale * 2);\n\n    this.scene.add(sprite);\n\n    /** @type {ParticleEffect} */\n    const effect = {\n      sprite,\n      config,\n      currentFrame: 0,\n      elapsed: 0,\n      position: position.clone(),\n      onComplete,\n    };\n\n    this.activeEffects.push(effect);\n    this.updateSpriteFrame(effect);\n  }\n\n  /**\n   * Update sprite texture offset for current frame.\n   * @param {ParticleEffect} effect\n   */\n  updateSpriteFrame(effect) {\n    const { config, currentFrame, sprite } = effect;\n    const col = currentFrame % config.cols;\n    const row = Math.floor(currentFrame / config.cols);\n\n    const texture = sprite.material.map;\n    if (texture) {\n      texture.offset.set(col / config.cols, 1 - (row + 1) / config.rows);\n    }\n  }\n\n  /**\n   * Update all active effects.\n   * @param {number} delta - Time in seconds\n   */\n  update(delta) {\n    const deltaMs = delta * 1000;\n    const toRemove = [];\n\n    for (const effect of this.activeEffects) {\n      effect.elapsed += deltaMs;\n\n      if (effect.elapsed >= effect.config.frameTime) {\n        effect.elapsed = 0;\n        effect.currentFrame++;\n\n        if (effect.currentFrame >= effect.config.frames) {\n          if (effect.config.loop) {\n            effect.currentFrame = 0;\n          } else {\n            toRemove.push(effect);\n            continue;\n          }\n        }\n\n        this.updateSpriteFrame(effect);\n      }\n    }\n\n    for (const effect of toRemove) {\n      this.removeEffect(effect);\n    }\n  }\n\n  /**\n   * Remove an effect from the scene.\n   * @param {ParticleEffect} effect\n   */\n  removeEffect(effect) {\n    this.scene.remove(effect.sprite);\n    effect.sprite.material.map?.dispose();\n    effect.sprite.material.dispose();\n\n    const index = this.activeEffects.indexOf(effect);\n    if (index !== -1) {\n      this.activeEffects.splice(index, 1);\n    }\n\n    effect.onComplete?.();\n  }\n\n  /**\n   * Play construction sparks at position.\n   * @param {THREE.Vector3} position\n   */\n  playConstructionSparks(position) {\n    this.play('construction_sparks', position, 1.5);\n  }\n\n  /**\n   * Play dust cloud at position.\n   * @param {THREE.Vector3} position\n   */\n  playDustCloud(position) {\n    this.play('dust_cloud', position, 2);\n  }\n\n  /**\n   * Play completion burst at position.\n   * @param {THREE.Vector3} position\n   */\n  playCompletionBurst(position) {\n    this.play('completion_burst', position, 2.5);\n  }\n\n  /**\n   * Play error explosion at position.\n   * @param {THREE.Vector3} position\n   */\n  playErrorExplosion(position) {\n    this.play('error_explosion', position, 2);\n  }\n\n  /**\n   * Play worker teleport effect at position.\n   * @param {THREE.Vector3} position\n   */\n  playWorkerTeleport(position) {\n    this.play('worker_teleport', position, 1.5);\n  }\n\n  /**\n   * Dispose all resources.\n   */\n  dispose() {\n    for (const effect of this.activeEffects) {\n      this.scene.remove(effect.sprite);\n      effect.sprite.material.map?.dispose();\n      effect.sprite.material.dispose();\n    }\n    this.activeEffects.length = 0;\n\n    for (const texture of this.textures.values()) {\n      texture.dispose();\n    }\n    this.textures.clear();\n  }\n}\n","/**\n * Three.js scene renderer for BlazeCraft.\n * Isometric view with 30Â° elevation, 45Â° rotation.\n *\n * World scale: 1 unit = 10px â†’ 128Ã—72 world units for 1280Ã—720 canvas.\n */\nimport * as THREE from 'three';\nimport { OrbitControls } from 'three/addons/controls/OrbitControls.js';\nimport { LightingPresets } from './lighting-presets.js';\nimport { VFXSystem } from './vfx-system.js';\n\n/** @typedef {{ scene: THREE.Scene, camera: THREE.OrthographicCamera, renderer: THREE.WebGLRenderer, controls: OrbitControls, lighting: LightingPresets, vfx: VFXSystem }} SceneContext */\n\nconst WORLD_WIDTH = 128;\nconst WORLD_HEIGHT = 72;\nconst CAMERA_ELEVATION = 30 * (Math.PI / 180);\nconst CAMERA_ROTATION = 45 * (Math.PI / 180);\nconst ZOOM_MIN = 0.5;\nconst ZOOM_MAX = 2.5;\n\n/**\n * Initialize Three.js scene with isometric camera.\n * @param {HTMLCanvasElement} canvas\n * @returns {SceneContext}\n */\nexport function initScene(canvas) {\n  // Scene\n  const scene = new THREE.Scene();\n  scene.background = new THREE.Color(0x0b0b0f);\n\n  // Ground plane\n  const groundGeom = new THREE.PlaneGeometry(WORLD_WIDTH, WORLD_HEIGHT);\n  const groundMat = new THREE.MeshStandardMaterial({\n    color: 0x1a1a1a,\n    roughness: 0.9,\n    metalness: 0.1,\n  });\n  const ground = new THREE.Mesh(groundGeom, groundMat);\n  ground.rotation.x = -Math.PI / 2;\n  ground.position.y = 0;\n  ground.receiveShadow = true;\n  ground.name = 'ground';\n  scene.add(ground);\n\n  // Grid helper for debug (toggle with G key)\n  const gridHelper = new THREE.GridHelper(WORLD_WIDTH, 16, 0x333333, 0x222222);\n  gridHelper.position.y = 0.01;\n  gridHelper.name = 'grid';\n  gridHelper.visible = false;\n  scene.add(gridHelper);\n\n  // Orthographic camera (isometric)\n  const aspect = canvas.width / canvas.height;\n  const frustumSize = WORLD_HEIGHT;\n  const camera = new THREE.OrthographicCamera(\n    (frustumSize * aspect) / -2,\n    (frustumSize * aspect) / 2,\n    frustumSize / 2,\n    frustumSize / -2,\n    0.1,\n    1000\n  );\n\n  // Position camera for isometric view\n  const distance = 100;\n  camera.position.set(\n    Math.sin(CAMERA_ROTATION) * Math.cos(CAMERA_ELEVATION) * distance,\n    Math.sin(CAMERA_ELEVATION) * distance,\n    Math.cos(CAMERA_ROTATION) * Math.cos(CAMERA_ELEVATION) * distance\n  );\n  camera.lookAt(0, 0, 0);\n  camera.zoom = 1;\n  camera.updateProjectionMatrix();\n\n  // Renderer\n  const renderer = new THREE.WebGLRenderer({\n    canvas,\n    antialias: true,\n    powerPreference: 'high-performance',\n  });\n  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));\n  renderer.setSize(canvas.width, canvas.height);\n  renderer.shadowMap.enabled = true;\n  renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n  renderer.toneMapping = THREE.ACESFilmicToneMapping;\n  renderer.toneMappingExposure = 1.2;\n\n  // Orbit controls (limited for RTS feel)\n  const controls = new OrbitControls(camera, canvas);\n  controls.enableRotate = false; // Lock rotation for isometric\n  controls.enablePan = true;\n  controls.enableZoom = true;\n  controls.minZoom = ZOOM_MIN;\n  controls.maxZoom = ZOOM_MAX;\n  controls.panSpeed = 1.5;\n  controls.mouseButtons = {\n    LEFT: THREE.MOUSE.PAN,\n    MIDDLE: THREE.MOUSE.DOLLY,\n    RIGHT: THREE.MOUSE.PAN,\n  };\n  controls.touches = {\n    ONE: THREE.TOUCH.PAN,\n    TWO: THREE.TOUCH.DOLLY_PAN,\n  };\n\n  // Lighting\n  setupLighting(scene);\n\n  // Fog for depth\n  scene.fog = new THREE.FogExp2(0x0b0b0f, 0.008);\n\n  // Initialize lighting presets and VFX system\n  const lighting = new LightingPresets(scene, renderer);\n  const vfx = new VFXSystem(scene);\n\n  return { scene, camera, renderer, controls, lighting, vfx };\n}\n\n/**\n * Initialize lighting and VFX systems (call after scene setup).\n * @param {SceneContext} ctx\n * @returns {Promise<void>}\n */\nexport async function initEnhancements(ctx) {\n  try {\n    await Promise.all([\n      ctx.lighting.preload(),\n      ctx.vfx.preload(),\n    ]);\n    ctx.lighting.apply('day_warm');\n  } catch (err) {\n    console.warn('Failed to load enhancements:', err);\n  }\n}\n\n/**\n * Set up scene lighting with BSI warm accent.\n * @param {THREE.Scene} scene\n */\nfunction setupLighting(scene) {\n  // Ambient light (base illumination)\n  const ambient = new THREE.AmbientLight(0x404050, 0.6);\n  scene.add(ambient);\n\n  // Main directional light (sun)\n  const sun = new THREE.DirectionalLight(0xffffff, 1.2);\n  sun.position.set(50, 80, 30);\n  sun.castShadow = true;\n  sun.shadow.mapSize.width = 2048;\n  sun.shadow.mapSize.height = 2048;\n  sun.shadow.camera.near = 0.1;\n  sun.shadow.camera.far = 200;\n  sun.shadow.camera.left = -80;\n  sun.shadow.camera.right = 80;\n  sun.shadow.camera.top = 60;\n  sun.shadow.camera.bottom = -60;\n  sun.shadow.bias = -0.0001;\n  scene.add(sun);\n\n  // Warm fill light (BSI accent: burnt orange)\n  const fill = new THREE.DirectionalLight(0xe86c2c, 0.3);\n  fill.position.set(-30, 40, -20);\n  scene.add(fill);\n\n  // Rim light for definition\n  const rim = new THREE.DirectionalLight(0x6080ff, 0.15);\n  rim.position.set(0, 20, -60);\n  scene.add(rim);\n\n  // Hemisphere light for sky/ground bounce\n  const hemi = new THREE.HemisphereLight(0x8090a0, 0x1a1a1a, 0.4);\n  scene.add(hemi);\n}\n\n/**\n * Handle window resize.\n * @param {SceneContext} ctx\n * @param {number} width\n * @param {number} height\n */\nexport function handleResize(ctx, width, height) {\n  const { camera, renderer } = ctx;\n  const aspect = width / height;\n  const frustumSize = WORLD_HEIGHT;\n\n  camera.left = (frustumSize * aspect) / -2;\n  camera.right = (frustumSize * aspect) / 2;\n  camera.top = frustumSize / 2;\n  camera.bottom = frustumSize / -2;\n  camera.updateProjectionMatrix();\n\n  renderer.setSize(width, height);\n}\n\n/**\n * Toggle grid visibility (debug).\n * @param {THREE.Scene} scene\n */\nexport function toggleGrid(scene) {\n  const grid = scene.getObjectByName('grid');\n  if (grid) {\n    grid.visible = !grid.visible;\n  }\n}\n\n/**\n * Convert 2D screen position to 3D world position on ground plane.\n * @param {SceneContext} ctx\n * @param {number} screenX\n * @param {number} screenY\n * @returns {{ x: number, y: number, z: number } | null}\n */\nexport function screenToWorld(ctx, screenX, screenY) {\n  const { camera, renderer } = ctx;\n  const rect = renderer.domElement.getBoundingClientRect();\n\n  const ndc = new THREE.Vector2(\n    ((screenX - rect.left) / rect.width) * 2 - 1,\n    -((screenY - rect.top) / rect.height) * 2 + 1\n  );\n\n  const raycaster = new THREE.Raycaster();\n  raycaster.setFromCamera(ndc, camera);\n\n  const groundPlane = new THREE.Plane(new THREE.Vector3(0, 1, 0), 0);\n  const intersection = new THREE.Vector3();\n\n  if (raycaster.ray.intersectPlane(groundPlane, intersection)) {\n    return { x: intersection.x, y: intersection.y, z: intersection.z };\n  }\n  return null;\n}\n\n/**\n * Create render loop.\n * @param {SceneContext} ctx\n * @param {(delta: number) => void} onUpdate\n * @returns {() => void} Stop function\n */\nexport function createRenderLoop(ctx, onUpdate) {\n  const { scene, camera, renderer, controls, vfx } = ctx;\n  const clock = new THREE.Clock();\n  let running = true;\n\n  function animate() {\n    if (!running) return;\n    requestAnimationFrame(animate);\n\n    const delta = clock.getDelta();\n    onUpdate(delta);\n    vfx.update(delta);\n    controls.update();\n    renderer.render(scene, camera);\n  }\n\n  animate();\n\n  return () => {\n    running = false;\n  };\n}\n","/**\n * Mascot Controller - Blaze portrait state machine.\n * Shows different Blaze portraits based on worker/game state.\n */\n\nconst PORTRAITS_BASE = '/assets/ui/portraits';\n\nconst PORTRAIT_STATES = {\n  idle: {\n    image: `${PORTRAITS_BASE}/blaze_idle.png`,\n    alt: 'Blaze - Idle',\n  },\n  working: {\n    image: `${PORTRAITS_BASE}/blaze_working.png`,\n    alt: 'Blaze - Working',\n  },\n  error: {\n    image: `${PORTRAITS_BASE}/blaze_error.png`,\n    alt: 'Blaze - Error',\n  },\n  complete: {\n    image: `${PORTRAITS_BASE}/blaze_complete.png`,\n    alt: 'Blaze - Complete',\n  },\n};\n\n/** @typedef {'idle' | 'working' | 'error' | 'complete'} MascotState */\n/** @typedef {import('./game-state.js').WorkerStatus} WorkerStatus */\n\nexport class MascotController {\n  /**\n   * @param {HTMLElement} portraitElement - The portrait container element\n   */\n  constructor(portraitElement) {\n    this.container = portraitElement;\n\n    /** @type {MascotState} */\n    this.currentState = 'idle';\n\n    /** @type {HTMLImageElement | null} */\n    this.imageElement = null;\n\n    /** @type {number} */\n    this.completeTimeout = 0;\n\n    this.init();\n  }\n\n  /**\n   * Initialize the mascot portrait.\n   */\n  init() {\n    const frame = this.container.querySelector('.portrait-frame');\n    if (!frame) return;\n\n    this.imageElement = document.createElement('img');\n    this.imageElement.className = 'portrait-mascot';\n    this.imageElement.width = 80;\n    this.imageElement.height = 80;\n    this.imageElement.alt = 'Blaze mascot';\n\n    const icon = frame.querySelector('.portrait-icon');\n    if (icon) {\n      icon.style.display = 'none';\n    }\n\n    frame.appendChild(this.imageElement);\n    this.setState('idle');\n  }\n\n  /**\n   * Set the mascot state.\n   * @param {MascotState} state\n   */\n  setState(state) {\n    if (this.currentState === state) return;\n\n    const portrait = PORTRAIT_STATES[state];\n    if (!portrait || !this.imageElement) return;\n\n    this.currentState = state;\n    this.imageElement.src = portrait.image;\n    this.imageElement.alt = portrait.alt;\n\n    this.container.dataset.mascotState = state;\n\n    if (this.completeTimeout) {\n      clearTimeout(this.completeTimeout);\n      this.completeTimeout = 0;\n    }\n  }\n\n  /**\n   * Update mascot based on worker status.\n   * @param {WorkerStatus | null} status\n   */\n  updateFromWorkerStatus(status) {\n    if (!status) {\n      this.setState('idle');\n      return;\n    }\n\n    switch (status) {\n      case 'idle':\n      case 'hold':\n        this.setState('idle');\n        break;\n      case 'working':\n      case 'moving':\n        this.setState('working');\n        break;\n      case 'blocked':\n      case 'terminated':\n        this.setState('error');\n        break;\n      case 'complete':\n        this.showCompletion();\n        break;\n      default:\n        this.setState('idle');\n    }\n  }\n\n  /**\n   * Show completion state briefly, then return to idle.\n   */\n  showCompletion() {\n    this.setState('complete');\n\n    this.completeTimeout = window.setTimeout(() => {\n      this.setState('idle');\n      this.completeTimeout = 0;\n    }, 3000);\n  }\n\n  /**\n   * Trigger error state briefly.\n   */\n  showError() {\n    this.setState('error');\n\n    if (this.completeTimeout) {\n      clearTimeout(this.completeTimeout);\n    }\n\n    this.completeTimeout = window.setTimeout(() => {\n      this.setState('idle');\n      this.completeTimeout = 0;\n    }, 2000);\n  }\n\n  /**\n   * Update from multiple selected workers.\n   * @param {Array<{status: WorkerStatus}>} workers\n   */\n  updateFromWorkers(workers) {\n    if (workers.length === 0) {\n      this.setState('idle');\n      return;\n    }\n\n    const hasError = workers.some(\n      (w) => w.status === 'blocked' || w.status === 'terminated'\n    );\n    const hasWorking = workers.some(\n      (w) => w.status === 'working' || w.status === 'moving'\n    );\n    const hasComplete = workers.some((w) => w.status === 'complete');\n\n    if (hasError) {\n      this.setState('error');\n    } else if (hasWorking) {\n      this.setState('working');\n    } else if (hasComplete) {\n      this.showCompletion();\n    } else {\n      this.setState('idle');\n    }\n  }\n\n  /**\n   * Get current mascot state.\n   * @returns {MascotState}\n   */\n  getState() {\n    return this.currentState;\n  }\n\n  /**\n   * Preload all portrait images.\n   * @returns {Promise<void>}\n   */\n  static async preloadImages() {\n    const promises = Object.values(PORTRAIT_STATES).map((state) => {\n      return new Promise((resolve) => {\n        const img = new Image();\n        img.onload = resolve;\n        img.onerror = resolve;\n        img.src = state.image;\n      });\n    });\n    await Promise.all(promises);\n  }\n\n  /**\n   * Dispose resources.\n   */\n  dispose() {\n    if (this.completeTimeout) {\n      clearTimeout(this.completeTimeout);\n    }\n    if (this.imageElement && this.imageElement.parentNode) {\n      this.imageElement.parentNode.removeChild(this.imageElement);\n    }\n  }\n}\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.count * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.count; i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * @param  {Array<BufferGeometry>} geometries\n * @param  {Boolean} useGroups\n * @return {BufferGeometry}\n */\nfunction mergeGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {BufferAttribute}\n */\nfunction mergeAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet gpuType = - 1;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( gpuType === - 1 ) gpuType = attribute.gpuType;\n\t\tif ( gpuType !== attribute.gpuType ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.count * itemSize;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tconst result = new BufferAttribute( array, itemSize, normalized );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst tupleOffset = offset / itemSize;\n\t\t\tfor ( let j = 0, l = attribute.count; j < l; j ++ ) {\n\n\t\t\t\tfor ( let c = 0; c < itemSize; c ++ ) {\n\n\t\t\t\t\tconst value = attribute.getComponent( j, c );\n\t\t\t\t\tresult.setComponent( j + tupleOffset, c, value );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tarray.set( attribute.array, offset );\n\n\t\t}\n\n\t\toffset += attribute.count * itemSize;\n\n\t}\n\n\tif ( gpuType !== undefined ) {\n\n\t\tresult.gpuType = gpuType;\n\n\t}\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferAttribute}\n * @return {BufferAttribute}\n */\nexport function deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * @param {Array<BufferAttribute>} attributes\n * @return {Array<InterleavedBufferAttribute>}\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n// returns a new, non-interleaved version of the provided attribute\nexport function deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n// deinterleaves all attributes on the geometry\nexport function deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @return {number}\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} tolerance\n * @return {BufferGeometry}\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new attr.constructor(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\tif ( morphAttributes ) {\n\n\t\t\tif ( ! tmpMorphAttributes[ name ] ) tmpMorphAttributes[ name ] = [];\n\t\t\tmorphAttributes.forEach( ( morphAttr, i ) => {\n\n\t\t\t\tconst array = new morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize );\n\t\t\t\ttmpMorphAttributes[ name ][ i ] = new morphAttr.constructor( array, morphAttr.itemSize, morphAttr.normalized );\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst halfTolerance = tolerance * 0.5;\n\tconst exponent = Math.log10( 1 / tolerance );\n\tconst hashMultiplier = Math.pow( 10, exponent );\n\tconst hashAdditive = halfTolerance * hashMultiplier;\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * hashMultiplier + hashAdditive ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newArray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewArray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttributes ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttributes.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttributes[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new tmpAttribute.constructor(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new tmpMorphAttribute.constructor(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {number} drawMode\n * @return {BufferGeometry}\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n * Helpful for Raytracing or Decals.\n * @param {Mesh | Line | Points} object An instance of Mesh, Line or Points.\n * @return {Object} An Object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.applyBoneTransform( a, _vA );\n\t\t\tobject.applyBoneTransform( b, _vB );\n\t\t\tobject.applyBoneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n\n/**\n * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,\n * non-indexed geometry. Returns the geometry with smooth normals everywhere except\n * faces that meet at an angle greater than the crease angle.\n *\n * @param {BufferGeometry} geometry\n * @param {number} [creaseAngle]\n * @return {BufferGeometry}\n */\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vectors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\t// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed\n\t// and returns the original geometry\n\tconst resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeMikkTSpaceTangents,\n\tmergeGeometries,\n\tmergeAttributes,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tColorManagement,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLinearSRGBColorSpace,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tSRGBColorSpace,\n\tInstancedBufferAttribute\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\nclass GLTFLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsDispersionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureAVIFExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsAnisotropyExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsBumpExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\t// If a base path is set, resources will be relative paths from that plus the relative path of the gltf file\n\t\t\t// Example  path = 'https://my-cnd-server.com/', url = 'assets/models/model.gltf'\n\t\t\t// resourcePath = 'https://my-cnd-server.com/assets/models/'\n\t\t\t// referenced resource 'model.bin' will be loaded from 'https://my-cnd-server.com/assets/models/model.bin'\n\t\t\t// referenced resource '../textures/texture.png' will be loaded from 'https://my-cnd-server.com/assets/textures/texture.png'\n\t\t\tconst relativeUrl = LoaderUtils.extractUrlBase( url );\n\t\t\tresourcePath = LoaderUtils.resolveURL( relativeUrl, this.path );\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\n\t\t\tif ( ! plugin.name ) console.error( 'THREE.GLTFLoader: Invalid plugin found: missing name' );\n\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_DISPERSION: 'KHR_materials_dispersion',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_ANISOTROPY: 'KHR_materials_anisotropy',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_MATERIALS_BUMP: 'EXT_materials_bump',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_TEXTURE_AVIF: 'EXT_texture_avif',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.setRGB( lightDef.color[ 0 ], lightDef.color[ 1 ], lightDef.color[ 2 ], LinearSRGBColorSpace );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tlightNode.decay = 2;\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials dispersion Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_dispersion\n */\nclass GLTFMaterialsDispersionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_DISPERSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.dispersion = extension.dispersion !== undefined ? extension.dispersion : 0;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tconst colorFactor = extension.sheenColorFactor;\n\t\t\tmaterialParams.sheenColor.setRGB( colorFactor[ 0 ], colorFactor[ 1 ], colorFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n\n/**\n * Materials bump Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_materials_bump\n */\nclass GLTFMaterialsBumpExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_MATERIALS_BUMP;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.bumpScale = extension.bumpFactor !== undefined ? extension.bumpFactor : 1.0;\n\n\t\tif ( extension.bumpTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'bumpMap', extension.bumpTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials anisotropy Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_anisotropy\n */\nclass GLTFMaterialsAnisotropyExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_ANISOTROPY;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.anisotropyStrength !== undefined ) {\n\n\t\t\tmaterialParams.anisotropy = extension.anisotropyStrength;\n\n\t\t}\n\n\t\tif ( extension.anisotropyRotation !== undefined ) {\n\n\t\t\tmaterialParams.anisotropyRotation = extension.anisotropyRotation;\n\n\t\t}\n\n\t\tif ( extension.anisotropyTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'anisotropyMap', extension.anisotropyTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: WebP required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image. Support for lossy images doesn't guarantee support for all\n\t\t\t\t// WebP images, unfortunately.\n\t\t\t\timage.src = 'data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA';\n\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * AVIF Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif\n */\nclass GLTFTextureAVIFExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_AVIF;\n\t\tthis.isSupported = null;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.detectSupport().then( function ( isSupported ) {\n\n\t\t\tif ( isSupported ) return parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: AVIF required by asset but unsupported.' );\n\n\t\t\t}\n\n\t\t\t// Fall back to PNG or JPEG.\n\t\t\treturn parser.loadTexture( textureIndex );\n\n\t\t} );\n\n\t}\n\n\tdetectSupport() {\n\n\t\tif ( ! this.isSupported ) {\n\n\t\t\tthis.isSupported = new Promise( function ( resolve ) {\n\n\t\t\t\tconst image = new Image();\n\n\t\t\t\t// Lossy test image.\n\t\t\t\timage.src = 'data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=';\n\t\t\t\timage.onload = image.onerror = function () {\n\n\t\t\t\t\tresolve( image.height === 1 );\n\n\t\t\t\t};\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn this.isSupported;\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName === '_COLOR_0' ) {\n\n\t\t\t\t\t\tconst attr = attributes[ attributeName ];\n\t\t\t\t\t\tinstancedMesh.instanceColor = new InstancedBufferAttribute( attr.array, attr.itemSize, attr.normalized );\n\n\t\t\t\t\t} else if ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap, LinearSRGBColorSpace, reject );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( ( transform.texCoord === undefined || transform.texCoord === texture.channel )\n\t\t\t&& transform.offset === undefined\n\t\t\t&& transform.rotation === undefined\n\t\t\t&& transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\ttexture.channel = transform.texCoord;\n\n\t\t}\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _q = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_q.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv1',\n\tTEXCOORD_2: 'uv2',\n\tTEXCOORD_3: 'uv3',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * @param {Object3D|Material|BufferGeometry} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tlet geometryKey;\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\tif ( primitiveDef.targets !== undefined ) {\n\n\t\tfor ( let i = 0, il = primitiveDef.targets.length; i < il; i ++ ) {\n\n\t\t\tgeometryKey += ':' + createAttributesKey( primitiveDef.targets[ i ] );\n\n\t\t}\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\tif ( uri.search( /\\.ktx2($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/ktx2/ ) === 0 ) return 'image/ktx2';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Node cache\n\t\tthis.nodeCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet safariVersion = - 1;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tconst userAgent = navigator.userAgent;\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( userAgent ) === true;\n\t\t\tconst safariMatch = userAgent.match( /Version\\/(\\d+)/ );\n\t\t\tsafariVersion = isSafari && safariMatch ? parseInt( safariMatch[ 1 ], 10 ) : - 1;\n\n\t\t\tisFirefox = userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || ( isSafari && safariVersion < 17 ) || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\t\tthis.nodeCache = {};\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\treturn Promise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tfor ( const scene of result.scenes ) {\n\n\t\t\t\t\tscene.updateMatrixWorld();\n\n\t\t\t\t}\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/** Returns a reference to a shared resource, cloning it if necessary. */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\t// Ignore normalized since we copy from sparse\n\t\t\t\tbufferAttribute.normalized = false;\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute.normalized = normalized;\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t * @param {number} textureIndex\n\t * @return {Promise<THREE.Texture|null>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tif ( texture.name === '' && typeof sourceDef.uri === 'string' && sourceDef.uri.startsWith( 'data:image/' ) === false ) {\n\n\t\t\t\ttexture.name = sourceDef.uri;\n\n\t\t\t}\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\t\t\ttexture.generateMipmaps = ! texture.isCompressedTexture && texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( texture, sourceDef );\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, colorSpace ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord > 0 ) {\n\n\t\t\t\ttexture = texture.clone();\n\t\t\t\ttexture.channel = mapDef.texCoord;\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( colorSpace !== undefined ) {\n\n\t\t\t\ttexture.colorSpace = colorSpace;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\t\t\t\tlineMaterial.map = material.map;\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tconst emissiveFactor = materialDef.emissiveFactor;\n\t\t\tmaterialParams.emissive = new Color().setRGB( emissiveFactor[ 0 ], emissiveFactor[ 1 ], emissiveFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/** When Object3D instances are targeted by animation, they need unique names. */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tif ( sanitizedName in this.nodeNamesUsed ) {\n\n\t\t\treturn sanitizedName + '_' + ( ++ this.nodeNamesUsed[ sanitizedName ] );\n\n\t\t} else {\n\n\t\t\tthis.nodeNamesUsed[ sanitizedName ] = 0;\n\n\t\t\treturn sanitizedName;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true ) {\n\n\t\t\t\t\t\t// normalize skin weights to fix malformed assets (see #15319)\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, meshes[ 0 ], meshDef );\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, group, meshDef );\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t * @param {number} cameraIndex\n\t * @return {Promise<THREE.Camera>}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this._loadNodeShallow( skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\t// Note that bones (joint nodes) may or may not be in the\n\t\t\t// scene graph at this time.\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\t\tconst animationName = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tif ( target.node === undefined ) continue;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tif ( node.updateMatrix ) {\n\n\t\t\t\t\tnode.updateMatrix();\n\n\t\t\t\t}\n\n\t\t\t\tconst createdTracks = parser._createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target );\n\n\t\t\t\tif ( createdTracks ) {\n\n\t\t\t\t\tfor ( let k = 0; k < createdTracks.length; k ++ ) {\n\n\t\t\t\t\t\ttracks.push( createdTracks[ k ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new AnimationClip( animationName, undefined, tracks );\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tconst nodePending = parser._loadNodeShallow( nodeIndex );\n\n\t\tconst childPending = [];\n\t\tconst childrenDef = nodeDef.children || [];\n\n\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t}\n\n\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t? Promise.resolve( null )\n\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\treturn Promise.all( [\n\t\t\tnodePending,\n\t\t\tPromise.all( childPending ),\n\t\t\tskeletonPending\n\t\t] ).then( function ( results ) {\n\n\t\t\tconst node = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t// ._loadNodeShallow() parses a single node.\n\t// skin and child nodes are created and added in .loadNode() (no '_' prefix).\n\t_loadNodeShallow( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\t// This method is called from .loadNode() and .loadSkin().\n\t\t// Cache a node to avoid duplication.\n\n\t\tif ( this.nodeCache[ nodeIndex ] !== undefined ) {\n\n\t\t\treturn this.nodeCache[ nodeIndex ];\n\n\t\t}\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\tconst pending = [];\n\n\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t} );\n\n\t\tif ( meshPromise ) {\n\n\t\t\tpending.push( meshPromise );\n\n\t\t}\n\n\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t} ).forEach( function ( promise ) {\n\n\t\t\tpending.push( promise );\n\n\t\t} );\n\n\t\tthis.nodeCache[ nodeIndex ] = Promise.all( pending ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t\treturn this.nodeCache[ nodeIndex ];\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n\t_createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target ) {\n\n\t\tconst tracks = [];\n\n\t\tconst targetName = node.name ? node.name : node.uuid;\n\t\tconst targetNames = [];\n\n\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\ttargetNames.push( targetName );\n\n\t\t}\n\n\t\tlet TypedKeyframeTrack;\n\n\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.position:\n\t\t\tcase PATH_PROPERTIES.scale:\n\n\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tswitch ( outputAccessor.itemSize ) {\n\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\tcase 3:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\n\t\tconst outputArray = this._getArrayFromAccessor( outputAccessor );\n\n\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\tinputAccessor.array,\n\t\t\t\toutputArray,\n\t\t\t\tinterpolation\n\t\t\t);\n\n\t\t\t// Override interpolation with custom factory method.\n\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\tthis._createCubicSplineTrackInterpolant( track );\n\n\t\t\t}\n\n\t\t\ttracks.push( track );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\t_getArrayFromAccessor( accessor ) {\n\n\t\tlet outputArray = accessor.array;\n\n\t\tif ( accessor.normalized ) {\n\n\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t}\n\n\t\t\toutputArray = scaled;\n\n\t\t}\n\n\t\treturn outputArray;\n\n\t}\n\n\t_createCubicSplineTrackInterpolant( track ) {\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t};\n\n\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t}\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tif ( ColorManagement.workingColorSpace !== LinearSRGBColorSpace && 'COLOR_0' in attributes ) {\n\n\t\tconsole.warn( `THREE.GLTFLoader: Converting vertex colors from \"srgb-linear\" to \"${ColorManagement.workingColorSpace}\" not supported.` );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\nexport { GLTFLoader };\n","import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tColor,\n\tColorManagement,\n\tFileLoader,\n\tLoader,\n\tLinearSRGBColorSpace,\n\tSRGBColorSpace\n} from 'three';\n\nconst _taskCache = new WeakMap();\n\nclass DRACOLoader extends Loader {\n\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.decoderPath = '';\n\t\tthis.decoderConfig = {};\n\t\tthis.decoderBinary = null;\n\t\tthis.decoderPending = null;\n\n\t\tthis.workerLimit = 4;\n\t\tthis.workerPool = [];\n\t\tthis.workerNextTaskID = 1;\n\t\tthis.workerSourceURL = '';\n\n\t\tthis.defaultAttributeIDs = {\n\t\t\tposition: 'POSITION',\n\t\t\tnormal: 'NORMAL',\n\t\t\tcolor: 'COLOR',\n\t\t\tuv: 'TEX_COORD'\n\t\t};\n\t\tthis.defaultAttributeTypes = {\n\t\t\tposition: 'Float32Array',\n\t\t\tnormal: 'Float32Array',\n\t\t\tcolor: 'Float32Array',\n\t\t\tuv: 'Float32Array'\n\t\t};\n\n\t}\n\n\tsetDecoderPath( path ) {\n\n\t\tthis.decoderPath = path;\n\n\t\treturn this;\n\n\t}\n\n\tsetDecoderConfig( config ) {\n\n\t\tthis.decoderConfig = config;\n\n\t\treturn this;\n\n\t}\n\n\tsetWorkerLimit( workerLimit ) {\n\n\t\tthis.workerLimit = workerLimit;\n\n\t\treturn this;\n\n\t}\n\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, ( buffer ) => {\n\n\t\t\tthis.parse( buffer, onLoad, onError );\n\n\t\t}, onProgress, onError );\n\n\t}\n\n\n\tparse( buffer, onLoad, onError = ()=>{} ) {\n\n\t\tthis.decodeDracoFile( buffer, onLoad, null, null, SRGBColorSpace, onError ).catch( onError );\n\n\t}\n\n\tdecodeDracoFile( buffer, callback, attributeIDs, attributeTypes, vertexColorSpace = LinearSRGBColorSpace, onError = () => {} ) {\n\n\t\tconst taskConfig = {\n\t\t\tattributeIDs: attributeIDs || this.defaultAttributeIDs,\n\t\t\tattributeTypes: attributeTypes || this.defaultAttributeTypes,\n\t\t\tuseUniqueIDs: !! attributeIDs,\n\t\t\tvertexColorSpace: vertexColorSpace,\n\t\t};\n\n\t\treturn this.decodeGeometry( buffer, taskConfig ).then( callback ).catch( onError );\n\n\t}\n\n\tdecodeGeometry( buffer, taskConfig ) {\n\n\t\tconst taskKey = JSON.stringify( taskConfig );\n\n\t\t// Check for an existing task using this buffer. A transferred buffer cannot be transferred\n\t\t// again from this thread.\n\t\tif ( _taskCache.has( buffer ) ) {\n\n\t\t\tconst cachedTask = _taskCache.get( buffer );\n\n\t\t\tif ( cachedTask.key === taskKey ) {\n\n\t\t\t\treturn cachedTask.promise;\n\n\t\t\t} else if ( buffer.byteLength === 0 ) {\n\n\t\t\t\t// Technically, it would be possible to wait for the previous task to complete,\n\t\t\t\t// transfer the buffer back, and decode again with the second configuration. That\n\t\t\t\t// is complex, and I don't know of any reason to decode a Draco buffer twice in\n\t\t\t\t// different ways, so this is left unimplemented.\n\t\t\t\tthrow new Error(\n\n\t\t\t\t\t'THREE.DRACOLoader: Unable to re-decode a buffer with different ' +\n\t\t\t\t\t'settings. Buffer has already been transferred.'\n\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tlet worker;\n\t\tconst taskID = this.workerNextTaskID ++;\n\t\tconst taskCost = buffer.byteLength;\n\n\t\t// Obtain a worker and assign a task, and construct a geometry instance\n\t\t// when the task completes.\n\t\tconst geometryPending = this._getWorker( taskID, taskCost )\n\t\t\t.then( ( _worker ) => {\n\n\t\t\t\tworker = _worker;\n\n\t\t\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\t\t\tworker._callbacks[ taskID ] = { resolve, reject };\n\n\t\t\t\t\tworker.postMessage( { type: 'decode', id: taskID, taskConfig, buffer }, [ buffer ] );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t} );\n\n\t\t\t} )\n\t\t\t.then( ( message ) => this._createGeometry( message.geometry ) );\n\n\t\t// Remove task from the task list.\n\t\t// Note: replaced '.finally()' with '.catch().then()' block - iOS 11 support (#19416)\n\t\tgeometryPending\n\t\t\t.catch( () => true )\n\t\t\t.then( () => {\n\n\t\t\t\tif ( worker && taskID ) {\n\n\t\t\t\t\tthis._releaseTask( worker, taskID );\n\n\t\t\t\t\t// this.debug();\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t// Cache the task result.\n\t\t_taskCache.set( buffer, {\n\n\t\t\tkey: taskKey,\n\t\t\tpromise: geometryPending\n\n\t\t} );\n\n\t\treturn geometryPending;\n\n\t}\n\n\t_createGeometry( geometryData ) {\n\n\t\tconst geometry = new BufferGeometry();\n\n\t\tif ( geometryData.index ) {\n\n\t\t\tgeometry.setIndex( new BufferAttribute( geometryData.index.array, 1 ) );\n\n\t\t}\n\n\t\tfor ( let i = 0; i < geometryData.attributes.length; i ++ ) {\n\n\t\t\tconst result = geometryData.attributes[ i ];\n\t\t\tconst name = result.name;\n\t\t\tconst array = result.array;\n\t\t\tconst itemSize = result.itemSize;\n\n\t\t\tconst attribute = new BufferAttribute( array, itemSize );\n\n\t\t\tif ( name === 'color' ) {\n\n\t\t\t\tthis._assignVertexColorSpace( attribute, result.vertexColorSpace );\n\n\t\t\t\tattribute.normalized = ( array instanceof Float32Array ) === false;\n\n\t\t\t}\n\n\t\t\tgeometry.setAttribute( name, attribute );\n\n\t\t}\n\n\t\treturn geometry;\n\n\t}\n\n\t_assignVertexColorSpace( attribute, inputColorSpace ) {\n\n\t\t// While .drc files do not specify colorspace, the only 'official' tooling\n\t\t// is PLY and OBJ converters, which use sRGB. We'll assume sRGB when a .drc\n\t\t// file is passed into .load() or .parse(). GLTFLoader uses internal APIs\n\t\t// to decode geometry, and vertex colors are already Linear-sRGB in there.\n\n\t\tif ( inputColorSpace !== SRGBColorSpace ) return;\n\n\t\tconst _color = new Color();\n\n\t\tfor ( let i = 0, il = attribute.count; i < il; i ++ ) {\n\n\t\t\t_color.fromBufferAttribute( attribute, i );\n\t\t\tColorManagement.toWorkingColorSpace( _color, SRGBColorSpace );\n\t\t\tattribute.setXYZ( i, _color.r, _color.g, _color.b );\n\n\t\t}\n\n\t}\n\n\t_loadLibrary( url, responseType ) {\n\n\t\tconst loader = new FileLoader( this.manager );\n\t\tloader.setPath( this.decoderPath );\n\t\tloader.setResponseType( responseType );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\treturn new Promise( ( resolve, reject ) => {\n\n\t\t\tloader.load( url, resolve, undefined, reject );\n\n\t\t} );\n\n\t}\n\n\tpreload() {\n\n\t\tthis._initDecoder();\n\n\t\treturn this;\n\n\t}\n\n\t_initDecoder() {\n\n\t\tif ( this.decoderPending ) return this.decoderPending;\n\n\t\tconst useJS = typeof WebAssembly !== 'object' || this.decoderConfig.type === 'js';\n\t\tconst librariesPending = [];\n\n\t\tif ( useJS ) {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.js', 'text' ) );\n\n\t\t} else {\n\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_wasm_wrapper.js', 'text' ) );\n\t\t\tlibrariesPending.push( this._loadLibrary( 'draco_decoder.wasm', 'arraybuffer' ) );\n\n\t\t}\n\n\t\tthis.decoderPending = Promise.all( librariesPending )\n\t\t\t.then( ( libraries ) => {\n\n\t\t\t\tconst jsContent = libraries[ 0 ];\n\n\t\t\t\tif ( ! useJS ) {\n\n\t\t\t\t\tthis.decoderConfig.wasmBinary = libraries[ 1 ];\n\n\t\t\t\t}\n\n\t\t\t\tconst fn = DRACOWorker.toString();\n\n\t\t\t\tconst body = [\n\t\t\t\t\t'/* draco decoder */',\n\t\t\t\t\tjsContent,\n\t\t\t\t\t'',\n\t\t\t\t\t'/* worker */',\n\t\t\t\t\tfn.substring( fn.indexOf( '{' ) + 1, fn.lastIndexOf( '}' ) )\n\t\t\t\t].join( '\\n' );\n\n\t\t\t\tthis.workerSourceURL = URL.createObjectURL( new Blob( [ body ] ) );\n\n\t\t\t} );\n\n\t\treturn this.decoderPending;\n\n\t}\n\n\t_getWorker( taskID, taskCost ) {\n\n\t\treturn this._initDecoder().then( () => {\n\n\t\t\tif ( this.workerPool.length < this.workerLimit ) {\n\n\t\t\t\tconst worker = new Worker( this.workerSourceURL );\n\n\t\t\t\tworker._callbacks = {};\n\t\t\t\tworker._taskCosts = {};\n\t\t\t\tworker._taskLoad = 0;\n\n\t\t\t\tworker.postMessage( { type: 'init', decoderConfig: this.decoderConfig } );\n\n\t\t\t\tworker.onmessage = function ( e ) {\n\n\t\t\t\t\tconst message = e.data;\n\n\t\t\t\t\tswitch ( message.type ) {\n\n\t\t\t\t\t\tcase 'decode':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].resolve( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tcase 'error':\n\t\t\t\t\t\t\tworker._callbacks[ message.id ].reject( message );\n\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tconsole.error( 'THREE.DRACOLoader: Unexpected message, \"' + message.type + '\"' );\n\n\t\t\t\t\t}\n\n\t\t\t\t};\n\n\t\t\t\tthis.workerPool.push( worker );\n\n\t\t\t} else {\n\n\t\t\t\tthis.workerPool.sort( function ( a, b ) {\n\n\t\t\t\t\treturn a._taskLoad > b._taskLoad ? - 1 : 1;\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tconst worker = this.workerPool[ this.workerPool.length - 1 ];\n\t\t\tworker._taskCosts[ taskID ] = taskCost;\n\t\t\tworker._taskLoad += taskCost;\n\t\t\treturn worker;\n\n\t\t} );\n\n\t}\n\n\t_releaseTask( worker, taskID ) {\n\n\t\tworker._taskLoad -= worker._taskCosts[ taskID ];\n\t\tdelete worker._callbacks[ taskID ];\n\t\tdelete worker._taskCosts[ taskID ];\n\n\t}\n\n\tdebug() {\n\n\t\tconsole.log( 'Task load: ', this.workerPool.map( ( worker ) => worker._taskLoad ) );\n\n\t}\n\n\tdispose() {\n\n\t\tfor ( let i = 0; i < this.workerPool.length; ++ i ) {\n\n\t\t\tthis.workerPool[ i ].terminate();\n\n\t\t}\n\n\t\tthis.workerPool.length = 0;\n\n\t\tif ( this.workerSourceURL !== '' ) {\n\n\t\t\tURL.revokeObjectURL( this.workerSourceURL );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n}\n\n/* WEB WORKER */\n\nfunction DRACOWorker() {\n\n\tlet decoderConfig;\n\tlet decoderPending;\n\n\tonmessage = function ( e ) {\n\n\t\tconst message = e.data;\n\n\t\tswitch ( message.type ) {\n\n\t\t\tcase 'init':\n\t\t\t\tdecoderConfig = message.decoderConfig;\n\t\t\t\tdecoderPending = new Promise( function ( resolve/*, reject*/ ) {\n\n\t\t\t\t\tdecoderConfig.onModuleLoaded = function ( draco ) {\n\n\t\t\t\t\t\t// Module is Promise-like. Wrap before resolving to avoid loop.\n\t\t\t\t\t\tresolve( { draco: draco } );\n\n\t\t\t\t\t};\n\n\t\t\t\t\tDracoDecoderModule( decoderConfig ); // eslint-disable-line no-undef\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t\tcase 'decode':\n\t\t\t\tconst buffer = message.buffer;\n\t\t\t\tconst taskConfig = message.taskConfig;\n\t\t\t\tdecoderPending.then( ( module ) => {\n\n\t\t\t\t\tconst draco = module.draco;\n\t\t\t\t\tconst decoder = new draco.Decoder();\n\n\t\t\t\t\ttry {\n\n\t\t\t\t\t\tconst geometry = decodeGeometry( draco, decoder, new Int8Array( buffer ), taskConfig );\n\n\t\t\t\t\t\tconst buffers = geometry.attributes.map( ( attr ) => attr.array.buffer );\n\n\t\t\t\t\t\tif ( geometry.index ) buffers.push( geometry.index.array.buffer );\n\n\t\t\t\t\t\tself.postMessage( { type: 'decode', id: message.id, geometry }, buffers );\n\n\t\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\t\tconsole.error( error );\n\n\t\t\t\t\t\tself.postMessage( { type: 'error', id: message.id, error: error.message } );\n\n\t\t\t\t\t} finally {\n\n\t\t\t\t\t\tdraco.destroy( decoder );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tfunction decodeGeometry( draco, decoder, array, taskConfig ) {\n\n\t\tconst attributeIDs = taskConfig.attributeIDs;\n\t\tconst attributeTypes = taskConfig.attributeTypes;\n\n\t\tlet dracoGeometry;\n\t\tlet decodingStatus;\n\n\t\tconst geometryType = decoder.GetEncodedGeometryType( array );\n\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tdracoGeometry = new draco.Mesh();\n\t\t\tdecodingStatus = decoder.DecodeArrayToMesh( array, array.byteLength, dracoGeometry );\n\n\t\t} else if ( geometryType === draco.POINT_CLOUD ) {\n\n\t\t\tdracoGeometry = new draco.PointCloud();\n\t\t\tdecodingStatus = decoder.DecodeArrayToPointCloud( array, array.byteLength, dracoGeometry );\n\n\t\t} else {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Unexpected geometry type.' );\n\n\t\t}\n\n\t\tif ( ! decodingStatus.ok() || dracoGeometry.ptr === 0 ) {\n\n\t\t\tthrow new Error( 'THREE.DRACOLoader: Decoding failed: ' + decodingStatus.error_msg() );\n\n\t\t}\n\n\t\tconst geometry = { index: null, attributes: [] };\n\n\t\t// Gather all vertex attributes.\n\t\tfor ( const attributeName in attributeIDs ) {\n\n\t\t\tconst attributeType = self[ attributeTypes[ attributeName ] ];\n\n\t\t\tlet attribute;\n\t\t\tlet attributeID;\n\n\t\t\t// A Draco file may be created with default vertex attributes, whose attribute IDs\n\t\t\t// are mapped 1:1 from their semantic name (POSITION, NORMAL, ...). Alternatively,\n\t\t\t// a Draco file may contain a custom set of attributes, identified by known unique\n\t\t\t// IDs. glTF files always do the latter, and `.drc` files typically do the former.\n\t\t\tif ( taskConfig.useUniqueIDs ) {\n\n\t\t\t\tattributeID = attributeIDs[ attributeName ];\n\t\t\t\tattribute = decoder.GetAttributeByUniqueId( dracoGeometry, attributeID );\n\n\t\t\t} else {\n\n\t\t\t\tattributeID = decoder.GetAttributeId( dracoGeometry, draco[ attributeIDs[ attributeName ] ] );\n\n\t\t\t\tif ( attributeID === - 1 ) continue;\n\n\t\t\t\tattribute = decoder.GetAttribute( dracoGeometry, attributeID );\n\n\t\t\t}\n\n\t\t\tconst attributeResult = decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute );\n\n\t\t\tif ( attributeName === 'color' ) {\n\n\t\t\t\tattributeResult.vertexColorSpace = taskConfig.vertexColorSpace;\n\n\t\t\t}\n\n\t\t\tgeometry.attributes.push( attributeResult );\n\n\t\t}\n\n\t\t// Add index.\n\t\tif ( geometryType === draco.TRIANGULAR_MESH ) {\n\n\t\t\tgeometry.index = decodeIndex( draco, decoder, dracoGeometry );\n\n\t\t}\n\n\t\tdraco.destroy( dracoGeometry );\n\n\t\treturn geometry;\n\n\t}\n\n\tfunction decodeIndex( draco, decoder, dracoGeometry ) {\n\n\t\tconst numFaces = dracoGeometry.num_faces();\n\t\tconst numIndices = numFaces * 3;\n\t\tconst byteLength = numIndices * 4;\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetTrianglesUInt32Array( dracoGeometry, byteLength, ptr );\n\t\tconst index = new Uint32Array( draco.HEAPF32.buffer, ptr, numIndices ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn { array: index, itemSize: 1 };\n\n\t}\n\n\tfunction decodeAttribute( draco, decoder, dracoGeometry, attributeName, attributeType, attribute ) {\n\n\t\tconst numComponents = attribute.num_components();\n\t\tconst numPoints = dracoGeometry.num_points();\n\t\tconst numValues = numPoints * numComponents;\n\t\tconst byteLength = numValues * attributeType.BYTES_PER_ELEMENT;\n\t\tconst dataType = getDracoDataType( draco, attributeType );\n\n\t\tconst ptr = draco._malloc( byteLength );\n\t\tdecoder.GetAttributeDataArrayForAllPoints( dracoGeometry, attribute, dataType, byteLength, ptr );\n\t\tconst array = new attributeType( draco.HEAPF32.buffer, ptr, numValues ).slice();\n\t\tdraco._free( ptr );\n\n\t\treturn {\n\t\t\tname: attributeName,\n\t\t\tarray: array,\n\t\t\titemSize: numComponents\n\t\t};\n\n\t}\n\n\tfunction getDracoDataType( draco, attributeType ) {\n\n\t\tswitch ( attributeType ) {\n\n\t\t\tcase Float32Array: return draco.DT_FLOAT32;\n\t\t\tcase Int8Array: return draco.DT_INT8;\n\t\t\tcase Int16Array: return draco.DT_INT16;\n\t\t\tcase Int32Array: return draco.DT_INT32;\n\t\t\tcase Uint8Array: return draco.DT_UINT8;\n\t\t\tcase Uint16Array: return draco.DT_UINT16;\n\t\t\tcase Uint32Array: return draco.DT_UINT32;\n\n\t\t}\n\n\t}\n\n}\n\nexport { DRACOLoader };\n","/**\n * GLB asset loader with caching and prioritized loading.\n *\n * Loading priority (from plan):\n * 1. TownHall, Worker idle - Startup\n * 2. Barracks, Farm, Tower, Keep - After first render\n * 3. Construction variants - When building starts\n * 4. Remaining buildings - Background\n * 5. Cavalry, Siege, animations - On-demand\n */\nimport * as THREE from 'three';\nimport { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\nimport { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';\n\n/** @typedef {{ model: THREE.Group, animations: THREE.AnimationClip[] }} LoadedAsset */\n\nconst MODELS_BASE = '/assets/models';\nconst DRACO_PATH = 'https://www.gstatic.com/draco/versioned/decoders/1.5.7/';\n\n// Asset manifest with loading priorities\nconst ASSET_MANIFEST = {\n  buildings: {\n    townhall: { path: 'buildings/TownHall.glb', priority: 1 },\n    barracks: { path: 'buildings/Barracks.glb', priority: 2 },\n    farm: { path: 'buildings/Farm.glb', priority: 2 },\n    house: { path: 'buildings/House.glb', priority: 3 },\n    library: { path: 'buildings/Library.glb', priority: 2 },\n    market: { path: 'buildings/Market.glb', priority: 3 },\n    stables: { path: 'buildings/Stables.glb', priority: 3 },\n    workshop: { path: 'buildings/Workshop.glb', priority: 2 },\n    // Blender MCP generated Night Elf buildings\n    nightelf_barracks: { path: '../models/nightelf_barracks.glb', priority: 2 },\n    nightelf_townhall: { path: '../models/nightelf_townhall.glb', priority: 1 },\n    nightelf_tower: { path: '../models/nightelf_tower.glb', priority: 2 },\n    nightelf_farm: { path: '../models/nightelf_farm.glb', priority: 2 },\n    nightelf_library: { path: '../models/nightelf_library.glb', priority: 2 },\n    // Human faction buildings\n    human_townhall: { path: '../models/human_townhall.glb', priority: 1 },\n    human_barracks: { path: '../models/human_barracks.glb', priority: 2 },\n    human_tower: { path: '../models/human_tower.glb', priority: 2 },\n    human_farm: { path: '../models/human_farm.glb', priority: 2 },\n    human_library: { path: '../models/human_library.glb', priority: 2 },\n    // Orc faction buildings\n    orc_townhall: { path: '../models/orc_townhall.glb', priority: 1 },\n    orc_barracks: { path: '../models/orc_barracks.glb', priority: 2 },\n    orc_tower: { path: '../models/orc_tower.glb', priority: 2 },\n    orc_farm: { path: '../models/orc_farm.glb', priority: 2 },\n    orc_library: { path: '../models/orc_library.glb', priority: 2 },\n    // Undead faction buildings\n    undead_townhall: { path: '../models/undead_townhall.glb', priority: 1 },\n    undead_barracks: { path: '../models/undead_barracks.glb', priority: 2 },\n    undead_tower: { path: '../models/undead_tower.glb', priority: 2 },\n    undead_farm: { path: '../models/undead_farm.glb', priority: 2 },\n    undead_library: { path: '../models/undead_library.glb', priority: 2 },\n  },\n  units: {\n    cart: { path: 'units/Cart.glb', priority: 1 },\n    worker_drone: { path: 'units/worker_drone.glb', priority: 1 },\n    worker_bot: { path: 'units/worker_bot.glb', priority: 1 },\n    worker_delivery: { path: 'units/worker_delivery.glb', priority: 1 },\n    // Blender MCP generated Night Elf units\n    blazecraft_drone: { path: '../models/worker_drone.glb', priority: 1 },\n    nightelf_archer: { path: '../models/nightelf_archer.glb', priority: 2 },\n    nightelf_mage: { path: '../models/nightelf_mage.glb', priority: 2 },\n    nightelf_warrior: { path: '../models/nightelf_warrior.glb', priority: 2 },\n    nightelf_cavalry: { path: '../models/nightelf_cavalry.glb', priority: 3 },\n    nightelf_catapult: { path: '../models/nightelf_catapult.glb', priority: 3 },\n    nightelf_hero: { path: '../models/nightelf_hero.glb', priority: 2 },\n    // Human faction units\n    human_archer: { path: '../models/human_archer.glb', priority: 2 },\n    human_mage: { path: '../models/human_mage.glb', priority: 2 },\n    human_warrior: { path: '../models/human_warrior.glb', priority: 2 },\n    human_cavalry: { path: '../models/human_cavalry.glb', priority: 3 },\n    human_catapult: { path: '../models/human_catapult.glb', priority: 3 },\n    human_hero: { path: '../models/human_hero.glb', priority: 2 },\n    // Orc faction units\n    orc_warrior: { path: '../models/orc_warrior.glb', priority: 2 },\n    orc_shaman: { path: '../models/orc_shaman.glb', priority: 2 },\n    orc_archer: { path: '../models/orc_archer.glb', priority: 2 },\n    orc_cavalry: { path: '../models/orc_cavalry.glb', priority: 3 },\n    orc_catapult: { path: '../models/orc_catapult.glb', priority: 3 },\n    orc_hero: { path: '../models/orc_hero.glb', priority: 2 },\n    // Undead faction units\n    undead_warrior: { path: '../models/undead_warrior.glb', priority: 2 },\n    undead_necromancer: { path: '../models/undead_necromancer.glb', priority: 2 },\n    undead_archer: { path: '../models/undead_archer.glb', priority: 2 },\n    undead_cavalry: { path: '../models/undead_cavalry.glb', priority: 3 },\n    undead_catapult: { path: '../models/undead_catapult.glb', priority: 3 },\n    undead_hero: { path: '../models/undead_hero.glb', priority: 2 },\n  },\n  mascot: {\n    blaze: { path: 'mascot/blaze.glb', priority: 1 },\n    // New Blender MCP generated Blaze dachshund mascot\n    blaze_3d: { path: '../models/blaze_mascot.glb', priority: 1 },\n  },\n  terrain: {\n    // New Blender MCP generated ground with burned_ground_01 texture\n    ground_burned: { path: '../models/ground_plane.glb', priority: 1 },\n    // Complete scene with all assets\n    blazecraft_scene: { path: '../models/blazecraft_scene.glb', priority: 1 },\n  },\n  props: {\n    barrel: { path: 'props/barrel.glb', priority: 3 },\n    lantern: { path: 'props/lantern.glb', priority: 3 },\n    trophy_cup: { path: 'props/trophy_cup.glb', priority: 3 },\n    baseball_scoreboard: { path: 'props/baseball_scoreboard.glb', priority: 4 },\n    football_goalpost: { path: 'props/football_goalpost.glb', priority: 4 },\n    traffic_cone: { path: 'props/traffic_cone.glb', priority: 4 },\n  },\n  environment: {\n    // Sketchfab imported environment assets\n    crystal: { path: '../models/env_crystal.glb', priority: 3 },\n    tree: { path: '../models/env_tree.glb', priority: 3 },\n    rock: { path: '../models/env_rock.glb', priority: 3 },\n  },\n  construction: {\n    'townhall_0': { path: 'buildings/construction/TownHall_0.glb', priority: 3 },\n    'townhall_1': { path: 'buildings/construction/TownHall_1.glb', priority: 3 },\n    'barracks_0': { path: 'buildings/construction/Barracks_0.glb', priority: 3 },\n    'barracks_1': { path: 'buildings/construction/Barracks_1.glb', priority: 3 },\n    'farm_0': { path: 'buildings/construction/Farm_0.glb', priority: 3 },\n    'farm_1': { path: 'buildings/construction/Farm_1.glb', priority: 3 },\n    'house_0': { path: 'buildings/construction/House_0.glb', priority: 4 },\n    'house_1': { path: 'buildings/construction/House_1.glb', priority: 4 },\n    'library_0': { path: 'buildings/construction/Library_0.glb', priority: 3 },\n    'library_1': { path: 'buildings/construction/Library_1.glb', priority: 3 },\n    'market_0': { path: 'buildings/construction/Market_0.glb', priority: 4 },\n    'market_1': { path: 'buildings/construction/Market_1.glb', priority: 4 },\n    'stables_0': { path: 'buildings/construction/Stables_0.glb', priority: 4 },\n    'stables_1': { path: 'buildings/construction/Stables_1.glb', priority: 4 },\n    'workshop_0': { path: 'buildings/construction/Workshop_0.glb', priority: 3 },\n    'workshop_1': { path: 'buildings/construction/Workshop_1.glb', priority: 3 },\n  },\n};\n\n/**\n * Asset loader with caching and priority queue.\n */\nexport class AssetLoader {\n  constructor() {\n    /** @type {Map<string, LoadedAsset>} */\n    this.cache = new Map();\n    /** @type {Map<string, Promise<LoadedAsset>>} */\n    this.pending = new Map();\n    /** @type {Set<string>} */\n    this.failed = new Set();\n\n    // Configure loaders\n    this.gltfLoader = new GLTFLoader();\n    this.dracoLoader = new DRACOLoader();\n    this.dracoLoader.setDecoderPath(DRACO_PATH);\n    this.gltfLoader.setDRACOLoader(this.dracoLoader);\n\n    /** @type {((loaded: number, total: number) => void) | null} */\n    this.onProgress = null;\n\n    this.totalAssets = 0;\n    this.loadedAssets = 0;\n  }\n\n  /**\n   * Load a single asset by key.\n   * @param {string} category - 'buildings' or 'construction'\n   * @param {string} key - Asset key (e.g., 'townhall')\n   * @returns {Promise<LoadedAsset | null>}\n   */\n  async load(category, key) {\n    const cacheKey = `${category}/${key}`;\n\n    // Return cached\n    if (this.cache.has(cacheKey)) {\n      return this.cache.get(cacheKey) ?? null;\n    }\n\n    // Return pending\n    if (this.pending.has(cacheKey)) {\n      return this.pending.get(cacheKey) ?? null;\n    }\n\n    // Skip failed\n    if (this.failed.has(cacheKey)) {\n      return null;\n    }\n\n    // Get manifest entry\n    const manifest = ASSET_MANIFEST[category];\n    if (!manifest || !manifest[key]) {\n      console.warn(`Asset not in manifest: ${cacheKey}`);\n      return null;\n    }\n\n    const url = `${MODELS_BASE}/${manifest[key].path}`;\n\n    // Create loading promise\n    const promise = this.loadGLB(url)\n      .then((asset) => {\n        this.cache.set(cacheKey, asset);\n        this.pending.delete(cacheKey);\n        this.loadedAssets++;\n        this.onProgress?.(this.loadedAssets, this.totalAssets);\n        return asset;\n      })\n      .catch((err) => {\n        console.error(`Failed to load ${cacheKey}:`, err);\n        this.failed.add(cacheKey);\n        this.pending.delete(cacheKey);\n        return null;\n      });\n\n    this.pending.set(cacheKey, promise);\n    return promise;\n  }\n\n  /**\n   * Load GLB file.\n   * @param {string} url\n   * @returns {Promise<LoadedAsset>}\n   */\n  loadGLB(url) {\n    return new Promise((resolve, reject) => {\n      this.gltfLoader.load(\n        url,\n        (gltf) => {\n          const model = gltf.scene;\n\n          // Configure model for shadows\n          model.traverse((child) => {\n            if (child instanceof THREE.Mesh) {\n              child.castShadow = true;\n              child.receiveShadow = true;\n\n              // Enhance materials for BSI look\n              if (child.material) {\n                const mat = child.material;\n                if (mat instanceof THREE.MeshStandardMaterial) {\n                  mat.roughness = Math.max(mat.roughness, 0.4);\n                  mat.envMapIntensity = 0.8;\n                }\n              }\n            }\n          });\n\n          resolve({\n            model,\n            animations: gltf.animations || [],\n          });\n        },\n        undefined,\n        reject\n      );\n    });\n  }\n\n  /**\n   * Get a clone of a cached model.\n   * @param {string} category\n   * @param {string} key\n   * @returns {THREE.Group | null}\n   */\n  getClone(category, key) {\n    const cacheKey = `${category}/${key}`;\n    const asset = this.cache.get(cacheKey);\n    if (!asset) return null;\n\n    const clone = asset.model.clone();\n\n    // Deep clone materials to allow per-instance modifications\n    clone.traverse((child) => {\n      if (child instanceof THREE.Mesh && child.material) {\n        if (Array.isArray(child.material)) {\n          child.material = child.material.map((m) => m.clone());\n        } else {\n          child.material = child.material.clone();\n        }\n      }\n    });\n\n    return clone;\n  }\n\n  /**\n   * Preload assets by priority.\n   * @param {number} maxPriority - Load assets up to this priority level\n   * @returns {Promise<void>}\n   */\n  async preloadByPriority(maxPriority) {\n    const toLoad = [];\n\n    for (const [category, assets] of Object.entries(ASSET_MANIFEST)) {\n      for (const [key, info] of Object.entries(assets)) {\n        if (info.priority <= maxPriority) {\n          toLoad.push({ category, key, priority: info.priority });\n        }\n      }\n    }\n\n    // Sort by priority\n    toLoad.sort((a, b) => a.priority - b.priority);\n\n    this.totalAssets = toLoad.length;\n    this.loadedAssets = 0;\n\n    // Load in batches to avoid overwhelming the browser\n    const batchSize = 4;\n    for (let i = 0; i < toLoad.length; i += batchSize) {\n      const batch = toLoad.slice(i, i + batchSize);\n      await Promise.all(batch.map((item) => this.load(item.category, item.key)));\n    }\n  }\n\n  /**\n   * Check if an asset is loaded.\n   * @param {string} category\n   * @param {string} key\n   * @returns {boolean}\n   */\n  isLoaded(category, key) {\n    return this.cache.has(`${category}/${key}`);\n  }\n\n  /**\n   * Get all loaded asset keys.\n   * @returns {string[]}\n   */\n  getLoadedKeys() {\n    return Array.from(this.cache.keys());\n  }\n\n  /**\n   * Dispose all cached assets.\n   */\n  dispose() {\n    for (const asset of this.cache.values()) {\n      asset.model.traverse((child) => {\n        if (child instanceof THREE.Mesh) {\n          child.geometry?.dispose();\n          if (Array.isArray(child.material)) {\n            child.material.forEach((m) => m.dispose());\n          } else {\n            child.material?.dispose();\n          }\n        }\n      });\n    }\n    this.cache.clear();\n    this.pending.clear();\n    this.failed.clear();\n    this.dracoLoader.dispose();\n  }\n}\n\n// Singleton instance\nexport const assetLoader = new AssetLoader();\n","/**\n * Building3DManager syncs Three.js meshes to CityManager state.\n *\n * Responsibilities:\n * - Spawns 3D models when CityManager adds buildings\n * - Swaps construction variants based on progress\n * - Handles tier upgrades with visual effects\n * - Manages building selection highlights\n */\nimport * as THREE from 'three';\nimport { assetLoader } from './asset-loader.js';\nimport { BUILDING_DEFS } from './buildings.js';\n\n/** @typedef {import('./buildings.js').Building} Building */\n/** @typedef {import('./buildings.js').BuildingType} BuildingType */\n\n// Map CityManager building types to asset keys\nconst BUILDING_TO_ASSET = {\n  townhall: 'townhall',\n  barracks: 'barracks',\n  farm: 'farm',\n  forge: 'workshop', // Forge uses Workshop model\n  library: 'library',\n  tower: 'house', // Tower uses House model (temporary)\n  workshop: 'workshop',\n  archive: 'library', // Archive uses Library model\n};\n\n// Scale factors for building types (world units)\nconst BUILDING_SCALES = {\n  townhall: 1.2,\n  barracks: 0.9,\n  farm: 0.85,\n  forge: 0.85,\n  library: 0.9,\n  tower: 0.6,\n  workshop: 0.95,\n  archive: 0.8,\n};\n\n// Convert 2D canvas position to 3D world position\n// Canvas is 1280Ã—720, world is 128Ã—72, centered at origin\nconst CANVAS_TO_WORLD_SCALE = 0.1;\nconst CANVAS_CENTER_X = 640;\nconst CANVAS_CENTER_Y = 360;\n\n/**\n * Building3DManager manages 3D representations of buildings.\n */\nexport class Building3DManager {\n  /**\n   * @param {THREE.Scene} scene\n   */\n  constructor(scene) {\n    this.scene = scene;\n\n    /** @type {Map<string, THREE.Group>} Building ID â†’ 3D group */\n    this.meshes = new Map();\n\n    /** @type {Map<string, { progress: number, tier: number }>} Track state for change detection */\n    this.state = new Map();\n\n    /** @type {string | null} */\n    this.selectedId = null;\n\n    // Selection highlight\n    this.selectionRing = this.createSelectionRing();\n    this.selectionRing.visible = false;\n    scene.add(this.selectionRing);\n\n    // Construction sparks particle system\n    this.sparksGeometry = new THREE.BufferGeometry();\n    this.sparksMaterial = new THREE.PointsMaterial({\n      color: 0xe86c2c,\n      size: 0.3,\n      transparent: true,\n      opacity: 0.8,\n      blending: THREE.AdditiveBlending,\n    });\n    this.sparks = new THREE.Points(this.sparksGeometry, this.sparksMaterial);\n    this.sparks.visible = false;\n    scene.add(this.sparks);\n  }\n\n  /**\n   * Create selection ring mesh.\n   * @returns {THREE.Mesh}\n   */\n  createSelectionRing() {\n    const geometry = new THREE.RingGeometry(3, 3.3, 32);\n    const material = new THREE.MeshBasicMaterial({\n      color: 0xe86c2c,\n      side: THREE.DoubleSide,\n      transparent: true,\n      opacity: 0.8,\n    });\n    const ring = new THREE.Mesh(geometry, material);\n    ring.rotation.x = -Math.PI / 2;\n    ring.position.y = 0.02;\n    return ring;\n  }\n\n  /**\n   * Convert canvas position to world position.\n   * @param {{ x: number, y: number }} canvasPos\n   * @returns {{ x: number, z: number }}\n   */\n  canvasToWorld(canvasPos) {\n    return {\n      x: (canvasPos.x - CANVAS_CENTER_X) * CANVAS_TO_WORLD_SCALE,\n      z: (canvasPos.y - CANVAS_CENTER_Y) * CANVAS_TO_WORLD_SCALE,\n    };\n  }\n\n  /**\n   * Sync 3D meshes with CityManager buildings.\n   * @param {Building[]} buildings\n   */\n  async sync(buildings) {\n    const currentIds = new Set(buildings.map((b) => b.id));\n\n    // Remove buildings no longer in CityManager\n    for (const [id, mesh] of this.meshes) {\n      if (!currentIds.has(id)) {\n        this.scene.remove(mesh);\n        this.meshes.delete(id);\n        this.state.delete(id);\n      }\n    }\n\n    // Update or add buildings\n    for (const building of buildings) {\n      const existing = this.meshes.get(building.id);\n      const prevState = this.state.get(building.id);\n\n      if (!existing) {\n        // New building - spawn it\n        await this.spawnBuilding(building);\n      } else {\n        // Existing building - check for changes\n        const needsModelSwap =\n          prevState &&\n          (this.getConstructionStage(building.constructionProgress) !==\n            this.getConstructionStage(prevState.progress) ||\n            building.tier !== prevState.tier);\n\n        if (needsModelSwap) {\n          await this.updateBuildingModel(building);\n        }\n\n        // Update opacity for construction progress\n        this.updateBuildingAppearance(building, existing);\n      }\n\n      // Update state tracking\n      this.state.set(building.id, {\n        progress: building.constructionProgress,\n        tier: building.tier,\n      });\n    }\n  }\n\n  /**\n   * Determine construction stage from progress (0, 1, or complete).\n   * @param {number} progress 0-100\n   * @returns {'stage0' | 'stage1' | 'complete'}\n   */\n  getConstructionStage(progress) {\n    if (progress >= 100) return 'complete';\n    if (progress >= 50) return 'stage1';\n    return 'stage0';\n  }\n\n  /**\n   * Spawn a new building in the scene.\n   * @param {Building} building\n   */\n  async spawnBuilding(building) {\n    const assetKey = BUILDING_TO_ASSET[building.type];\n    if (!assetKey) {\n      console.warn(`No asset mapping for building type: ${building.type}`);\n      return;\n    }\n\n    // Determine which model to load based on construction progress\n    let category = 'buildings';\n    let key = assetKey;\n\n    if (building.isConstructing && building.constructionProgress < 100) {\n      const stage = building.constructionProgress < 50 ? '0' : '1';\n      category = 'construction';\n      key = `${assetKey}_${stage}`;\n    }\n\n    // Try to load the model\n    const loaded = assetLoader.isLoaded(category, key);\n    if (!loaded) {\n      await assetLoader.load(category, key);\n    }\n\n    const mesh = assetLoader.getClone(category, key);\n    if (!mesh) {\n      // Fallback: create placeholder box\n      const placeholder = this.createPlaceholder(building);\n      this.meshes.set(building.id, placeholder);\n      this.scene.add(placeholder);\n      return;\n    }\n\n    // Position and scale\n    const worldPos = this.canvasToWorld(building.position);\n    mesh.position.set(worldPos.x, 0, worldPos.z);\n\n    const scale = BUILDING_SCALES[building.type] || 1;\n    const tierScale = 1 + (building.tier - 1) * 0.1;\n    mesh.scale.setScalar(scale * tierScale);\n\n    // Set name for raycasting\n    mesh.name = building.id;\n    mesh.userData.buildingId = building.id;\n    mesh.userData.buildingType = building.type;\n\n    this.meshes.set(building.id, mesh);\n    this.scene.add(mesh);\n\n    // Construction appearance\n    this.updateBuildingAppearance(building, mesh);\n  }\n\n  /**\n   * Update building model (for construction stage changes or tier upgrades).\n   * @param {Building} building\n   */\n  async updateBuildingModel(building) {\n    const existing = this.meshes.get(building.id);\n    if (existing) {\n      this.scene.remove(existing);\n      this.meshes.delete(building.id);\n    }\n\n    await this.spawnBuilding(building);\n  }\n\n  /**\n   * Update building appearance (opacity, effects).\n   * @param {Building} building\n   * @param {THREE.Group} mesh\n   */\n  updateBuildingAppearance(building, mesh) {\n    // Construction opacity\n    const alpha = building.isConstructing\n      ? 0.4 + (building.constructionProgress / 100) * 0.6\n      : 1;\n\n    mesh.traverse((child) => {\n      if (child instanceof THREE.Mesh && child.material) {\n        const mat = child.material;\n        if (mat instanceof THREE.MeshStandardMaterial) {\n          mat.transparent = alpha < 1;\n          mat.opacity = alpha;\n        }\n      }\n    });\n  }\n\n  /**\n   * Create placeholder box for missing models.\n   * @param {Building} building\n   * @returns {THREE.Group}\n   */\n  createPlaceholder(building) {\n    const def = BUILDING_DEFS[building.type];\n    const tierDef = def?.tiers[building.tier - 1];\n\n    const width = (building.size.w / 10) * 0.8;\n    const depth = (building.size.h / 10) * 0.8;\n    const height = 2 + building.tier * 0.5;\n\n    const geometry = new THREE.BoxGeometry(width, height, depth);\n    const material = new THREE.MeshStandardMaterial({\n      color: tierDef?.accent || 0x666666,\n      roughness: 0.7,\n      metalness: 0.2,\n    });\n\n    const mesh = new THREE.Mesh(geometry, material);\n    mesh.position.y = height / 2;\n    mesh.castShadow = true;\n    mesh.receiveShadow = true;\n\n    const group = new THREE.Group();\n    group.add(mesh);\n\n    const worldPos = this.canvasToWorld(building.position);\n    group.position.set(worldPos.x, 0, worldPos.z);\n    group.name = building.id;\n    group.userData.buildingId = building.id;\n    group.userData.buildingType = building.type;\n\n    return group;\n  }\n\n  /**\n   * Select a building by ID.\n   * @param {string | null} buildingId\n   */\n  select(buildingId) {\n    this.selectedId = buildingId;\n\n    if (!buildingId) {\n      this.selectionRing.visible = false;\n      return;\n    }\n\n    const mesh = this.meshes.get(buildingId);\n    if (mesh) {\n      this.selectionRing.position.x = mesh.position.x;\n      this.selectionRing.position.z = mesh.position.z;\n      this.selectionRing.visible = true;\n    }\n  }\n\n  /**\n   * Raycast to find building at screen position.\n   * @param {THREE.Raycaster} raycaster\n   * @returns {string | null} Building ID or null\n   */\n  raycast(raycaster) {\n    const meshArray = Array.from(this.meshes.values());\n    const intersects = raycaster.intersectObjects(meshArray, true);\n\n    for (const intersect of intersects) {\n      let obj = intersect.object;\n      while (obj && !obj.userData.buildingId) {\n        obj = obj.parent;\n      }\n      if (obj?.userData.buildingId) {\n        return obj.userData.buildingId;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Update per-frame animations.\n   * @param {number} delta\n   * @param {number} now\n   */\n  update(delta, now) {\n    // Animate selection ring\n    if (this.selectionRing.visible) {\n      this.selectionRing.rotation.z = now * 0.001;\n      const pulse = Math.sin(now * 0.003) * 0.1 + 0.9;\n      this.selectionRing.scale.setScalar(pulse);\n    }\n  }\n\n  /**\n   * Get 3D mesh for building.\n   * @param {string} buildingId\n   * @returns {THREE.Group | undefined}\n   */\n  getMesh(buildingId) {\n    return this.meshes.get(buildingId);\n  }\n\n  /**\n   * Dispose all resources.\n   */\n  dispose() {\n    for (const mesh of this.meshes.values()) {\n      this.scene.remove(mesh);\n    }\n    this.meshes.clear();\n    this.state.clear();\n\n    this.scene.remove(this.selectionRing);\n    this.scene.remove(this.sparks);\n\n    this.selectionRing.geometry.dispose();\n    if (this.selectionRing.material instanceof THREE.Material) {\n      this.selectionRing.material.dispose();\n    }\n    this.sparksGeometry.dispose();\n    this.sparksMaterial.dispose();\n  }\n}\n","/**\n * Worker3DManager syncs Three.js meshes to GameState workers.\n *\n * Responsibilities:\n * - Spawns 3D models or procedural geometry for workers\n * - Smooth position interpolation during movement\n * - Status-based material colors\n * - Handles worker selection highlights (multi-select)\n */\nimport * as THREE from 'three';\nimport { assetLoader } from './asset-loader.js';\n\n/** @typedef {import('./game-state.js').Worker} Worker */\n/** @typedef {import('./game-state.js').WorkerStatus} WorkerStatus */\n\n// Debug mode - set to true to see position markers and console logs\nconst DEBUG = true;\n\n// Status â†’ Material color mapping (BSI design tokens)\nconst STATUS_COLORS = {\n  idle: 0xcccccc,       // Neutral gray\n  moving: 0xBF5700,     // BSI burnt orange\n  working: 0x22c55e,    // Vibrant green\n  blocked: 0xef4444,    // Red\n  hold: 0xeab308,       // Yellow/amber\n  complete: 0x22c55e,   // Green (same as working)\n  terminated: 0x6b7280, // Muted gray (with reduced opacity)\n};\n\n// Convert 2D canvas position to 3D world position\n// Canvas is 1280Ã—720, world is 128Ã—72, centered at origin\nconst CANVAS_TO_WORLD_SCALE = 0.1;\nconst CANVAS_CENTER_X = 640;\nconst CANVAS_CENTER_Y = 360;\n\n// Interpolation speed (higher = faster catch-up)\nconst LERP_SPEED = 8;\n\n// Worker visual scale\nconst WORKER_SCALE = 0.6;\n\n/**\n * Worker3DManager manages 3D representations of workers.\n */\nexport class Worker3DManager {\n  /**\n   * @param {THREE.Scene} scene\n   */\n  constructor(scene) {\n    this.scene = scene;\n\n    /** @type {Map<string, THREE.Group>} Worker ID â†’ 3D group */\n    this.meshes = new Map();\n\n    /** @type {Map<string, { current: THREE.Vector3, target: THREE.Vector3, status: WorkerStatus }>} */\n    this.positions = new Map();\n\n    /** @type {Set<string>} Selected worker IDs */\n    this.selectedIds = new Set();\n\n    // Selection rings (one per selected worker)\n    /** @type {Map<string, THREE.Mesh>} */\n    this.selectionRings = new Map();\n\n    // Shared geometry for selection rings\n    this.ringGeometry = new THREE.RingGeometry(1.0, 1.15, 32);\n    this.ringMaterial = new THREE.MeshBasicMaterial({\n      color: 0xBF5700, // BSI burnt orange\n      side: THREE.DoubleSide,\n      transparent: true,\n      opacity: 0.9,\n    });\n\n    // Materials cache by status\n    /** @type {Map<WorkerStatus, THREE.MeshStandardMaterial>} */\n    this.statusMaterials = new Map();\n    for (const [status, color] of Object.entries(STATUS_COLORS)) {\n      const mat = new THREE.MeshStandardMaterial({\n        color,\n        roughness: 0.5,\n        metalness: 0.1,\n        transparent: status === 'terminated',\n        opacity: status === 'terminated' ? 0.5 : 1,\n      });\n      this.statusMaterials.set(/** @type {WorkerStatus} */ (status), mat);\n    }\n\n    // Worker model variants\n    this.workerModelTypes = ['worker_drone', 'worker_bot', 'worker_delivery'];\n    this.workerModelsLoaded = false;\n    this.loadWorkerModels();\n\n    // Debug visualization\n    if (DEBUG) {\n      // Axes helper at origin (R=X, G=Y, B=Z)\n      const axes = new THREE.AxesHelper(10);\n      axes.name = 'debug-axes';\n      scene.add(axes);\n\n      // Grid of reference points\n      for (let x = -60; x <= 60; x += 20) {\n        for (let z = -30; z <= 30; z += 20) {\n          const marker = new THREE.Mesh(\n            new THREE.SphereGeometry(0.3),\n            new THREE.MeshBasicMaterial({ color: 0x444444 })\n          );\n          marker.position.set(x, 0.1, z);\n          marker.name = 'debug-marker';\n          scene.add(marker);\n        }\n      }\n\n      console.log('[Worker3D] Debug mode enabled. Axes: R=X, G=Y, B=Z');\n      console.log('[Worker3D] Canvas center (640,360) â†’ World origin (0,0)');\n    }\n  }\n\n  /**\n   * Load new GLB worker models.\n   */\n  async loadWorkerModels() {\n    try {\n      const loadPromises = this.workerModelTypes.map(async (type) => {\n        if (!assetLoader.isLoaded('units', type)) {\n          await assetLoader.load('units', type);\n        }\n      });\n      await Promise.all(loadPromises);\n\n      // Check if at least one model loaded\n      this.workerModelsLoaded = this.workerModelTypes.some(\n        (type) => assetLoader.isLoaded('units', type)\n      );\n\n      if (DEBUG && this.workerModelsLoaded) {\n        console.log('[Worker3D] GLB worker models loaded');\n      }\n    } catch {\n      this.workerModelsLoaded = false;\n    }\n  }\n\n  /**\n   * Get a random worker model type.\n   * @param {string} workerId - Used to consistently assign same model to same worker\n   * @returns {string}\n   */\n  getWorkerModelType(workerId) {\n    // Use worker ID hash for consistent model assignment\n    let hash = 0;\n    for (let i = 0; i < workerId.length; i++) {\n      hash = ((hash << 5) - hash) + workerId.charCodeAt(i);\n      hash = hash & hash;\n    }\n    const index = Math.abs(hash) % this.workerModelTypes.length;\n    return this.workerModelTypes[index];\n  }\n\n  /**\n   * Convert canvas position to world position.\n   * @param {{ x: number, y: number }} canvasPos\n   * @returns {{ x: number, z: number }}\n   */\n  canvasToWorld(canvasPos) {\n    return {\n      x: (canvasPos.x - CANVAS_CENTER_X) * CANVAS_TO_WORLD_SCALE,\n      z: (canvasPos.y - CANVAS_CENTER_Y) * CANVAS_TO_WORLD_SCALE,\n    };\n  }\n\n  /**\n   * Sync 3D meshes with GameState workers.\n   * @param {Worker[]} workers\n   */\n  async sync(workers) {\n    const currentIds = new Set(workers.map((w) => w.id));\n\n    // Remove workers no longer in GameState\n    for (const [id, mesh] of this.meshes) {\n      if (!currentIds.has(id)) {\n        this.scene.remove(mesh);\n        this.meshes.delete(id);\n        this.positions.delete(id);\n\n        // Remove selection ring if exists\n        const ring = this.selectionRings.get(id);\n        if (ring) {\n          this.scene.remove(ring);\n          this.selectionRings.delete(id);\n        }\n      }\n    }\n\n    // Update or add workers\n    for (const worker of workers) {\n      const existing = this.meshes.get(worker.id);\n\n      if (!existing) {\n        // New worker - spawn it\n        await this.spawnWorker(worker);\n      } else {\n        // Existing worker - update target position and appearance\n        const posData = this.positions.get(worker.id);\n        if (posData) {\n          const worldPos = this.canvasToWorld(worker.position);\n          posData.target.set(worldPos.x, 0.5, worldPos.z);\n          posData.status = worker.status;\n        }\n        this.updateWorkerAppearance(worker, existing);\n      }\n    }\n  }\n\n  /**\n   * Spawn a new worker in the scene.\n   * @param {Worker} worker\n   */\n  async spawnWorker(worker) {\n    let mesh;\n\n    if (this.workerModelsLoaded) {\n      // Use one of the GLB worker models based on worker ID\n      const modelType = this.getWorkerModelType(worker.id);\n      mesh = assetLoader.getClone('units', modelType);\n      if (mesh) {\n        mesh.scale.setScalar(WORKER_SCALE);\n        mesh.userData.modelType = modelType;\n      }\n    }\n\n    // Fallback: create procedural worker if models not loaded\n    if (!mesh) {\n      mesh = this.createProceduralWorker(worker);\n    }\n\n    // Position\n    const worldPos = this.canvasToWorld(worker.position);\n    mesh.position.set(worldPos.x, 0.5, worldPos.z);\n\n    if (DEBUG) {\n      console.log(`[Worker3D] Spawned \"${worker.name}\" (${worker.id.slice(0,8)})`);\n      console.log(`  Canvas: (${worker.position.x.toFixed(0)}, ${worker.position.y.toFixed(0)})`);\n      console.log(`  World:  (${worldPos.x.toFixed(1)}, 0.5, ${worldPos.z.toFixed(1)})`);\n      console.log(`  Status: ${worker.status}`);\n    }\n\n    // Track position for interpolation\n    this.positions.set(worker.id, {\n      current: new THREE.Vector3(worldPos.x, 0.5, worldPos.z),\n      target: new THREE.Vector3(worldPos.x, 0.5, worldPos.z),\n      status: worker.status,\n    });\n\n    // Set name for raycasting\n    mesh.name = worker.id;\n    mesh.userData.workerId = worker.id;\n    mesh.userData.workerName = worker.name;\n\n    this.meshes.set(worker.id, mesh);\n    this.scene.add(mesh);\n\n    // Apply initial appearance\n    this.updateWorkerAppearance(worker, mesh);\n  }\n\n  /**\n   * Create procedural worker geometry - stylized RTS unit.\n   * @param {Worker} worker\n   * @returns {THREE.Group}\n   */\n  createProceduralWorker(worker) {\n    const group = new THREE.Group();\n    const statusColor = STATUS_COLORS[worker.status] || STATUS_COLORS.idle;\n\n    // Base/chassis - low wide cylinder (like a hovercraft base)\n    const baseGeom = new THREE.CylinderGeometry(0.5, 0.6, 0.2, 12);\n    const baseMat = new THREE.MeshStandardMaterial({\n      color: 0x2a2a2a,\n      roughness: 0.4,\n      metalness: 0.6,\n    });\n    const base = new THREE.Mesh(baseGeom, baseMat);\n    base.position.y = 0.1;\n    base.castShadow = true;\n    base.receiveShadow = true;\n    group.add(base);\n\n    // Body - rounded box shape\n    const bodyGeom = new THREE.BoxGeometry(0.7, 0.5, 0.9);\n    bodyGeom.translate(0, 0.45, 0);\n    const bodyMat = new THREE.MeshStandardMaterial({\n      color: statusColor,\n      roughness: 0.3,\n      metalness: 0.2,\n    });\n    const body = new THREE.Mesh(bodyGeom, bodyMat);\n    body.castShadow = true;\n    body.receiveShadow = true;\n    body.name = 'worker-body'; // For status color updates\n    group.add(body);\n\n    // Cockpit/head - smaller dome on top\n    const cockpitGeom = new THREE.SphereGeometry(0.25, 12, 8, 0, Math.PI * 2, 0, Math.PI / 2);\n    const cockpitMat = new THREE.MeshStandardMaterial({\n      color: 0x1a1a1a,\n      roughness: 0.1,\n      metalness: 0.8,\n    });\n    const cockpit = new THREE.Mesh(cockpitGeom, cockpitMat);\n    cockpit.position.y = 0.7;\n    cockpit.position.z = 0.15;\n    cockpit.castShadow = true;\n    group.add(cockpit);\n\n    // Front direction indicator - small triangle/arrow\n    const arrowShape = new THREE.Shape();\n    arrowShape.moveTo(0, 0.2);\n    arrowShape.lineTo(-0.15, -0.1);\n    arrowShape.lineTo(0.15, -0.1);\n    arrowShape.closePath();\n    const arrowGeom = new THREE.ShapeGeometry(arrowShape);\n    const arrowMat = new THREE.MeshBasicMaterial({\n      color: 0xBF5700, // BSI burnt orange\n      side: THREE.DoubleSide,\n    });\n    const arrow = new THREE.Mesh(arrowGeom, arrowMat);\n    arrow.rotation.x = -Math.PI / 2;\n    arrow.position.y = 0.22;\n    arrow.position.z = 0.7;\n    group.add(arrow);\n\n    // Status light (small glowing sphere)\n    const lightGeom = new THREE.SphereGeometry(0.08, 8, 8);\n    const lightMat = new THREE.MeshBasicMaterial({\n      color: statusColor,\n    });\n    const light = new THREE.Mesh(lightGeom, lightMat);\n    light.position.y = 0.75;\n    light.position.z = -0.3;\n    light.name = 'status-light';\n    group.add(light);\n\n    group.userData.isProcedural = true;\n    group.scale.setScalar(WORKER_SCALE);\n\n    return group;\n  }\n\n  /**\n   * Get material for worker status.\n   * @param {WorkerStatus} status\n   * @returns {THREE.MeshStandardMaterial}\n   */\n  getStatusMaterial(status) {\n    return this.statusMaterials.get(status) || this.statusMaterials.get('idle');\n  }\n\n  /**\n   * Update worker appearance based on status.\n   * @param {Worker} worker\n   * @param {THREE.Group} mesh\n   */\n  updateWorkerAppearance(worker, mesh) {\n    const color = STATUS_COLORS[worker.status] || STATUS_COLORS.idle;\n    const isTerminated = worker.status === 'terminated';\n\n    mesh.traverse((child) => {\n      if (child instanceof THREE.Mesh && child.material) {\n        // Update body color (named 'worker-body')\n        if (child.name === 'worker-body') {\n          const mat = child.material;\n          if (mat instanceof THREE.MeshStandardMaterial) {\n            mat.color.setHex(color);\n            mat.transparent = isTerminated;\n            mat.opacity = isTerminated ? 0.5 : 1;\n          }\n        }\n        // Update status light\n        if (child.name === 'status-light') {\n          const mat = child.material;\n          if (mat instanceof THREE.MeshBasicMaterial) {\n            mat.color.setHex(color);\n          }\n        }\n      }\n    });\n  }\n\n  /**\n   * Select workers by ID array.\n   * @param {string[]} workerIds\n   */\n  select(workerIds) {\n    // Clear previous selection rings\n    for (const [id, ring] of this.selectionRings) {\n      if (!workerIds.includes(id)) {\n        this.scene.remove(ring);\n        this.selectionRings.delete(id);\n      }\n    }\n\n    this.selectedIds = new Set(workerIds);\n\n    // Add selection rings for newly selected workers\n    for (const id of workerIds) {\n      if (!this.selectionRings.has(id)) {\n        const mesh = this.meshes.get(id);\n        if (mesh) {\n          const ring = this.createSelectionRing();\n          ring.position.copy(mesh.position);\n          ring.position.y = 0.02;\n          this.scene.add(ring);\n          this.selectionRings.set(id, ring);\n        }\n      }\n    }\n  }\n\n  /**\n   * Create selection ring mesh.\n   * @returns {THREE.Mesh}\n   */\n  createSelectionRing() {\n    const ring = new THREE.Mesh(this.ringGeometry, this.ringMaterial.clone());\n    ring.rotation.x = -Math.PI / 2;\n    return ring;\n  }\n\n  /**\n   * Raycast to find worker at screen position.\n   * @param {THREE.Raycaster} raycaster\n   * @returns {string | null} Worker ID or null\n   */\n  raycast(raycaster) {\n    const meshArray = Array.from(this.meshes.values());\n    const intersects = raycaster.intersectObjects(meshArray, true);\n\n    for (const intersect of intersects) {\n      let obj = intersect.object;\n      while (obj && !obj.userData.workerId) {\n        obj = obj.parent;\n      }\n      if (obj?.userData.workerId) {\n        return obj.userData.workerId;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Update per-frame animations and interpolation.\n   * @param {number} delta - Time since last frame in seconds\n   * @param {number} now - Current timestamp in milliseconds\n   */\n  update(delta, now) {\n    // Interpolate worker positions\n    for (const [id, posData] of this.positions) {\n      const mesh = this.meshes.get(id);\n      if (!mesh) continue;\n\n      // Smooth lerp towards target\n      const lerpFactor = Math.min(1, LERP_SPEED * delta);\n      posData.current.lerp(posData.target, lerpFactor);\n      mesh.position.copy(posData.current);\n\n      // Rotate to face movement direction\n      const dx = posData.target.x - posData.current.x;\n      const dz = posData.target.z - posData.current.z;\n      if (Math.abs(dx) > 0.01 || Math.abs(dz) > 0.01) {\n        mesh.rotation.y = Math.atan2(dx, dz);\n      }\n\n      // Bobbing animation when moving\n      if (posData.status === 'moving') {\n        mesh.position.y = 0.5 + Math.sin(now * 0.008) * 0.05;\n      } else if (posData.status === 'working') {\n        // Subtle pulse when working\n        const pulse = 1 + Math.sin(now * 0.006) * 0.03;\n        mesh.scale.setScalar(WORKER_SCALE * pulse);\n      } else {\n        mesh.position.y = 0.5;\n        mesh.scale.setScalar(WORKER_SCALE);\n      }\n\n      // Update selection ring position\n      const ring = this.selectionRings.get(id);\n      if (ring) {\n        ring.position.x = mesh.position.x;\n        ring.position.z = mesh.position.z;\n        ring.rotation.z = now * 0.001;\n        const ringPulse = Math.sin(now * 0.003) * 0.1 + 0.9;\n        ring.scale.setScalar(ringPulse);\n      }\n    }\n  }\n\n  /**\n   * Get 3D mesh for worker.\n   * @param {string} workerId\n   * @returns {THREE.Group | undefined}\n   */\n  getMesh(workerId) {\n    return this.meshes.get(workerId);\n  }\n\n  /**\n   * Get all worker IDs currently rendered.\n   * @returns {string[]}\n   */\n  getWorkerIds() {\n    return Array.from(this.meshes.keys());\n  }\n\n  /**\n   * Dispose all resources.\n   */\n  dispose() {\n    // Remove meshes\n    for (const mesh of this.meshes.values()) {\n      this.scene.remove(mesh);\n    }\n    this.meshes.clear();\n    this.positions.clear();\n\n    // Remove selection rings\n    for (const ring of this.selectionRings.values()) {\n      this.scene.remove(ring);\n    }\n    this.selectionRings.clear();\n    this.selectedIds.clear();\n\n    // Dispose shared geometries\n    this.ringGeometry.dispose();\n    this.ringMaterial.dispose();\n\n    // Dispose status materials\n    for (const mat of this.statusMaterials.values()) {\n      mat.dispose();\n    }\n    this.statusMaterials.clear();\n  }\n}\n","/**\n * WebSocket event bridge for BlazeCraft.\n *\n * Connects to the local aggregator to receive real Claude Code events.\n * Falls back to mock data if aggregator unavailable.\n */\n\nconst WS_URL = 'ws://localhost:7778';\nconst RECONNECT_DELAY = 3000;\nconst MAX_RECONNECT_ATTEMPTS = 5;\n\n/**\n * @typedef {{ spawns: number, commands: number, production: number, research: number, repairs: number, storage: number, defense: number }} EventStats\n * @typedef {{ type: string, category: string, timestamp: number, sessionId: string, context?: object }} BlazeCraftEvent\n */\n\n/**\n * Event bridge manages WebSocket connection to aggregator.\n */\nexport class EventBridge {\n  constructor() {\n    /** @type {WebSocket | null} */\n    this.ws = null;\n    this.reconnectAttempts = 0;\n    this.connected = false;\n\n    /** @type {((event: BlazeCraftEvent) => void)[]} */\n    this.eventListeners = [];\n    /** @type {((stats: EventStats) => void)[]} */\n    this.statsListeners = [];\n    /** @type {((connected: boolean) => void)[]} */\n    this.connectionListeners = [];\n\n    /** @type {EventStats} */\n    this.stats = {\n      spawns: 0,\n      commands: 0,\n      production: 0,\n      research: 0,\n      repairs: 0,\n      storage: 0,\n      defense: 0,\n    };\n\n    /** @type {BlazeCraftEvent[]} */\n    this.eventHistory = [];\n  }\n\n  /**\n   * Connect to aggregator WebSocket.\n   */\n  connect() {\n    if (this.ws && this.ws.readyState === WebSocket.OPEN) {\n      return;\n    }\n\n    try {\n      this.ws = new WebSocket(WS_URL);\n\n      this.ws.onopen = () => {\n        console.log('[Bridge] Connected to aggregator');\n        this.connected = true;\n        this.reconnectAttempts = 0;\n        this.notifyConnection(true);\n      };\n\n      this.ws.onclose = () => {\n        console.log('[Bridge] Disconnected from aggregator');\n        this.connected = false;\n        this.notifyConnection(false);\n        this.scheduleReconnect();\n      };\n\n      this.ws.onerror = (err) => {\n        console.warn('[Bridge] WebSocket error:', err);\n      };\n\n      this.ws.onmessage = (event) => {\n        try {\n          const data = JSON.parse(event.data);\n          this.handleMessage(data);\n        } catch (err) {\n          console.error('[Bridge] Failed to parse message:', err);\n        }\n      };\n    } catch (err) {\n      console.warn('[Bridge] Failed to connect:', err);\n      this.scheduleReconnect();\n    }\n  }\n\n  /**\n   * Handle incoming WebSocket message.\n   * @param {{ type: string, event?: BlazeCraftEvent, stats?: EventStats, events?: BlazeCraftEvent[] }} data\n   */\n  handleMessage(data) {\n    if (data.type === 'init') {\n      // Initial state from aggregator\n      if (data.stats) {\n        this.stats = { ...data.stats };\n        this.notifyStats(this.stats);\n      }\n      if (data.events) {\n        this.eventHistory = data.events;\n        data.events.forEach((e) => this.notifyEvent(e));\n      }\n    } else if (data.type === 'event') {\n      // New event\n      if (data.event) {\n        this.eventHistory.push(data.event);\n        if (this.eventHistory.length > 100) {\n          this.eventHistory.shift();\n        }\n        this.notifyEvent(data.event);\n      }\n      if (data.stats) {\n        this.stats = { ...data.stats };\n        this.notifyStats(this.stats);\n      }\n    }\n  }\n\n  /**\n   * Schedule reconnection attempt.\n   */\n  scheduleReconnect() {\n    if (this.reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n      console.log('[Bridge] Max reconnect attempts reached, giving up');\n      return;\n    }\n\n    this.reconnectAttempts++;\n    const delay = RECONNECT_DELAY * Math.pow(1.5, this.reconnectAttempts - 1);\n    console.log(`[Bridge] Reconnecting in ${Math.round(delay / 1000)}s (attempt ${this.reconnectAttempts})`);\n\n    setTimeout(() => {\n      this.connect();\n    }, delay);\n  }\n\n  /**\n   * Subscribe to events.\n   * @param {(event: BlazeCraftEvent) => void} listener\n   * @returns {() => void} Unsubscribe function\n   */\n  onEvent(listener) {\n    this.eventListeners.push(listener);\n    return () => {\n      const idx = this.eventListeners.indexOf(listener);\n      if (idx >= 0) this.eventListeners.splice(idx, 1);\n    };\n  }\n\n  /**\n   * Subscribe to stats updates.\n   * @param {(stats: EventStats) => void} listener\n   * @returns {() => void} Unsubscribe function\n   */\n  onStats(listener) {\n    this.statsListeners.push(listener);\n    // Immediately call with current stats\n    listener(this.stats);\n    return () => {\n      const idx = this.statsListeners.indexOf(listener);\n      if (idx >= 0) this.statsListeners.splice(idx, 1);\n    };\n  }\n\n  /**\n   * Subscribe to connection state changes.\n   * @param {(connected: boolean) => void} listener\n   * @returns {() => void} Unsubscribe function\n   */\n  onConnection(listener) {\n    this.connectionListeners.push(listener);\n    listener(this.connected);\n    return () => {\n      const idx = this.connectionListeners.indexOf(listener);\n      if (idx >= 0) this.connectionListeners.splice(idx, 1);\n    };\n  }\n\n  /**\n   * Notify event listeners.\n   * @param {BlazeCraftEvent} event\n   */\n  notifyEvent(event) {\n    this.eventListeners.forEach((l) => {\n      try {\n        l(event);\n      } catch (err) {\n        console.error('[Bridge] Event listener error:', err);\n      }\n    });\n  }\n\n  /**\n   * Notify stats listeners.\n   * @param {EventStats} stats\n   */\n  notifyStats(stats) {\n    this.statsListeners.forEach((l) => {\n      try {\n        l(stats);\n      } catch (err) {\n        console.error('[Bridge] Stats listener error:', err);\n      }\n    });\n  }\n\n  /**\n   * Notify connection listeners.\n   * @param {boolean} connected\n   */\n  notifyConnection(connected) {\n    this.connectionListeners.forEach((l) => {\n      try {\n        l(connected);\n      } catch (err) {\n        console.error('[Bridge] Connection listener error:', err);\n      }\n    });\n  }\n\n  /**\n   * Get current stats.\n   * @returns {EventStats}\n   */\n  getStats() {\n    return { ...this.stats };\n  }\n\n  /**\n   * Check if connected to aggregator.\n   * @returns {boolean}\n   */\n  isConnected() {\n    return this.connected;\n  }\n\n  /**\n   * Disconnect from aggregator.\n   */\n  disconnect() {\n    if (this.ws) {\n      this.ws.close();\n      this.ws = null;\n    }\n  }\n}\n\n// Singleton instance\nexport const eventBridge = new EventBridge();\n","/**\n * FactionSystem - Team-as-faction gameplay modifiers\n *\n * Team selection derives gameplay modifiers from real team statistics:\n * - High offense (5+ RPG): +15% production speed, +10% gold\n * - Low ERA (â‰¤3.5): +20% morale, -20% crisis duration\n * - Win streak (5+): +25% influence\n * - Low errors: -15% crisis duration\n *\n * @typedef {'mlb'|'nfl'|'ncaaf'|'nba'|'nhl'} League\n *\n * @typedef {{\n *   productionSpeed: number,\n *   goldBonus: number,\n *   moraleBonus: number,\n *   crisisDuration: number,\n *   influenceBonus: number,\n *   intelBonus: number\n * }} FactionModifiers\n *\n * @typedef {{\n *   runsPerGame?: number,\n *   era?: number,\n *   winStreak?: number,\n *   errors?: number,\n *   pointsPerGame?: number,\n *   pointsAllowed?: number,\n *   wins?: number,\n *   losses?: number\n * }} TeamStats\n *\n * @typedef {{\n *   teamId: string,\n *   league: League,\n *   selectedAt: number\n * }} FactionSelection\n */\n\nconst STORAGE_KEY = 'bsi_blazecraft_faction';\n\n/** Default modifiers (no faction selected) */\nconst DEFAULT_MODIFIERS = {\n  productionSpeed: 1.0,\n  goldBonus: 0,\n  moraleBonus: 0,\n  crisisDuration: 1.0,\n  influenceBonus: 0,\n  intelBonus: 0,\n};\n\n/**\n * Trait definitions with thresholds and effects.\n */\nconst TRAITS = {\n  production: {\n    name: 'Production',\n    description: '+15% production speed, +10% gold',\n    check: (stats) => (stats.runsPerGame ?? 0) >= 5 || (stats.pointsPerGame ?? 0) >= 25,\n    apply: (mods) => {\n      mods.productionSpeed *= 1.15;\n      mods.goldBonus += 10;\n    },\n  },\n  defense: {\n    name: 'Defense',\n    description: '+20% morale, -20% crisis duration',\n    check: (stats) => (stats.era ?? 999) <= 3.5 || (stats.pointsAllowed ?? 999) <= 20,\n    apply: (mods) => {\n      mods.moraleBonus += 20;\n      mods.crisisDuration *= 0.8;\n    },\n  },\n  momentum: {\n    name: 'Momentum',\n    description: '+25% influence',\n    check: (stats) => (stats.winStreak ?? 0) >= 5,\n    apply: (mods) => {\n      mods.influenceBonus += 25;\n    },\n  },\n  discipline: {\n    name: 'Discipline',\n    description: '-15% crisis duration',\n    check: (stats) => (stats.errors ?? 999) <= 50,\n    apply: (mods) => {\n      mods.crisisDuration *= 0.85;\n    },\n  },\n  intel: {\n    name: 'Intel',\n    description: '+15% intel gain',\n    check: (stats) => {\n      const winPct = stats.wins && stats.losses\n        ? stats.wins / (stats.wins + stats.losses)\n        : 0;\n      return winPct >= 0.6;\n    },\n    apply: (mods) => {\n      mods.intelBonus += 15;\n    },\n  },\n};\n\n/**\n * FactionSystem manages team selection and gameplay modifiers.\n */\nexport class FactionSystem {\n  constructor() {\n    /** @type {string|null} */\n    this.teamId = null;\n    /** @type {League|null} */\n    this.league = null;\n    /** @type {TeamStats|null} */\n    this.stats = null;\n    /** @type {FactionModifiers} */\n    this.modifiers = { ...DEFAULT_MODIFIERS };\n    /** @type {string[]} */\n    this.activeTraits = [];\n    /** @type {((faction: FactionSelection|null) => void)[]} */\n    this.listeners = [];\n\n    this.loadFromStorage();\n  }\n\n  /**\n   * Set faction (team selection).\n   * @param {string} teamId\n   * @param {League} league\n   * @param {TeamStats} [stats]\n   */\n  setFaction(teamId, league, stats = {}) {\n    this.teamId = teamId;\n    this.league = league;\n    this.stats = stats;\n    this.modifiers = this.calculateModifiers(stats);\n\n    const selection = { teamId, league, selectedAt: Date.now() };\n    this.saveToStorage(selection);\n    this.notifyListeners(selection);\n  }\n\n  /**\n   * Clear faction selection.\n   */\n  clearFaction() {\n    this.teamId = null;\n    this.league = null;\n    this.stats = null;\n    this.modifiers = { ...DEFAULT_MODIFIERS };\n    this.activeTraits = [];\n\n    localStorage.removeItem(STORAGE_KEY);\n    this.notifyListeners(null);\n  }\n\n  /**\n   * Update stats for current faction.\n   * @param {TeamStats} stats\n   */\n  updateStats(stats) {\n    if (!this.teamId) return;\n\n    this.stats = stats;\n    this.modifiers = this.calculateModifiers(stats);\n    this.notifyListeners({ teamId: this.teamId, league: this.league, selectedAt: Date.now() });\n  }\n\n  /**\n   * Calculate modifiers from team stats.\n   * @param {TeamStats} stats\n   * @returns {FactionModifiers}\n   */\n  calculateModifiers(stats) {\n    const mods = { ...DEFAULT_MODIFIERS };\n    this.activeTraits = [];\n\n    for (const [key, trait] of Object.entries(TRAITS)) {\n      if (trait.check(stats)) {\n        trait.apply(mods);\n        this.activeTraits.push(key);\n      }\n    }\n\n    return mods;\n  }\n\n  /**\n   * Apply modifiers to a resource effect.\n   * @param {{gold?: number, intel?: number, influence?: number, morale?: number, workerSlots?: number}} effect\n   * @returns {{gold?: number, intel?: number, influence?: number, morale?: number, workerSlots?: number}}\n   */\n  applyModifiers(effect) {\n    const modified = { ...effect };\n\n    if (modified.gold !== undefined && modified.gold > 0) {\n      modified.gold = Math.round(modified.gold * (1 + this.modifiers.goldBonus / 100));\n    }\n\n    if (modified.intel !== undefined && modified.intel > 0) {\n      modified.intel = Math.round(modified.intel * (1 + this.modifiers.intelBonus / 100));\n    }\n\n    if (modified.influence !== undefined && modified.influence > 0) {\n      modified.influence = Math.round(modified.influence * (1 + this.modifiers.influenceBonus / 100));\n    }\n\n    if (modified.morale !== undefined) {\n      modified.morale = Math.round(modified.morale + this.modifiers.moraleBonus);\n    }\n\n    return modified;\n  }\n\n  /**\n   * Apply crisis duration modifier.\n   * @param {number} duration - Base duration in seconds\n   * @returns {number} Modified duration\n   */\n  applyCrisisDuration(duration) {\n    return Math.round(duration * this.modifiers.crisisDuration);\n  }\n\n  /**\n   * Apply production speed modifier.\n   * @param {number} rate - Base production rate\n   * @returns {number} Modified rate\n   */\n  applyProductionSpeed(rate) {\n    return rate * this.modifiers.productionSpeed;\n  }\n\n  /**\n   * Check if a faction is selected.\n   * @returns {boolean}\n   */\n  hasFaction() {\n    return this.teamId !== null;\n  }\n\n  /**\n   * Get current faction info.\n   * @returns {FactionSelection|null}\n   */\n  getFaction() {\n    if (!this.teamId || !this.league) return null;\n    return { teamId: this.teamId, league: this.league, selectedAt: Date.now() };\n  }\n\n  /**\n   * Get active traits for display.\n   * @returns {{key: string, name: string, description: string}[]}\n   */\n  getActiveTraits() {\n    return this.activeTraits.map((key) => ({\n      key,\n      name: TRAITS[key].name,\n      description: TRAITS[key].description,\n    }));\n  }\n\n  /**\n   * Get current modifiers.\n   * @returns {FactionModifiers}\n   */\n  getModifiers() {\n    return { ...this.modifiers };\n  }\n\n  /**\n   * Subscribe to faction changes.\n   * @param {(faction: FactionSelection|null) => void} listener\n   * @returns {() => void} Unsubscribe function\n   */\n  subscribe(listener) {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter((l) => l !== listener);\n    };\n  }\n\n  /**\n   * @private\n   */\n  notifyListeners(faction) {\n    for (const listener of this.listeners) {\n      listener(faction);\n    }\n  }\n\n  /**\n   * @private\n   */\n  loadFromStorage() {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEY);\n      if (stored) {\n        const selection = JSON.parse(stored);\n        this.teamId = selection.teamId;\n        this.league = selection.league;\n        // Stats will be refreshed from live data\n      }\n    } catch {\n      // Ignore storage errors\n    }\n  }\n\n  /**\n   * @private\n   * @param {FactionSelection} selection\n   */\n  saveToStorage(selection) {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(selection));\n    } catch {\n      // Ignore storage errors\n    }\n  }\n}\n\n/** Singleton instance */\nexport const factionSystem = new FactionSystem();\n","/**\n * GameBridge - SSE client for BSI sports events\n *\n * Connects to bsi-gamebridge Worker to receive real sports data\n * transformed into BlazeCraft game events.\n *\n * @typedef {'spectator'|'manager'|'commander'} ClientMode\n * @typedef {'free'|'pro'|'enterprise'} SubscriptionTier\n * @typedef {'mlb'|'nfl'|'ncaaf'|'nba'|'nhl'} League\n *\n * @typedef {{\n *   id: string,\n *   type: string,\n *   timestamp: string,\n *   source: 'bsi'|'sim',\n *   priority: 1|2|3,\n *   payload: object,\n *   gameContext?: object\n * }} BlazeCraftEvent\n *\n * @typedef {{\n *   spawns: number,\n *   commands: number,\n *   production: number,\n *   research: number,\n *   repairs: number,\n *   storage: number,\n *   defense: number\n * }} EventStats\n */\n\nimport { factionSystem } from './faction-system.js';\n\nconst DEFAULT_ENDPOINT = '/api/gamebridge/stream';\nconst RECONNECT_BASE_DELAY = 1000;\nconst MAX_RECONNECT_DELAY = 30000;\nconst MAX_RECONNECT_ATTEMPTS = 10;\n\n/** Event type to stat category mapping */\nconst EVENT_STAT_MAP = {\n  WORLD_TICK: 'defense',\n  GAME_START: 'spawns',\n  GAME_UPDATE: 'production',\n  GAME_FINAL: 'commands',\n  STANDINGS_DELTA: 'defense',\n  LINEUP_POSTED: 'research',\n  ODDS_SHIFT: 'storage',\n  HIGHLIGHT_CLIP: 'production',\n  INJURY_ALERT: 'repairs',\n  MOMENTUM_SWING: 'defense',\n};\n\n/**\n * GameBridge manages SSE connection to bsi-gamebridge Worker.\n */\nexport class GameBridge {\n  /**\n   * @param {{\n   *   endpoint?: string,\n   *   mode?: ClientMode,\n   *   tier?: SubscriptionTier,\n   *   leagues?: League[],\n   *   teams?: string[],\n   *   demo?: boolean,\n   *   onEvent?: (event: BlazeCraftEvent) => void,\n   *   onStats?: (stats: EventStats) => void,\n   *   onConnection?: (connected: boolean) => void,\n   *   onError?: (error: Error) => void\n   * }} options\n   */\n  constructor(options = {}) {\n    this.endpoint = options.endpoint || DEFAULT_ENDPOINT;\n    this.mode = options.mode || 'spectator';\n    this.tier = options.tier || 'free';\n    this.leagues = options.leagues || ['mlb', 'nfl', 'ncaaf'];\n    this.teams = options.teams || [];\n    this.demoMode = options.demo ?? true;\n\n    /** @type {(event: BlazeCraftEvent) => void} */\n    this.onEvent = options.onEvent || (() => {});\n    /** @type {(stats: EventStats) => void} */\n    this.onStats = options.onStats || (() => {});\n    /** @type {(connected: boolean) => void} */\n    this.onConnection = options.onConnection || (() => {});\n    /** @type {(error: Error) => void} */\n    this.onError = options.onError || (() => {});\n\n    /** @type {EventSource|null} */\n    this.eventSource = null;\n    this.connected = false;\n    this.reconnectAttempts = 0;\n    this.reconnectTimeout = null;\n\n    /** @type {EventStats} */\n    this.stats = {\n      spawns: 0,\n      commands: 0,\n      production: 0,\n      research: 0,\n      repairs: 0,\n      storage: 0,\n      defense: 0,\n    };\n\n    /** @type {BlazeCraftEvent[]} */\n    this.eventHistory = [];\n    this.maxHistorySize = 100;\n  }\n\n  /**\n   * Build SSE endpoint URL with query parameters.\n   * @returns {string}\n   */\n  buildUrl() {\n    const params = new URLSearchParams({\n      mode: this.mode,\n      leagues: this.leagues.join(','),\n      demo: String(this.demoMode),\n    });\n\n    if (this.teams.length > 0) {\n      params.set('teams', this.teams.join(','));\n    }\n\n    return `${this.endpoint}?${params.toString()}`;\n  }\n\n  /**\n   * Connect to the SSE endpoint.\n   */\n  connect() {\n    if (this.eventSource) {\n      this.disconnect();\n    }\n\n    const url = this.buildUrl();\n\n    try {\n      this.eventSource = new EventSource(url);\n\n      this.eventSource.onopen = () => {\n        this.connected = true;\n        this.reconnectAttempts = 0;\n        this.onConnection(true);\n      };\n\n      this.eventSource.onerror = (err) => {\n        this.connected = false;\n        this.onConnection(false);\n\n        if (this.eventSource?.readyState === EventSource.CLOSED) {\n          this.scheduleReconnect();\n        }\n      };\n\n      // Listen for all event types\n      const eventTypes = [\n        'WORLD_TICK',\n        'GAME_START',\n        'GAME_UPDATE',\n        'GAME_FINAL',\n        'STANDINGS_DELTA',\n        'LINEUP_POSTED',\n        'ODDS_SHIFT',\n        'HIGHLIGHT_CLIP',\n        'INJURY_ALERT',\n        'MOMENTUM_SWING',\n      ];\n\n      for (const type of eventTypes) {\n        this.eventSource.addEventListener(type, (e) => {\n          this.handleEvent(e);\n        });\n      }\n\n      // Also listen for generic message events\n      this.eventSource.onmessage = (e) => {\n        this.handleEvent(e);\n      };\n    } catch (err) {\n      this.onError(err instanceof Error ? err : new Error(String(err)));\n      this.scheduleReconnect();\n    }\n  }\n\n  /**\n   * Handle incoming SSE event.\n   * @param {MessageEvent} e\n   */\n  handleEvent(e) {\n    try {\n      /** @type {BlazeCraftEvent} */\n      const event = JSON.parse(e.data);\n\n      // Add to history\n      this.eventHistory.unshift(event);\n      if (this.eventHistory.length > this.maxHistorySize) {\n        this.eventHistory.length = this.maxHistorySize;\n      }\n\n      // Update stats\n      this.updateStats(event);\n\n      // Notify listeners\n      this.onEvent(event);\n      this.onStats({ ...this.stats });\n    } catch (err) {\n      this.onError(err instanceof Error ? err : new Error('Failed to parse event'));\n    }\n  }\n\n  /**\n   * Update stats based on event type.\n   * @param {BlazeCraftEvent} event\n   */\n  updateStats(event) {\n    const category = EVENT_STAT_MAP[event.type];\n    if (category && category in this.stats) {\n      this.stats[category]++;\n    }\n  }\n\n  /**\n   * Schedule reconnection with exponential backoff.\n   */\n  scheduleReconnect() {\n    if (this.reconnectAttempts >= MAX_RECONNECT_ATTEMPTS) {\n      this.onError(new Error('Max reconnection attempts reached'));\n      return;\n    }\n\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n    }\n\n    const delay = Math.min(\n      RECONNECT_BASE_DELAY * Math.pow(2, this.reconnectAttempts),\n      MAX_RECONNECT_DELAY\n    );\n\n    this.reconnectAttempts++;\n\n    this.reconnectTimeout = setTimeout(() => {\n      this.connect();\n    }, delay);\n  }\n\n  /**\n   * Disconnect from the SSE endpoint.\n   */\n  disconnect() {\n    if (this.reconnectTimeout) {\n      clearTimeout(this.reconnectTimeout);\n      this.reconnectTimeout = null;\n    }\n\n    if (this.eventSource) {\n      this.eventSource.close();\n      this.eventSource = null;\n    }\n\n    this.connected = false;\n    this.onConnection(false);\n  }\n\n  /**\n   * Change client mode and reconnect.\n   * @param {ClientMode} mode\n   */\n  setMode(mode) {\n    if (mode === this.mode) return;\n    this.mode = mode;\n    if (this.connected || this.eventSource) {\n      this.connect();\n    }\n  }\n\n  /**\n   * Update league filter and reconnect.\n   * @param {League[]} leagues\n   */\n  setLeagues(leagues) {\n    this.leagues = leagues;\n    if (this.connected || this.eventSource) {\n      this.connect();\n    }\n  }\n\n  /**\n   * Toggle demo mode and reconnect.\n   * @param {boolean} demo\n   */\n  setDemoMode(demo) {\n    this.demoMode = demo;\n    if (this.connected || this.eventSource) {\n      this.connect();\n    }\n  }\n\n  /**\n   * Inject a custom event (for testing).\n   * @param {Partial<BlazeCraftEvent>} event\n   */\n  injectEvent(event) {\n    /** @type {BlazeCraftEvent} */\n    const fullEvent = {\n      id: crypto.randomUUID(),\n      type: event.type || 'WORLD_TICK',\n      timestamp: new Date().toISOString(),\n      source: 'sim',\n      priority: event.priority || 3,\n      payload: event.payload || { type: 'WORLD_TICK', liveGames: 0, serverTime: new Date().toISOString() },\n      gameContext: event.gameContext,\n    };\n\n    this.eventHistory.unshift(fullEvent);\n    if (this.eventHistory.length > this.maxHistorySize) {\n      this.eventHistory.length = this.maxHistorySize;\n    }\n\n    this.updateStats(fullEvent);\n    this.onEvent(fullEvent);\n    this.onStats({ ...this.stats });\n  }\n\n  /**\n   * Check if connected.\n   * @returns {boolean}\n   */\n  isConnected() {\n    return this.connected;\n  }\n\n  /**\n   * Get current stats.\n   * @returns {EventStats}\n   */\n  getStats() {\n    return { ...this.stats };\n  }\n\n  /**\n   * Get event history.\n   * @returns {BlazeCraftEvent[]}\n   */\n  getHistory() {\n    return [...this.eventHistory];\n  }\n\n  /**\n   * Reset stats to zero.\n   */\n  resetStats() {\n    this.stats = {\n      spawns: 0,\n      commands: 0,\n      production: 0,\n      research: 0,\n      repairs: 0,\n      storage: 0,\n      defense: 0,\n    };\n    this.eventHistory = [];\n    this.onStats({ ...this.stats });\n  }\n}\n\n/**\n * Transform BlazeCraft event to game state event format.\n * @param {BlazeCraftEvent} event\n * @returns {{type: string, workerId: string, details: string, category: string, timestamp: number}}\n */\nexport function transformToGameEvent(event) {\n  const category = EVENT_STAT_MAP[event.type] || 'production';\n\n  // Map event types to game event types\n  let type = 'status';\n  let details = '';\n\n  switch (event.type) {\n    case 'GAME_START':\n      type = 'spawn';\n      details = event.gameContext\n        ? `Game started: ${event.gameContext.awayTeam?.name} @ ${event.gameContext.homeTeam?.name}`\n        : 'New game started';\n      break;\n\n    case 'GAME_UPDATE':\n      type = 'task_start';\n      details = event.payload?.scoringPlay || 'Score update';\n      break;\n\n    case 'GAME_FINAL':\n      type = 'task_complete';\n      details = event.gameContext\n        ? `Final: ${event.gameContext.awayTeam?.name} ${event.payload?.awayScore} - ${event.gameContext.homeTeam?.name} ${event.payload?.homeScore}`\n        : 'Game concluded';\n      break;\n\n    case 'STANDINGS_DELTA':\n      type = 'status';\n      details = `Standings shift: ${event.payload?.delta > 0 ? '+' : ''}${event.payload?.delta} positions`;\n      break;\n\n    case 'INJURY_ALERT':\n      type = 'error';\n      details = `Injury: ${event.payload?.playerName} (${event.payload?.severity})`;\n      break;\n\n    case 'HIGHLIGHT_CLIP':\n      type = 'task_complete';\n      details = `Highlight: ${event.payload?.description}`;\n      break;\n\n    case 'MOMENTUM_SWING':\n      type = 'status';\n      details = `Momentum ${event.payload?.newWinProb > event.payload?.previousWinProb ? 'surge' : 'shift'}: ${event.payload?.favoredTeam} now at ${event.payload?.newWinProb}%`;\n      break;\n\n    case 'LINEUP_POSTED':\n      type = 'status';\n      details = `Lineup posted: ${event.payload?.team}`;\n      break;\n\n    case 'ODDS_SHIFT':\n      type = 'status';\n      details = `Odds ${event.payload?.movement}: ${event.payload?.direction} moving`;\n      break;\n\n    case 'WORLD_TICK':\n    default:\n      type = 'status';\n      details = `${event.payload?.liveGames || 0} live games`;\n      break;\n  }\n\n  return {\n    type,\n    workerId: `bsi-${event.id.slice(0, 8)}`,\n    details,\n    category,\n    timestamp: Date.now(),\n  };\n}\n\n/**\n * Get resource effect from event (for building progression).\n * Applies faction modifiers when a faction is selected.\n * @param {BlazeCraftEvent} event\n * @returns {{gold?: number, intel?: number, influence?: number, morale?: number, workerSlots?: number}}\n */\nexport function getResourceEffect(event) {\n  const baseEffect = calculateBaseEffect(event);\n  return factionSystem.applyModifiers(baseEffect);\n}\n\n/**\n * Calculate base resource effect before faction modifiers.\n * @param {BlazeCraftEvent} event\n * @returns {{gold?: number, intel?: number, influence?: number, morale?: number, workerSlots?: number}}\n */\nfunction calculateBaseEffect(event) {\n  const effect = {};\n\n  switch (event.type) {\n    case 'GAME_START':\n      effect.workerSlots = 1;\n      effect.gold = 10;\n      break;\n\n    case 'GAME_UPDATE': {\n      const margin = Math.abs((event.payload?.homeScore || 0) - (event.payload?.awayScore || 0));\n      effect.gold = 5 + margin * 2;\n      break;\n    }\n\n    case 'GAME_FINAL': {\n      effect.intel = 15;\n      effect.gold = 25;\n      const margin = Math.abs((event.payload?.homeScore || 0) - (event.payload?.awayScore || 0));\n      if (margin <= 3) {\n        effect.morale = 10;\n      }\n      break;\n    }\n\n    case 'STANDINGS_DELTA':\n      effect.influence = (event.payload?.delta || 0) * 5;\n      break;\n\n    case 'LINEUP_POSTED':\n      effect.intel = 20;\n      break;\n\n    case 'ODDS_SHIFT': {\n      const movement = Math.abs((event.payload?.newLine || 0) - (event.payload?.previousLine || 0));\n      effect.gold = event.payload?.movement === 'sharp' ? movement : Math.floor(movement / 2);\n      break;\n    }\n\n    case 'HIGHLIGHT_CLIP':\n      effect.morale = 10;\n      break;\n\n    case 'INJURY_ALERT': {\n      const severityPenalty = { minor: -5, moderate: -10, severe: -20, unknown: -8 };\n      effect.morale = severityPenalty[event.payload?.severity] || -5;\n      break;\n    }\n\n    case 'MOMENTUM_SWING':\n      effect.morale = (event.payload?.newWinProb || 50) > (event.payload?.previousWinProb || 50) ? 5 : -5;\n      break;\n  }\n\n  return effect;\n}\n\n// Singleton instance for easy import\nexport const gameBridge = new GameBridge();\n","/**\n * FactionSelector - Team selection UI overlay\n *\n * Full-screen overlay at game start for selecting a team faction.\n * Shows league tabs, team grids, and preview panel with calculated modifiers.\n *\n * @typedef {'mlb'|'nfl'|'ncaaf'|'nba'|'nhl'} League\n */\n\nimport { factionSystem } from './faction-system.js';\n\n/** Team data organized by league */\nconst TEAMS = {\n  mlb: [\n    { id: 'mlb-TEX', name: 'Rangers', abbr: 'TEX', city: 'Texas' },\n    { id: 'mlb-HOU', name: 'Astros', abbr: 'HOU', city: 'Houston' },\n    { id: 'mlb-NYY', name: 'Yankees', abbr: 'NYY', city: 'New York' },\n    { id: 'mlb-LAD', name: 'Dodgers', abbr: 'LAD', city: 'Los Angeles' },\n    { id: 'mlb-ATL', name: 'Braves', abbr: 'ATL', city: 'Atlanta' },\n    { id: 'mlb-CHC', name: 'Cubs', abbr: 'CHC', city: 'Chicago' },\n    { id: 'mlb-BOS', name: 'Red Sox', abbr: 'BOS', city: 'Boston' },\n    { id: 'mlb-SF', name: 'Giants', abbr: 'SF', city: 'San Francisco' },\n    { id: 'mlb-STL', name: 'Cardinals', abbr: 'STL', city: 'St. Louis' },\n    { id: 'mlb-PHI', name: 'Phillies', abbr: 'PHI', city: 'Philadelphia' },\n  ],\n  nfl: [\n    { id: 'nfl-DAL', name: 'Cowboys', abbr: 'DAL', city: 'Dallas' },\n    { id: 'nfl-PHI', name: 'Eagles', abbr: 'PHI', city: 'Philadelphia' },\n    { id: 'nfl-KC', name: 'Chiefs', abbr: 'KC', city: 'Kansas City' },\n    { id: 'nfl-SF', name: '49ers', abbr: 'SF', city: 'San Francisco' },\n    { id: 'nfl-BUF', name: 'Bills', abbr: 'BUF', city: 'Buffalo' },\n    { id: 'nfl-BAL', name: 'Ravens', abbr: 'BAL', city: 'Baltimore' },\n    { id: 'nfl-DET', name: 'Lions', abbr: 'DET', city: 'Detroit' },\n    { id: 'nfl-MIA', name: 'Dolphins', abbr: 'MIA', city: 'Miami' },\n    { id: 'nfl-CIN', name: 'Bengals', abbr: 'CIN', city: 'Cincinnati' },\n    { id: 'nfl-GB', name: 'Packers', abbr: 'GB', city: 'Green Bay' },\n  ],\n  ncaaf: [\n    { id: 'ncaaf-TEX', name: 'Longhorns', abbr: 'TEX', city: 'Texas' },\n    { id: 'ncaaf-OSU', name: 'Buckeyes', abbr: 'OSU', city: 'Ohio State' },\n    { id: 'ncaaf-BAMA', name: 'Crimson Tide', abbr: 'BAMA', city: 'Alabama' },\n    { id: 'ncaaf-UGA', name: 'Bulldogs', abbr: 'UGA', city: 'Georgia' },\n    { id: 'ncaaf-LSU', name: 'Tigers', abbr: 'LSU', city: 'LSU' },\n    { id: 'ncaaf-MICH', name: 'Wolverines', abbr: 'MICH', city: 'Michigan' },\n    { id: 'ncaaf-ND', name: 'Fighting Irish', abbr: 'ND', city: 'Notre Dame' },\n    { id: 'ncaaf-TENN', name: 'Volunteers', abbr: 'TENN', city: 'Tennessee' },\n    { id: 'ncaaf-PSU', name: 'Nittany Lions', abbr: 'PSU', city: 'Penn State' },\n    { id: 'ncaaf-OU', name: 'Sooners', abbr: 'OU', city: 'Oklahoma' },\n  ],\n  nba: [\n    { id: 'nba-DAL', name: 'Mavericks', abbr: 'DAL', city: 'Dallas' },\n    { id: 'nba-BOS', name: 'Celtics', abbr: 'BOS', city: 'Boston' },\n    { id: 'nba-LAL', name: 'Lakers', abbr: 'LAL', city: 'Los Angeles' },\n    { id: 'nba-GSW', name: 'Warriors', abbr: 'GSW', city: 'Golden State' },\n    { id: 'nba-DEN', name: 'Nuggets', abbr: 'DEN', city: 'Denver' },\n    { id: 'nba-MIL', name: 'Bucks', abbr: 'MIL', city: 'Milwaukee' },\n    { id: 'nba-PHX', name: 'Suns', abbr: 'PHX', city: 'Phoenix' },\n    { id: 'nba-MIA', name: 'Heat', abbr: 'MIA', city: 'Miami' },\n  ],\n  nhl: [\n    { id: 'nhl-DAL', name: 'Stars', abbr: 'DAL', city: 'Dallas' },\n    { id: 'nhl-BOS', name: 'Bruins', abbr: 'BOS', city: 'Boston' },\n    { id: 'nhl-EDM', name: 'Oilers', abbr: 'EDM', city: 'Edmonton' },\n    { id: 'nhl-FLA', name: 'Panthers', abbr: 'FLA', city: 'Florida' },\n    { id: 'nhl-COL', name: 'Avalanche', abbr: 'COL', city: 'Colorado' },\n    { id: 'nhl-VGK', name: 'Golden Knights', abbr: 'VGK', city: 'Vegas' },\n    { id: 'nhl-TOR', name: 'Maple Leafs', abbr: 'TOR', city: 'Toronto' },\n    { id: 'nhl-CAR', name: 'Hurricanes', abbr: 'CAR', city: 'Carolina' },\n  ],\n};\n\n/** League display names */\nconst LEAGUE_NAMES = {\n  mlb: 'MLB',\n  nfl: 'NFL',\n  ncaaf: 'NCAAF',\n  nba: 'NBA',\n  nhl: 'NHL',\n};\n\n/**\n * FactionSelector manages the team selection UI.\n */\nexport class FactionSelector {\n  /**\n   * @param {HTMLElement} container - Container to render selector into\n   * @param {(teamId: string, league: League) => void} onSelect - Selection callback\n   * @param {() => void} onSkip - Skip callback\n   */\n  constructor(container, onSelect, onSkip) {\n    this.container = container;\n    this.onSelect = onSelect;\n    this.onSkip = onSkip;\n\n    /** @type {League} */\n    this.activeLeague = 'mlb';\n    /** @type {string|null} */\n    this.hoveredTeam = null;\n    /** @type {string|null} */\n    this.selectedTeam = null;\n\n    this.overlay = null;\n    this.render();\n  }\n\n  render() {\n    this.overlay = document.createElement('div');\n    this.overlay.className = 'faction-overlay';\n    this.overlay.innerHTML = `\n      <div class=\"faction-modal\">\n        <div class=\"faction-header\">\n          <h2 class=\"faction-title\">Choose Your Faction</h2>\n          <p class=\"faction-subtitle\">Your team's stats determine gameplay modifiers</p>\n        </div>\n\n        <div class=\"faction-tabs\" role=\"tablist\">\n          ${Object.entries(LEAGUE_NAMES).map(([league, name]) => `\n            <button\n              class=\"faction-tab ${league === this.activeLeague ? 'active' : ''}\"\n              data-league=\"${league}\"\n              role=\"tab\"\n              aria-selected=\"${league === this.activeLeague}\"\n            >${name}</button>\n          `).join('')}\n        </div>\n\n        <div class=\"faction-content\">\n          <div class=\"faction-grid\" role=\"listbox\" aria-label=\"Teams\">\n            ${this.renderTeamGrid()}\n          </div>\n\n          <div class=\"faction-preview\">\n            <div class=\"preview-header\">\n              <span class=\"preview-title\">Preview</span>\n            </div>\n            <div class=\"preview-content\">\n              <div class=\"preview-team\">\n                <span class=\"preview-team-abbr\">?</span>\n                <span class=\"preview-team-name\">Select a team</span>\n              </div>\n              <div class=\"preview-modifiers\">\n                <div class=\"preview-modifier-hint\">\n                  Hover over a team to preview modifiers\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class=\"faction-actions\">\n          <button class=\"faction-btn faction-btn-secondary\" type=\"button\" data-action=\"skip\">\n            Play Without Faction\n          </button>\n          <button class=\"faction-btn faction-btn-primary\" type=\"button\" data-action=\"confirm\" disabled>\n            Confirm Selection\n          </button>\n        </div>\n      </div>\n    `;\n\n    this.attachEventListeners();\n    this.container.appendChild(this.overlay);\n  }\n\n  renderTeamGrid() {\n    const teams = TEAMS[this.activeLeague];\n    return teams.map((team) => `\n      <button\n        class=\"faction-team ${this.selectedTeam === team.id ? 'selected' : ''}\"\n        data-team-id=\"${team.id}\"\n        data-league=\"${this.activeLeague}\"\n        role=\"option\"\n        aria-selected=\"${this.selectedTeam === team.id}\"\n      >\n        <span class=\"team-abbr\">${team.abbr}</span>\n        <span class=\"team-name\">${team.name}</span>\n        <span class=\"team-city\">${team.city}</span>\n      </button>\n    `).join('');\n  }\n\n  attachEventListeners() {\n    // Tab switching\n    this.overlay.addEventListener('click', (e) => {\n      const tab = e.target.closest('.faction-tab');\n      if (tab) {\n        const league = tab.dataset.league;\n        this.setActiveLeague(league);\n        return;\n      }\n\n      const teamBtn = e.target.closest('.faction-team');\n      if (teamBtn) {\n        this.selectTeam(teamBtn.dataset.teamId, teamBtn.dataset.league);\n        return;\n      }\n\n      const actionBtn = e.target.closest('.faction-btn');\n      if (actionBtn) {\n        const action = actionBtn.dataset.action;\n        if (action === 'skip') {\n          this.skip();\n        } else if (action === 'confirm' && this.selectedTeam) {\n          this.confirm();\n        }\n      }\n    });\n\n    // Hover preview\n    this.overlay.addEventListener('mouseover', (e) => {\n      const teamBtn = e.target.closest('.faction-team');\n      if (teamBtn) {\n        this.previewTeam(teamBtn.dataset.teamId, teamBtn.dataset.league);\n      }\n    });\n\n    this.overlay.addEventListener('mouseout', (e) => {\n      const teamBtn = e.target.closest('.faction-team');\n      if (teamBtn && !this.selectedTeam) {\n        this.clearPreview();\n      }\n    });\n\n    // Keyboard navigation\n    this.overlay.addEventListener('keydown', (e) => {\n      if (e.key === 'Escape') {\n        this.skip();\n      }\n    });\n  }\n\n  /**\n   * @param {League} league\n   */\n  setActiveLeague(league) {\n    this.activeLeague = league;\n    this.selectedTeam = null;\n\n    // Update tabs\n    const tabs = this.overlay.querySelectorAll('.faction-tab');\n    tabs.forEach((tab) => {\n      const isActive = tab.dataset.league === league;\n      tab.classList.toggle('active', isActive);\n      tab.setAttribute('aria-selected', String(isActive));\n    });\n\n    // Update grid\n    const grid = this.overlay.querySelector('.faction-grid');\n    if (grid) {\n      grid.innerHTML = this.renderTeamGrid();\n    }\n\n    // Update confirm button\n    const confirmBtn = this.overlay.querySelector('[data-action=\"confirm\"]');\n    if (confirmBtn) {\n      confirmBtn.disabled = true;\n    }\n\n    this.clearPreview();\n  }\n\n  /**\n   * @param {string} teamId\n   * @param {League} league\n   */\n  selectTeam(teamId, league) {\n    this.selectedTeam = teamId;\n\n    // Update selection visuals\n    const teams = this.overlay.querySelectorAll('.faction-team');\n    teams.forEach((team) => {\n      const isSelected = team.dataset.teamId === teamId;\n      team.classList.toggle('selected', isSelected);\n      team.setAttribute('aria-selected', String(isSelected));\n    });\n\n    // Enable confirm button\n    const confirmBtn = this.overlay.querySelector('[data-action=\"confirm\"]');\n    if (confirmBtn) {\n      confirmBtn.disabled = false;\n    }\n\n    this.previewTeam(teamId, league);\n  }\n\n  /**\n   * @param {string} teamId\n   * @param {League} league\n   */\n  previewTeam(teamId, league) {\n    this.hoveredTeam = teamId;\n\n    const team = TEAMS[league]?.find((t) => t.id === teamId);\n    if (!team) return;\n\n    // Mock stats for preview (real stats come from API)\n    const mockStats = this.getMockStats(league);\n    const modifiers = factionSystem.calculateModifiers(mockStats);\n    const traits = Object.entries(modifiers)\n      .filter(([key, value]) => {\n        if (key === 'productionSpeed' || key === 'crisisDuration') {\n          return value !== 1.0;\n        }\n        return value !== 0;\n      })\n      .map(([key, value]) => this.formatModifier(key, value));\n\n    const preview = this.overlay.querySelector('.preview-content');\n    if (preview) {\n      preview.innerHTML = `\n        <div class=\"preview-team\">\n          <span class=\"preview-team-abbr\">${team.abbr}</span>\n          <span class=\"preview-team-name\">${team.city} ${team.name}</span>\n        </div>\n        <div class=\"preview-modifiers\">\n          ${traits.length > 0 ? traits.map((trait) => `\n            <div class=\"preview-modifier\">\n              <span class=\"modifier-icon\">${trait.icon}</span>\n              <span class=\"modifier-text\">${trait.text}</span>\n            </div>\n          `).join('') : `\n            <div class=\"preview-modifier preview-modifier-neutral\">\n              <span class=\"modifier-text\">No modifiers (stats pending)</span>\n            </div>\n          `}\n        </div>\n        <div class=\"preview-note\">\n          Modifiers update when live team stats are available\n        </div>\n      `;\n    }\n  }\n\n  clearPreview() {\n    this.hoveredTeam = null;\n\n    const preview = this.overlay.querySelector('.preview-content');\n    if (preview) {\n      preview.innerHTML = `\n        <div class=\"preview-team\">\n          <span class=\"preview-team-abbr\">?</span>\n          <span class=\"preview-team-name\">Select a team</span>\n        </div>\n        <div class=\"preview-modifiers\">\n          <div class=\"preview-modifier-hint\">\n            Hover over a team to preview modifiers\n          </div>\n        </div>\n      `;\n    }\n  }\n\n  /**\n   * @param {string} key\n   * @param {number} value\n   */\n  formatModifier(key, value) {\n    const formatters = {\n      productionSpeed: (v) => ({\n        icon: '+',\n        text: `${Math.round((v - 1) * 100)}% production speed`,\n      }),\n      goldBonus: (v) => ({\n        icon: '+',\n        text: `${v}% gold gain`,\n      }),\n      moraleBonus: (v) => ({\n        icon: '+',\n        text: `${v}% morale`,\n      }),\n      crisisDuration: (v) => ({\n        icon: '-',\n        text: `${Math.round((1 - v) * 100)}% crisis duration`,\n      }),\n      influenceBonus: (v) => ({\n        icon: '+',\n        text: `${v}% influence`,\n      }),\n      intelBonus: (v) => ({\n        icon: '+',\n        text: `${v}% intel`,\n      }),\n    };\n\n    return formatters[key]?.(value) || { icon: '?', text: `${key}: ${value}` };\n  }\n\n  /**\n   * Generate mock stats for preview.\n   * @param {League} league\n   */\n  getMockStats(league) {\n    // Return moderate stats that may trigger some traits\n    const baseStats = {\n      wins: 50,\n      losses: 40,\n      winStreak: Math.floor(Math.random() * 8),\n    };\n\n    if (league === 'mlb') {\n      return {\n        ...baseStats,\n        runsPerGame: 4 + Math.random() * 2,\n        era: 3 + Math.random() * 1.5,\n        errors: 40 + Math.floor(Math.random() * 30),\n      };\n    }\n\n    return {\n      ...baseStats,\n      pointsPerGame: 22 + Math.random() * 8,\n      pointsAllowed: 18 + Math.random() * 8,\n    };\n  }\n\n  confirm() {\n    if (!this.selectedTeam) return;\n\n    const team = TEAMS[this.activeLeague]?.find((t) => t.id === this.selectedTeam);\n    if (!team) return;\n\n    this.onSelect(this.selectedTeam, this.activeLeague);\n    this.close();\n  }\n\n  skip() {\n    this.onSkip();\n    this.close();\n  }\n\n  close() {\n    if (this.overlay) {\n      this.overlay.classList.add('faction-overlay-closing');\n      setTimeout(() => {\n        this.overlay.remove();\n        this.overlay = null;\n      }, 200);\n    }\n  }\n\n  /**\n   * Show the selector.\n   */\n  show() {\n    if (!this.overlay) {\n      this.render();\n    }\n  }\n\n  /**\n   * Check if selector is visible.\n   * @returns {boolean}\n   */\n  isVisible() {\n    return this.overlay !== null && this.container.contains(this.overlay);\n  }\n}\n\n/**\n * Create and show faction selector.\n * @param {HTMLElement} container\n * @returns {Promise<{teamId: string|null, league: League|null}>}\n */\nexport function showFactionSelector(container) {\n  return new Promise((resolve) => {\n    new FactionSelector(\n      container,\n      (teamId, league) => resolve({ teamId, league }),\n      () => resolve({ teamId: null, league: null })\n    );\n  });\n}\n","/**\n * Prediction System Types\n *\n * Type definitions for the BlazeCraft prediction mini-games.\n *\n * @typedef {'next_score'|'game_outcome'|'over_under'|'first_to_score'} PredictionType\n * @typedef {'pending'|'won'|'lost'|'refunded'} PredictionStatus\n *\n * @typedef {{\n *   gold: number,\n *   intel: number,\n *   influence: number,\n *   morale: number,\n *   lifetimeEarnings: number,\n *   lifetimeLosses: number\n * }} PlayerWallet\n *\n * @typedef {{\n *   id: string,\n *   gameId: string,\n *   type: PredictionType,\n *   choice: string,\n *   stake: number,\n *   odds: number,\n *   potentialPayout: number,\n *   status: PredictionStatus,\n *   placedAt: number,\n *   resolvedAt?: number,\n *   gameContext: {\n *     homeTeam: string,\n *     awayTeam: string,\n *     homeScore: number,\n *     awayScore: number,\n *     league: string\n *   }\n * }} Prediction\n *\n * @typedef {{\n *   gameId: string,\n *   type: PredictionType,\n *   options: PredictionOption[],\n *   closesAt?: number\n * }} PredictionMarket\n *\n * @typedef {{\n *   choice: string,\n *   label: string,\n *   odds: number,\n *   probability: number\n * }} PredictionOption\n */\n\n/** Prediction types with display info */\nexport const PREDICTION_TYPES = {\n  next_score: {\n    name: 'Next Score',\n    description: 'Which team scores next?',\n    icon: '+',\n  },\n  game_outcome: {\n    name: 'Game Winner',\n    description: 'Which team wins the game?',\n    icon: 'W',\n  },\n  over_under: {\n    name: 'Over/Under',\n    description: 'Total score above or below target?',\n    icon: 'O/U',\n  },\n  first_to_score: {\n    name: 'First to Score',\n    description: 'Which team scores first?',\n    icon: '1st',\n  },\n};\n\n/** Stake configuration */\nexport const STAKE_CONFIG = {\n  MIN_STAKE: 10,\n  MAX_STAKE: 500,\n  MAX_CONCURRENT: 5,\n  STARTING_GOLD: 200,\n  PASSIVE_REGEN_RATE: 5, // gold per minute\n  PASSIVE_REGEN_CAP: 100,\n};\n\n/** Storage keys */\nexport const STORAGE_KEYS = {\n  WALLET: 'blazecraft_wallet',\n  PREDICTIONS: 'blazecraft_predictions',\n  STATS: 'blazecraft_prediction_stats',\n};\n\n/** Grace period for disconnection (5 minutes) */\nexport const DISCONNECT_GRACE_MS = 5 * 60 * 1000;\n\n/**\n * Create a new player wallet with starting resources.\n * @returns {PlayerWallet}\n */\nexport function createWallet() {\n  return {\n    gold: STAKE_CONFIG.STARTING_GOLD,\n    intel: 0,\n    influence: 0,\n    morale: 100,\n    lifetimeEarnings: 0,\n    lifetimeLosses: 0,\n  };\n}\n\n/**\n * Generate a unique prediction ID.\n * @returns {string}\n */\nexport function generatePredictionId() {\n  return `pred-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`;\n}\n","/**\n * Odds Engine - Probability and odds calculations\n *\n * Calculates fair odds with house edge for prediction mini-games.\n */\n\n/** House edge percentage (5%) */\nconst HOUSE_EDGE = 0.05;\n\n/**\n * Convert probability to decimal odds with house edge.\n * @param {number} probability - Win probability (0-1)\n * @returns {number} Decimal odds (e.g., 2.0 = even money)\n */\nexport function calculateOdds(probability) {\n  if (probability <= 0) return 100; // Very unlikely\n  if (probability >= 1) return 1.01; // Certain\n\n  // Fair odds = 1 / probability\n  // With house edge, reduce payout\n  const fairOdds = 1 / probability;\n  return Math.max(1.01, fairOdds * (1 - HOUSE_EDGE));\n}\n\n/**\n * Get odds for \"next score\" prediction.\n * @param {number} homeWinProb - Current home team win probability (0-100)\n * @param {number} momentum - Momentum value (-100 to 100, positive = home favored)\n * @returns {{home: number, away: number, neither: number}}\n */\nexport function getNextScoreOdds(homeWinProb = 50, momentum = 0) {\n  // Base probability from win probability\n  let homePct = homeWinProb / 100;\n\n  // Adjust for momentum\n  const momentumFactor = momentum / 400; // Small effect\n  homePct = Math.max(0.1, Math.min(0.9, homePct + momentumFactor));\n\n  // Small chance of no score (timeout, end of period)\n  const neitherPct = 0.05;\n  const awayPct = (1 - neitherPct) * (1 - homePct);\n  const adjustedHomePct = (1 - neitherPct) * homePct;\n\n  return {\n    home: calculateOdds(adjustedHomePct),\n    away: calculateOdds(awayPct),\n    neither: calculateOdds(neitherPct),\n  };\n}\n\n/**\n * Get odds for \"game outcome\" prediction.\n * @param {number} homeWinProb - Current home team win probability (0-100)\n * @returns {{home: number, away: number}}\n */\nexport function getGameOutcomeOdds(homeWinProb = 50) {\n  const homePct = Math.max(0.05, Math.min(0.95, homeWinProb / 100));\n  const awayPct = 1 - homePct;\n\n  return {\n    home: calculateOdds(homePct),\n    away: calculateOdds(awayPct),\n  };\n}\n\n/**\n * Get odds for \"over/under\" prediction.\n * @param {number} currentTotal - Current combined score\n * @param {number} period - Current period/inning/quarter\n * @param {string} league - League identifier\n * @returns {{over: number, under: number, target: number}}\n */\nexport function getOverUnderOdds(currentTotal, period, league) {\n  // Estimate remaining scoring based on league and period\n  const avgScoring = getLeagueAverageScoring(league);\n  const periodsRemaining = getPeriodsRemaining(period, league);\n  const expectedRemaining = avgScoring * (periodsRemaining / getTotalPeriods(league));\n\n  // Target is current + expected remaining, rounded to .5\n  const target = Math.round((currentTotal + expectedRemaining) * 2) / 2;\n\n  // Slight favorite for the over in most cases (games tend to score more late)\n  const overPct = 0.52;\n  const underPct = 0.48;\n\n  return {\n    over: calculateOdds(overPct),\n    under: calculateOdds(underPct),\n    target,\n  };\n}\n\n/**\n * Get odds for \"first to score\" prediction.\n * @param {number} homeWinProb - Home team win probability\n * @returns {{home: number, away: number}}\n */\nexport function getFirstToScoreOdds(homeWinProb = 50) {\n  // First score is relatively even with slight home advantage\n  const homePct = 0.48 + (homeWinProb - 50) / 500;\n  const awayPct = 1 - homePct;\n\n  return {\n    home: calculateOdds(Math.max(0.3, Math.min(0.7, homePct))),\n    away: calculateOdds(Math.max(0.3, Math.min(0.7, awayPct))),\n  };\n}\n\n/**\n * Calculate potential payout from stake and odds.\n * @param {number} stake - Amount wagered\n * @param {number} odds - Decimal odds\n * @returns {number} Total payout including stake\n */\nexport function calculatePayout(stake, odds) {\n  return Math.round(stake * odds);\n}\n\n/**\n * Calculate profit from a winning bet.\n * @param {number} stake - Amount wagered\n * @param {number} odds - Decimal odds\n * @returns {number} Profit (payout - stake)\n */\nexport function calculateProfit(stake, odds) {\n  return calculatePayout(stake, odds) - stake;\n}\n\n/**\n * Format odds for display.\n * @param {number} odds - Decimal odds\n * @returns {string} Formatted odds string\n */\nexport function formatOdds(odds) {\n  if (odds >= 10) return `+${Math.round((odds - 1) * 100)}`;\n  if (odds >= 2) return `+${Math.round((odds - 1) * 100)}`;\n  return `-${Math.round(100 / (odds - 1))}`;\n}\n\n/**\n * Format odds as multiplier.\n * @param {number} odds - Decimal odds\n * @returns {string} Multiplier string (e.g., \"2.5x\")\n */\nexport function formatMultiplier(odds) {\n  return `${odds.toFixed(2)}x`;\n}\n\n// League-specific helpers\n\nfunction getLeagueAverageScoring(league) {\n  const averages = {\n    mlb: 9, // ~4.5 runs per team\n    nfl: 46, // ~23 points per team\n    ncaaf: 54, // ~27 points per team\n    nba: 220, // ~110 points per team\n    nhl: 6, // ~3 goals per team\n  };\n  return averages[league] || 10;\n}\n\nfunction getTotalPeriods(league) {\n  const periods = {\n    mlb: 9,\n    nfl: 4,\n    ncaaf: 4,\n    nba: 4,\n    nhl: 3,\n  };\n  return periods[league] || 4;\n}\n\nfunction getPeriodsRemaining(currentPeriod, league) {\n  return Math.max(0, getTotalPeriods(league) - currentPeriod);\n}\n","/**\n * PredictionManager - Manages prediction lifecycle\n *\n * Handles placing predictions, resolving outcomes, and managing player wallet.\n */\n\nimport {\n  STAKE_CONFIG,\n  STORAGE_KEYS,\n  DISCONNECT_GRACE_MS,\n  createWallet,\n  generatePredictionId,\n} from './types.js';\nimport { calculatePayout } from './odds-engine.js';\n\n/**\n * @typedef {import('./types.js').Prediction} Prediction\n * @typedef {import('./types.js').PlayerWallet} PlayerWallet\n * @typedef {import('./types.js').PredictionStatus} PredictionStatus\n */\n\n/**\n * PredictionManager handles all prediction operations.\n */\nexport class PredictionManager {\n  constructor() {\n    /** @type {PlayerWallet} */\n    this.wallet = this.loadWallet();\n    /** @type {Map<string, Prediction>} */\n    this.predictions = new Map();\n    /** @type {number|null} */\n    this.disconnectedAt = null;\n    /** @type {number|null} */\n    this.regenInterval = null;\n    /** @type {((wallet: PlayerWallet, predictions: Prediction[]) => void)[]} */\n    this.listeners = [];\n\n    this.loadPredictions();\n    this.startPassiveRegen();\n  }\n\n  /**\n   * Place a new prediction.\n   * @param {{\n   *   gameId: string,\n   *   type: string,\n   *   choice: string,\n   *   stake: number,\n   *   odds: number,\n   *   gameContext: {homeTeam: string, awayTeam: string, homeScore: number, awayScore: number, league: string}\n   * }} params\n   * @returns {{success: boolean, error?: string, prediction?: Prediction}}\n   */\n  placePrediction({ gameId, type, choice, stake, odds, gameContext }) {\n    // Validation\n    if (stake < STAKE_CONFIG.MIN_STAKE) {\n      return { success: false, error: `Minimum stake is ${STAKE_CONFIG.MIN_STAKE} gold` };\n    }\n    if (stake > STAKE_CONFIG.MAX_STAKE) {\n      return { success: false, error: `Maximum stake is ${STAKE_CONFIG.MAX_STAKE} gold` };\n    }\n    if (stake > this.wallet.gold) {\n      return { success: false, error: 'Insufficient gold' };\n    }\n\n    const pendingCount = this.getPendingPredictions().length;\n    if (pendingCount >= STAKE_CONFIG.MAX_CONCURRENT) {\n      return { success: false, error: `Maximum ${STAKE_CONFIG.MAX_CONCURRENT} concurrent predictions` };\n    }\n\n    // Check if already have prediction on this game/type\n    const existing = Array.from(this.predictions.values()).find(\n      (p) => p.gameId === gameId && p.type === type && p.status === 'pending'\n    );\n    if (existing) {\n      return { success: false, error: 'Already have a prediction on this market' };\n    }\n\n    // Deduct stake\n    this.wallet.gold -= stake;\n\n    // Create prediction\n    /** @type {Prediction} */\n    const prediction = {\n      id: generatePredictionId(),\n      gameId,\n      type,\n      choice,\n      stake,\n      odds,\n      potentialPayout: calculatePayout(stake, odds),\n      status: 'pending',\n      placedAt: Date.now(),\n      gameContext,\n    };\n\n    this.predictions.set(prediction.id, prediction);\n    this.save();\n    this.notify();\n\n    return { success: true, prediction };\n  }\n\n  /**\n   * Handle incoming game event - resolve applicable predictions.\n   * @param {object} event - BlazeCraft event\n   */\n  handleEvent(event) {\n    if (!event.gameContext) return;\n\n    const gameId = event.gameContext.gameId;\n    const relevantPredictions = Array.from(this.predictions.values()).filter(\n      (p) => p.gameId === gameId && p.status === 'pending'\n    );\n\n    if (relevantPredictions.length === 0) return;\n\n    for (const prediction of relevantPredictions) {\n      const result = this.evaluatePrediction(prediction, event);\n      if (result !== null) {\n        this.resolvePrediction(prediction.id, result);\n      }\n    }\n  }\n\n  /**\n   * Evaluate if a prediction should be resolved based on event.\n   * @param {Prediction} prediction\n   * @param {object} event\n   * @returns {'won'|'lost'|null}\n   */\n  evaluatePrediction(prediction, event) {\n    const { type, choice, gameContext: prevContext } = prediction;\n    const { gameContext: currContext, payload } = event;\n\n    switch (type) {\n      case 'next_score': {\n        if (event.type !== 'GAME_UPDATE') return null;\n\n        const homeScored = currContext.homeTeam.score > prevContext.homeScore;\n        const awayScored = currContext.awayTeam.score > prevContext.awayScore;\n\n        if (!homeScored && !awayScored) return null;\n\n        if (choice === 'home' && homeScored) return 'won';\n        if (choice === 'away' && awayScored) return 'won';\n        if (choice === 'neither' && !homeScored && !awayScored) return 'won';\n        return 'lost';\n      }\n\n      case 'game_outcome': {\n        if (event.type !== 'GAME_FINAL') return null;\n\n        const homeWon = currContext.homeTeam.score > currContext.awayTeam.score;\n        if (choice === 'home' && homeWon) return 'won';\n        if (choice === 'away' && !homeWon) return 'won';\n        return 'lost';\n      }\n\n      case 'over_under': {\n        if (event.type !== 'GAME_FINAL') return null;\n\n        const total = currContext.homeTeam.score + currContext.awayTeam.score;\n        const target = parseFloat(choice.split('_')[1]);\n        const overUnder = choice.split('_')[0];\n\n        if (overUnder === 'over' && total > target) return 'won';\n        if (overUnder === 'under' && total < target) return 'won';\n        if (total === target) {\n          // Push - refund\n          this.wallet.gold += prediction.stake;\n          return null;\n        }\n        return 'lost';\n      }\n\n      case 'first_to_score': {\n        if (event.type !== 'GAME_UPDATE') return null;\n\n        // Only resolve if this is the first scoring event\n        if (prevContext.homeScore > 0 || prevContext.awayScore > 0) return null;\n\n        const homeScored = currContext.homeTeam.score > 0;\n        const awayScored = currContext.awayTeam.score > 0;\n\n        if (choice === 'home' && homeScored) return 'won';\n        if (choice === 'away' && awayScored) return 'won';\n        if (homeScored || awayScored) return 'lost';\n        return null;\n      }\n\n      default:\n        return null;\n    }\n  }\n\n  /**\n   * Resolve a prediction with final status.\n   * @param {string} predictionId\n   * @param {'won'|'lost'|'refunded'} status\n   */\n  resolvePrediction(predictionId, status) {\n    const prediction = this.predictions.get(predictionId);\n    if (!prediction || prediction.status !== 'pending') return;\n\n    prediction.status = status;\n    prediction.resolvedAt = Date.now();\n\n    if (status === 'won') {\n      this.wallet.gold += prediction.potentialPayout;\n      this.wallet.lifetimeEarnings += prediction.potentialPayout - prediction.stake;\n    } else if (status === 'refunded') {\n      this.wallet.gold += prediction.stake;\n    } else {\n      this.wallet.lifetimeLosses += prediction.stake;\n    }\n\n    this.save();\n    this.notify();\n  }\n\n  /**\n   * Handle SSE disconnection.\n   */\n  handleDisconnect() {\n    this.disconnectedAt = Date.now();\n  }\n\n  /**\n   * Handle SSE reconnection - refund predictions that expired during disconnect.\n   */\n  handleReconnect() {\n    if (!this.disconnectedAt) return;\n\n    const disconnectDuration = Date.now() - this.disconnectedAt;\n    this.disconnectedAt = null;\n\n    // If disconnected longer than grace period, refund pending predictions\n    if (disconnectDuration > DISCONNECT_GRACE_MS) {\n      const pendingPredictions = this.getPendingPredictions();\n      for (const prediction of pendingPredictions) {\n        this.resolvePrediction(prediction.id, 'refunded');\n      }\n    }\n  }\n\n  /**\n   * Get all pending predictions.\n   * @returns {Prediction[]}\n   */\n  getPendingPredictions() {\n    return Array.from(this.predictions.values()).filter((p) => p.status === 'pending');\n  }\n\n  /**\n   * Get resolved predictions (most recent first).\n   * @param {number} limit\n   * @returns {Prediction[]}\n   */\n  getResolvedPredictions(limit = 10) {\n    return Array.from(this.predictions.values())\n      .filter((p) => p.status !== 'pending')\n      .sort((a, b) => (b.resolvedAt || 0) - (a.resolvedAt || 0))\n      .slice(0, limit);\n  }\n\n  /**\n   * Get current wallet.\n   * @returns {PlayerWallet}\n   */\n  getWallet() {\n    return { ...this.wallet };\n  }\n\n  /**\n   * Get prediction statistics.\n   * @returns {{totalBets: number, wins: number, losses: number, winRate: number, profit: number}}\n   */\n  getStats() {\n    const resolved = Array.from(this.predictions.values()).filter((p) => p.status !== 'pending');\n    const wins = resolved.filter((p) => p.status === 'won').length;\n    const losses = resolved.filter((p) => p.status === 'lost').length;\n\n    return {\n      totalBets: resolved.length,\n      wins,\n      losses,\n      winRate: resolved.length > 0 ? (wins / resolved.length) * 100 : 0,\n      profit: this.wallet.lifetimeEarnings - this.wallet.lifetimeLosses,\n    };\n  }\n\n  /**\n   * Subscribe to changes.\n   * @param {(wallet: PlayerWallet, predictions: Prediction[]) => void} listener\n   * @returns {() => void} Unsubscribe function\n   */\n  subscribe(listener) {\n    this.listeners.push(listener);\n    return () => {\n      this.listeners = this.listeners.filter((l) => l !== listener);\n    };\n  }\n\n  /**\n   * @private\n   */\n  notify() {\n    const predictions = Array.from(this.predictions.values());\n    for (const listener of this.listeners) {\n      listener(this.getWallet(), predictions);\n    }\n  }\n\n  /**\n   * @private\n   */\n  startPassiveRegen() {\n    if (this.regenInterval) return;\n\n    this.regenInterval = setInterval(() => {\n      if (this.wallet.gold < STAKE_CONFIG.PASSIVE_REGEN_CAP) {\n        this.wallet.gold = Math.min(\n          STAKE_CONFIG.PASSIVE_REGEN_CAP,\n          this.wallet.gold + STAKE_CONFIG.PASSIVE_REGEN_RATE\n        );\n        this.save();\n        this.notify();\n      }\n    }, 60000); // Every minute\n  }\n\n  /**\n   * @private\n   */\n  loadWallet() {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.WALLET);\n      if (stored) {\n        return JSON.parse(stored);\n      }\n    } catch {\n      // Ignore\n    }\n    return createWallet();\n  }\n\n  /**\n   * @private\n   */\n  loadPredictions() {\n    try {\n      const stored = localStorage.getItem(STORAGE_KEYS.PREDICTIONS);\n      if (stored) {\n        const arr = JSON.parse(stored);\n        for (const p of arr) {\n          this.predictions.set(p.id, p);\n        }\n      }\n    } catch {\n      // Ignore\n    }\n  }\n\n  /**\n   * @private\n   */\n  save() {\n    try {\n      localStorage.setItem(STORAGE_KEYS.WALLET, JSON.stringify(this.wallet));\n      localStorage.setItem(\n        STORAGE_KEYS.PREDICTIONS,\n        JSON.stringify(Array.from(this.predictions.values()))\n      );\n    } catch {\n      // Ignore storage errors\n    }\n  }\n\n  /**\n   * Reset wallet and predictions (for testing).\n   */\n  reset() {\n    this.wallet = createWallet();\n    this.predictions.clear();\n    this.save();\n    this.notify();\n  }\n}\n\n/** Singleton instance */\nexport const predictionManager = new PredictionManager();\n","/**\n * PredictionUI - Prediction panel interface\n *\n * Slide-out panel for placing predictions and viewing history.\n */\n\nimport { predictionManager } from './prediction-manager.js';\nimport { PREDICTION_TYPES, STAKE_CONFIG } from './types.js';\nimport {\n  getNextScoreOdds,\n  getGameOutcomeOdds,\n  getOverUnderOdds,\n  formatMultiplier,\n  calculatePayout,\n} from './odds-engine.js';\n\n/**\n * PredictionUI manages the prediction panel.\n */\nexport class PredictionUI {\n  /**\n   * @param {HTMLElement} panel - Panel element\n   * @param {HTMLElement} toggleBtn - Toggle button element\n   */\n  constructor(panel, toggleBtn) {\n    this.panel = panel;\n    this.toggleBtn = toggleBtn;\n    this.visible = false;\n\n    /** @type {Map<string, object>} */\n    this.activeGames = new Map();\n    /** @type {string|null} */\n    this.selectedMarket = null;\n    /** @type {number} */\n    this.stakeAmount = STAKE_CONFIG.MIN_STAKE;\n\n    this.init();\n  }\n\n  init() {\n    // Toggle button\n    this.toggleBtn?.addEventListener('click', () => this.toggle());\n\n    // Subscribe to prediction updates\n    predictionManager.subscribe((wallet, predictions) => {\n      this.updateBalance(wallet.gold);\n      this.updatePendingList(predictions.filter((p) => p.status === 'pending'));\n      this.updateHistoryList(predictions.filter((p) => p.status !== 'pending'));\n    });\n\n    // Initial render\n    this.render();\n    this.updateBalance(predictionManager.getWallet().gold);\n  }\n\n  toggle() {\n    this.visible = !this.visible;\n    this.panel.hidden = !this.visible;\n    this.toggleBtn?.setAttribute('aria-pressed', String(this.visible));\n  }\n\n  show() {\n    this.visible = true;\n    this.panel.hidden = false;\n    this.toggleBtn?.setAttribute('aria-pressed', 'true');\n  }\n\n  hide() {\n    this.visible = false;\n    this.panel.hidden = true;\n    this.toggleBtn?.setAttribute('aria-pressed', 'false');\n  }\n\n  render() {\n    this.panel.innerHTML = `\n      <div class=\"prediction-content\">\n        <div class=\"prediction-markets\" id=\"predictionMarkets\">\n          <div class=\"prediction-empty\">\n            No active games to predict on\n          </div>\n        </div>\n\n        <div class=\"prediction-form\" id=\"predictionForm\" hidden>\n          <div class=\"prediction-form-header\">\n            <span class=\"form-market-type\"></span>\n            <button class=\"form-close\" type=\"button\">&times;</button>\n          </div>\n          <div class=\"prediction-form-body\">\n            <div class=\"prediction-options\" id=\"predictionOptions\"></div>\n            <div class=\"prediction-stake\">\n              <label for=\"stakeInput\">Stake</label>\n              <div class=\"stake-input-wrap\">\n                <input\n                  type=\"number\"\n                  id=\"stakeInput\"\n                  min=\"${STAKE_CONFIG.MIN_STAKE}\"\n                  max=\"${STAKE_CONFIG.MAX_STAKE}\"\n                  value=\"${this.stakeAmount}\"\n                />\n                <span class=\"stake-unit\">gold</span>\n              </div>\n              <div class=\"stake-quick\">\n                <button type=\"button\" data-stake=\"10\">10</button>\n                <button type=\"button\" data-stake=\"25\">25</button>\n                <button type=\"button\" data-stake=\"50\">50</button>\n                <button type=\"button\" data-stake=\"100\">100</button>\n              </div>\n            </div>\n            <div class=\"prediction-payout\">\n              Potential payout: <span id=\"potentialPayout\">0</span> gold\n            </div>\n            <button class=\"prediction-submit\" type=\"button\" disabled>\n              Place Prediction\n            </button>\n          </div>\n        </div>\n\n        <div class=\"prediction-pending\">\n          <div class=\"section-title\">Active Predictions</div>\n          <div id=\"pendingList\" class=\"pending-list\"></div>\n        </div>\n\n        <div class=\"prediction-history\">\n          <div class=\"section-title\">History</div>\n          <div id=\"historyList\" class=\"history-list\"></div>\n        </div>\n\n        <div class=\"prediction-stats\">\n          <div class=\"stat\">\n            <span class=\"stat-label\">Win Rate</span>\n            <span class=\"stat-value\" id=\"statWinRate\">0%</span>\n          </div>\n          <div class=\"stat\">\n            <span class=\"stat-label\">Profit</span>\n            <span class=\"stat-value\" id=\"statProfit\">0</span>\n          </div>\n        </div>\n      </div>\n    `;\n\n    this.attachEventListeners();\n    this.updateStats();\n  }\n\n  attachEventListeners() {\n    // Close form button\n    this.panel.querySelector('.form-close')?.addEventListener('click', () => {\n      this.closeForm();\n    });\n\n    // Stake input\n    const stakeInput = this.panel.querySelector('#stakeInput');\n    stakeInput?.addEventListener('input', (e) => {\n      this.stakeAmount = parseInt(e.target.value, 10) || STAKE_CONFIG.MIN_STAKE;\n      this.updatePayout();\n    });\n\n    // Quick stake buttons\n    this.panel.querySelectorAll('[data-stake]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        this.stakeAmount = parseInt(btn.dataset.stake, 10);\n        const input = this.panel.querySelector('#stakeInput');\n        if (input) input.value = this.stakeAmount;\n        this.updatePayout();\n      });\n    });\n\n    // Submit button\n    this.panel.querySelector('.prediction-submit')?.addEventListener('click', () => {\n      this.submitPrediction();\n    });\n\n    // Market selection\n    this.panel.addEventListener('click', (e) => {\n      const marketBtn = e.target.closest('.market-btn');\n      if (marketBtn) {\n        this.selectMarket(marketBtn.dataset.gameId, marketBtn.dataset.type);\n      }\n\n      const optionBtn = e.target.closest('.prediction-option');\n      if (optionBtn) {\n        this.selectOption(optionBtn.dataset.choice);\n      }\n    });\n  }\n\n  /**\n   * Update with live game data.\n   * @param {object} event - BlazeCraft event with game context\n   */\n  updateFromEvent(event) {\n    if (!event.gameContext) return;\n\n    const { gameId, homeTeam, awayTeam, status, league } = event.gameContext;\n\n    if (status === 'live') {\n      this.activeGames.set(gameId, {\n        gameId,\n        homeTeam,\n        awayTeam,\n        league,\n        homeScore: homeTeam.score,\n        awayScore: awayTeam.score,\n        winProbability: event.payload?.winProbability || 50,\n      });\n    } else if (status === 'final') {\n      this.activeGames.delete(gameId);\n    }\n\n    this.renderMarkets();\n  }\n\n  renderMarkets() {\n    const container = this.panel.querySelector('#predictionMarkets');\n    if (!container) return;\n\n    if (this.activeGames.size === 0) {\n      container.innerHTML = `\n        <div class=\"prediction-empty\">\n          No active games to predict on\n        </div>\n      `;\n      return;\n    }\n\n    container.innerHTML = Array.from(this.activeGames.values())\n      .map((game) => this.renderGameMarkets(game))\n      .join('');\n  }\n\n  renderGameMarkets(game) {\n    const { gameId, homeTeam, awayTeam, homeScore, awayScore, league } = game;\n\n    return `\n      <div class=\"game-markets\">\n        <div class=\"game-header\">\n          <span class=\"game-teams\">${awayTeam.abbreviation} @ ${homeTeam.abbreviation}</span>\n          <span class=\"game-score\">${awayScore} - ${homeScore}</span>\n        </div>\n        <div class=\"market-buttons\">\n          ${Object.entries(PREDICTION_TYPES)\n            .map(([type, info]) => `\n              <button class=\"market-btn\" data-game-id=\"${gameId}\" data-type=\"${type}\">\n                <span class=\"market-icon\">${info.icon}</span>\n                <span class=\"market-name\">${info.name}</span>\n              </button>\n            `)\n            .join('')}\n        </div>\n      </div>\n    `;\n  }\n\n  selectMarket(gameId, type) {\n    const game = this.activeGames.get(gameId);\n    if (!game) return;\n\n    this.selectedMarket = { gameId, type, game };\n    this.showForm(game, type);\n  }\n\n  showForm(game, type) {\n    const form = this.panel.querySelector('#predictionForm');\n    if (!form) return;\n\n    const typeInfo = PREDICTION_TYPES[type];\n    form.querySelector('.form-market-type').textContent = typeInfo.name;\n\n    // Generate options based on type\n    const optionsContainer = form.querySelector('#predictionOptions');\n    const options = this.generateOptions(game, type);\n\n    optionsContainer.innerHTML = options\n      .map((opt) => `\n        <button\n          class=\"prediction-option\"\n          data-choice=\"${opt.choice}\"\n          data-odds=\"${opt.odds}\"\n        >\n          <span class=\"option-label\">${opt.label}</span>\n          <span class=\"option-odds\">${formatMultiplier(opt.odds)}</span>\n        </button>\n      `)\n      .join('');\n\n    form.hidden = false;\n    this.updatePayout();\n  }\n\n  closeForm() {\n    const form = this.panel.querySelector('#predictionForm');\n    if (form) form.hidden = true;\n    this.selectedMarket = null;\n  }\n\n  generateOptions(game, type) {\n    const { homeTeam, awayTeam, homeScore, awayScore, winProbability, league } = game;\n\n    switch (type) {\n      case 'next_score': {\n        const odds = getNextScoreOdds(winProbability, 0);\n        return [\n          { choice: 'home', label: homeTeam.abbreviation, odds: odds.home },\n          { choice: 'away', label: awayTeam.abbreviation, odds: odds.away },\n        ];\n      }\n\n      case 'game_outcome': {\n        const odds = getGameOutcomeOdds(winProbability);\n        return [\n          { choice: 'home', label: `${homeTeam.abbreviation} Win`, odds: odds.home },\n          { choice: 'away', label: `${awayTeam.abbreviation} Win`, odds: odds.away },\n        ];\n      }\n\n      case 'over_under': {\n        const total = homeScore + awayScore;\n        const odds = getOverUnderOdds(total, 5, league); // Assume mid-game\n        return [\n          { choice: `over_${odds.target}`, label: `Over ${odds.target}`, odds: odds.over },\n          { choice: `under_${odds.target}`, label: `Under ${odds.target}`, odds: odds.under },\n        ];\n      }\n\n      case 'first_to_score': {\n        const odds = getNextScoreOdds(winProbability, 0);\n        return [\n          { choice: 'home', label: homeTeam.abbreviation, odds: odds.home },\n          { choice: 'away', label: awayTeam.abbreviation, odds: odds.away },\n        ];\n      }\n\n      default:\n        return [];\n    }\n  }\n\n  selectOption(choice) {\n    const options = this.panel.querySelectorAll('.prediction-option');\n    options.forEach((opt) => {\n      opt.classList.toggle('selected', opt.dataset.choice === choice);\n    });\n\n    const submitBtn = this.panel.querySelector('.prediction-submit');\n    if (submitBtn) submitBtn.disabled = false;\n\n    this.updatePayout();\n  }\n\n  updatePayout() {\n    const selected = this.panel.querySelector('.prediction-option.selected');\n    const payoutEl = this.panel.querySelector('#potentialPayout');\n    if (!selected || !payoutEl) return;\n\n    const odds = parseFloat(selected.dataset.odds);\n    const payout = calculatePayout(this.stakeAmount, odds);\n    payoutEl.textContent = payout.toString();\n  }\n\n  submitPrediction() {\n    if (!this.selectedMarket) return;\n\n    const selected = this.panel.querySelector('.prediction-option.selected');\n    if (!selected) return;\n\n    const { gameId, type, game } = this.selectedMarket;\n    const choice = selected.dataset.choice;\n    const odds = parseFloat(selected.dataset.odds);\n\n    const result = predictionManager.placePrediction({\n      gameId,\n      type,\n      choice,\n      stake: this.stakeAmount,\n      odds,\n      gameContext: {\n        homeTeam: game.homeTeam.abbreviation,\n        awayTeam: game.awayTeam.abbreviation,\n        homeScore: game.homeScore,\n        awayScore: game.awayScore,\n        league: game.league,\n      },\n    });\n\n    if (result.success) {\n      this.closeForm();\n    } else {\n      alert(result.error);\n    }\n  }\n\n  updateBalance(gold) {\n    const balanceEl = document.getElementById('predictionBalance');\n    if (balanceEl) {\n      balanceEl.textContent = `${gold} gold`;\n    }\n  }\n\n  updatePendingList(predictions) {\n    const container = this.panel.querySelector('#pendingList');\n    if (!container) return;\n\n    if (predictions.length === 0) {\n      container.innerHTML = '<div class=\"empty-hint\">No active predictions</div>';\n      return;\n    }\n\n    container.innerHTML = predictions\n      .map((p) => `\n        <div class=\"pending-item\">\n          <div class=\"pending-info\">\n            <span class=\"pending-type\">${PREDICTION_TYPES[p.type]?.name || p.type}</span>\n            <span class=\"pending-choice\">${p.choice}</span>\n          </div>\n          <div class=\"pending-stake\">${p.stake} @ ${formatMultiplier(p.odds)}</div>\n        </div>\n      `)\n      .join('');\n  }\n\n  updateHistoryList(predictions) {\n    const container = this.panel.querySelector('#historyList');\n    if (!container) return;\n\n    const recent = predictions\n      .sort((a, b) => (b.resolvedAt || 0) - (a.resolvedAt || 0))\n      .slice(0, 5);\n\n    if (recent.length === 0) {\n      container.innerHTML = '<div class=\"empty-hint\">No history yet</div>';\n      return;\n    }\n\n    container.innerHTML = recent\n      .map((p) => `\n        <div class=\"history-item history-${p.status}\">\n          <div class=\"history-info\">\n            <span class=\"history-type\">${PREDICTION_TYPES[p.type]?.name || p.type}</span>\n            <span class=\"history-result\">${p.status.toUpperCase()}</span>\n          </div>\n          <div class=\"history-amount\">\n            ${p.status === 'won' ? `+${p.potentialPayout - p.stake}` : `-${p.stake}`}\n          </div>\n        </div>\n      `)\n      .join('');\n  }\n\n  updateStats() {\n    const stats = predictionManager.getStats();\n\n    const winRateEl = this.panel.querySelector('#statWinRate');\n    if (winRateEl) winRateEl.textContent = `${stats.winRate.toFixed(0)}%`;\n\n    const profitEl = this.panel.querySelector('#statProfit');\n    if (profitEl) {\n      profitEl.textContent = stats.profit >= 0 ? `+${stats.profit}` : stats.profit.toString();\n      profitEl.classList.toggle('positive', stats.profit > 0);\n      profitEl.classList.toggle('negative', stats.profit < 0);\n    }\n  }\n}\n\n/**\n * Initialize prediction UI.\n * @param {HTMLElement} panel\n * @param {HTMLElement} toggleBtn\n * @returns {PredictionUI}\n */\nexport function initPredictionUI(panel, toggleBtn) {\n  return new PredictionUI(panel, toggleBtn);\n}\n","/**\n * BlazeCraft main entry point.\n *\n * Integrates:\n * - Three.js 3D scene (main viewport)\n * - 2D canvas (minimap)\n * - Asset loading with priority queue\n * - WebSocket event bridge to Claude Code\n * - CityManager for building progression\n */\nimport * as THREE from 'three';\nimport { GameState } from './game-state.js';\nimport { Renderer } from './renderer.js';\nimport { UIPanels } from './ui-panels.js';\nimport { MockBridge } from './mock-data.js';\nimport { CommandCenter } from './commands.js';\nimport { clamp } from './map.js';\nimport { CityManager } from './buildings.js';\nimport { initScene, createRenderLoop, handleResize, toggleGrid, screenToWorld, initEnhancements } from './renderer3d.js';\nimport { MascotController } from './mascot-controller.js';\nimport { assetLoader } from './asset-loader.js';\nimport { Building3DManager } from './building-3d.js';\nimport { Worker3DManager } from './worker-3d.js';\nimport { eventBridge } from './real-bridge.js';\nimport { GameBridge, transformToGameEvent } from './game-bridge.js';\nimport { factionSystem } from './faction-system.js';\nimport { showFactionSelector } from './faction-selector.js';\nimport { predictionManager } from './predictions/prediction-manager.js';\nimport { initPredictionUI } from './predictions/prediction-ui.js';\n\n/** @type {boolean} Use 3D renderer (true) or 2D fallback (false) */\nlet use3D = true;\n\nasync function init() {\n  const state = new GameState();\n\n  // Loading screen elements\n  const loading = document.getElementById('loading');\n  const loadingFill = loading?.querySelector('.loading-fill');\n  const loadingText = loading?.querySelector('.loading-text');\n\n  const updateLoading = (progress, text) => {\n    if (loadingFill) loadingFill.style.width = `${Math.round(progress * 100)}%`;\n    if (loadingText && text) loadingText.textContent = text;\n  };\n\n  const mapCanvas = /** @type {HTMLCanvasElement} */ (document.getElementById('mapCanvas'));\n  const minimapCanvas = /** @type {HTMLCanvasElement} */ (document.getElementById('minimapCanvas'));\n\n  // Three.js scene (if enabled) - MUST init before 2D to avoid context conflict\n  let scene3d = null;\n  let building3dManager = null;\n  let worker3dManager = null;\n  let stopRenderLoop = null;\n\n  if (use3D) {\n    try {\n      updateLoading(0.1, 'Initializing 3D scene...');\n      scene3d = initScene(mapCanvas);\n\n      // Asset loader progress callback\n      assetLoader.onProgress = (loaded, total) => {\n        const progress = 0.15 + (loaded / total) * 0.4;\n        updateLoading(progress, `Loading models (${loaded}/${total})...`);\n      };\n\n      updateLoading(0.2, 'Loading 3D models...');\n      await assetLoader.preloadByPriority(2); // Priority 1-2 on startup\n    } catch (err) {\n      console.warn('3D init failed, falling back to 2D:', err);\n      use3D = false;\n    }\n  }\n\n  // Initialize 2D renderer (for minimap, and main canvas if 3D failed)\n  updateLoading(0.6, 'Initializing 2D renderer...');\n  const renderer2d = new Renderer(use3D ? null : mapCanvas, minimapCanvas);\n\n  updateLoading(0.65, 'Loading 2D textures...');\n  await renderer2d.loadTextures((p) => {\n    updateLoading(0.65 + p * 0.1, 'Loading 2D assets...');\n  });\n\n  // Initialize city building system\n  updateLoading(0.75, 'Building city...');\n  const cityManager = new CityManager(660, 370);\n  renderer2d.setCityManager(cityManager);\n\n  // Continue 3D setup if initialized\n  if (use3D && scene3d) {\n    try {\n      updateLoading(0.8, 'Setting up building manager...');\n      building3dManager = new Building3DManager(scene3d.scene);\n\n      // Initial sync with CityManager\n      await building3dManager.sync(cityManager.getAllBuildings());\n\n      updateLoading(0.85, 'Setting up worker manager...');\n      worker3dManager = new Worker3DManager(scene3d.scene);\n\n      updateLoading(0.9, 'Loading lighting and VFX...');\n      await initEnhancements(scene3d);\n    } catch (err) {\n      console.warn('3D setup failed:', err);\n      // Keep use3D true since scene initialized, just missing some features\n    }\n  }\n\n  // Initialize mascot controller (Blaze portrait)\n  const portraitPanel = document.getElementById('portraitPanel');\n  let mascotController = null;\n  if (portraitPanel) {\n    mascotController = new MascotController(portraitPanel);\n    await MascotController.preloadImages();\n  }\n\n  // Connect to event bridge (real Claude Code events)\n  updateLoading(0.9, 'Connecting to Claude Code...');\n  eventBridge.connect();\n\n  // Initialize prediction UI\n  const predictionPanel = document.getElementById('predictionPanel');\n  const predictionToggle = document.getElementById('togglePredictions');\n  let predictionUI = null;\n  if (predictionPanel && predictionToggle) {\n    predictionUI = initPredictionUI(predictionPanel, predictionToggle);\n  }\n\n  // Initialize BSI GameBridge for sports data\n  const gameBridge = new GameBridge({\n    endpoint: '/api/gamebridge/stream',\n    mode: 'spectator',\n    demo: true,  // Start in demo mode with SimFeed\n    onEvent: (event) => {\n      // Transform BSI event to game event format\n      const gameEvent = transformToGameEvent(event);\n      state.pushEvent(gameEvent);\n\n      // Update prediction UI with game events\n      if (predictionUI) {\n        predictionUI.updateFromEvent(event);\n      }\n\n      // Resolve predictions based on game events\n      predictionManager.handleEvent(event);\n\n      // Update scout report with live game info\n      if (event.type === 'WORLD_TICK') {\n        const liveCount = event.payload?.liveGames || 0;\n        state.pushScoutLine(liveCount > 0\n          ? `${liveCount} live game${liveCount === 1 ? '' : 's'} in progress.`\n          : 'No live games. SimFeed generating events.');\n      } else if (event.type === 'GAME_START' && event.gameContext) {\n        state.pushScoutLine(`Game started: ${event.gameContext.awayTeam?.name} @ ${event.gameContext.homeTeam?.name}`);\n      } else if (event.type === 'INJURY_ALERT') {\n        state.pushScoutLine(`Alert: ${event.payload?.playerName} injury (${event.payload?.severity})`);\n      }\n    },\n    onStats: (stats) => {\n      // Update city from BSI events\n      cityManager.updateProgress(stats);\n\n      // Sync 3D buildings\n      if (building3dManager) {\n        building3dManager.sync(cityManager.getAllBuildings());\n      }\n    },\n    onConnection: (connected) => {\n      const bridgeStatus = document.getElementById('bridgeStatus');\n      if (bridgeStatus) {\n        bridgeStatus.textContent = connected ? 'BSI Live' : 'BSI Demo';\n        bridgeStatus.classList.toggle('tag-live', connected);\n      }\n\n      // Handle prediction manager connection state\n      if (connected) {\n        predictionManager.handleReconnect();\n      } else {\n        predictionManager.handleDisconnect();\n      }\n    },\n    onError: (err) => {\n      console.warn('[GameBridge] Error:', err.message);\n    },\n  });\n\n  // Also start mock bridge for demo mode\n  const mockBridge = new MockBridge(state);\n  const commands = new CommandCenter(state, mockBridge);\n  const ui = new UIPanels(state, renderer2d);\n\n  updateLoading(1.0, 'Ready!');\n\n  // Hide loading screen\n  setTimeout(() => {\n    if (loading) loading.classList.add('hidden');\n  }, 300);\n\n  // Event bridge listener - merge real events into game state\n  eventBridge.onStats((stats) => {\n    // Update city from real events\n    cityManager.updateProgress(stats);\n\n    // Sync 3D buildings\n    if (building3dManager) {\n      building3dManager.sync(cityManager.getAllBuildings());\n    }\n  });\n\n  eventBridge.onConnection((connected) => {\n    const statusEl = document.getElementById('logStatus');\n    if (statusEl) {\n      statusEl.textContent = connected ? 'Live' : 'Demo';\n      statusEl.classList.toggle('tag-live', connected);\n    }\n  });\n\n  // State change handler\n  state.subscribe(() => {\n    ui.render();\n    // Update from mock events (demo mode)\n    cityManager.updateProgress(state.getEventStats());\n\n    // Update mascot based on selected workers\n    if (mascotController) {\n      const selectedWorkers = state.getSelectedWorkers();\n      mascotController.updateFromWorkers(selectedWorkers);\n    }\n  });\n\n  // Log panel toggle\n  const toggleLog = document.getElementById('toggleLog');\n  toggleLog?.addEventListener('click', () => {\n    const collapsed = document.body.classList.toggle('log-collapsed');\n    toggleLog.setAttribute('aria-pressed', String(!collapsed));\n  });\n\n  // Demo mode toggle\n  let demoOn = true;\n  const toggleDemo = document.getElementById('toggleDemo');\n  toggleDemo?.addEventListener('click', async () => {\n    demoOn = !demoOn;\n    toggleDemo.setAttribute('aria-pressed', String(demoOn));\n    if (demoOn) {\n      await mockBridge.connect();\n      state.pushScoutLine('Demo mode resumed. Workers rallying.');\n    } else {\n      mockBridge.disconnect();\n      state.setSelected([]);\n      for (const wid of Array.from(state.workers.keys())) state.removeWorker(wid);\n      state.events = [];\n      state.pushScoutLine('Demo mode paused. Listening for real events.');\n      state.notify();\n    }\n  });\n\n  // BSI GameBridge mode selector\n  const modeButtons = document.querySelectorAll('[data-bridge-mode]');\n  modeButtons.forEach((btn) => {\n    btn.addEventListener('click', () => {\n      const mode = btn.getAttribute('data-bridge-mode');\n      if (mode) {\n        gameBridge.setMode(mode);\n        // Update active state\n        modeButtons.forEach(b => b.classList.remove('active'));\n        btn.classList.add('active');\n        state.pushScoutLine(`Switched to ${mode} mode.`);\n      }\n    });\n  });\n\n  // BSI GameBridge demo toggle\n  const toggleBsiDemo = document.getElementById('toggleBsiDemo');\n  toggleBsiDemo?.addEventListener('click', () => {\n    const isDemo = gameBridge.demoMode;\n    gameBridge.setDemoMode(!isDemo);\n    toggleBsiDemo.setAttribute('aria-pressed', String(!isDemo));\n    state.pushScoutLine(isDemo ? 'BSI: Switching to live data...' : 'BSI: Switching to SimFeed...');\n  });\n\n  // Connect GameBridge\n  gameBridge.connect();\n\n  // Initialize faction system - show selector if no faction stored\n  if (!factionSystem.hasFaction()) {\n    const result = await showFactionSelector(document.body);\n    if (result.teamId && result.league) {\n      factionSystem.setFaction(result.teamId, result.league);\n      state.pushScoutLine(`Faction selected: ${result.teamId.split('-')[1]}`);\n    } else {\n      state.pushScoutLine('Playing without faction bonuses.');\n    }\n  } else {\n    const faction = factionSystem.getFaction();\n    if (faction) {\n      state.pushScoutLine(`Faction loaded: ${faction.teamId.split('-')[1]}`);\n    }\n  }\n\n  // Faction button handler\n  const factionBtn = document.getElementById('factionBtn');\n  factionBtn?.addEventListener('click', async () => {\n    const result = await showFactionSelector(document.body);\n    if (result.teamId && result.league) {\n      factionSystem.setFaction(result.teamId, result.league);\n      state.pushScoutLine(`Faction changed: ${result.teamId.split('-')[1]}`);\n      updateFactionIndicator();\n    }\n  });\n\n  // Update faction indicator in topbar\n  function updateFactionIndicator() {\n    const indicator = document.getElementById('factionIndicator');\n    if (!indicator) return;\n\n    const faction = factionSystem.getFaction();\n    if (faction) {\n      const abbr = faction.teamId.split('-')[1];\n      indicator.innerHTML = `<span class=\"faction-indicator-abbr\">${abbr}</span>`;\n      indicator.title = `Current faction: ${abbr}`;\n    } else {\n      indicator.innerHTML = '<span class=\"faction-indicator-empty\">No Faction</span>';\n      indicator.title = 'Click to select a faction';\n    }\n  }\n\n  updateFactionIndicator();\n  factionSystem.subscribe(() => updateFactionIndicator());\n\n  // Start demo\n  await mockBridge.connect();\n\n  // Input handling\n  setupInputHandlers(mapCanvas, minimapCanvas, renderer2d, scene3d, building3dManager, worker3dManager, state, commands);\n\n  // Keyboard shortcuts\n  setupKeyboardShortcuts(commands, scene3d);\n\n  // Render loop\n  if (use3D && scene3d) {\n    stopRenderLoop = createRenderLoop(scene3d, (delta) => {\n      const now = performance.now();\n\n      // Update building animations\n      if (building3dManager) {\n        building3dManager.update(delta, now);\n      }\n\n      // Sync and update 3D workers\n      if (worker3dManager) {\n        worker3dManager.sync(Array.from(state.workers.values()));\n        worker3dManager.update(delta, now);\n      }\n\n      // Render 2D layer (minimap only when 3D is active)\n      // Note: In 3D mode, Three.js handles main canvas; 2D renderer still updates minimap\n      renderer2d.render(state);\n    });\n  } else {\n    // 2D-only render loop\n    function frame() {\n      renderer2d.render(state);\n      requestAnimationFrame(frame);\n    }\n    requestAnimationFrame(frame);\n  }\n\n  // Initial camera position\n  renderer2d.camera.x = renderer2d.world.w / 2;\n  renderer2d.camera.y = renderer2d.world.h / 2;\n  clampCamera(renderer2d, mapCanvas);\n\n  // Window resize handler\n  window.addEventListener('resize', () => {\n    if (scene3d) {\n      handleResize(scene3d, mapCanvas.width, mapCanvas.height);\n    }\n  });\n\n  // Cleanup on page unload\n  window.addEventListener('beforeunload', () => {\n    eventBridge.disconnect();\n    gameBridge.disconnect();\n    mockBridge.disconnect();\n    if (stopRenderLoop) stopRenderLoop();\n    if (worker3dManager) worker3dManager.dispose();\n    if (building3dManager) building3dManager.dispose();\n    assetLoader.dispose();\n  });\n}\n\n/**\n * Set up input handlers for map interactions.\n */\nfunction setupInputHandlers(mapCanvas, minimapCanvas, renderer2d, scene3d, building3dManager, worker3dManager, state, commands) {\n  let isPanning = false;\n  let panStart = { x: 0, y: 0, cx: 0, cy: 0 };\n  let isSelecting = false;\n  let selectStart = { x: 0, y: 0 };\n\n  mapCanvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n  mapCanvas.addEventListener('mousedown', (e) => {\n    // Middle button: pan\n    if (e.button === 1) {\n      isPanning = true;\n      if (scene3d) {\n        panStart = { x: e.clientX, y: e.clientY, cx: 0, cy: 0 };\n      } else {\n        panStart = { x: e.clientX, y: e.clientY, cx: renderer2d.camera.x, cy: renderer2d.camera.y };\n      }\n      return;\n    }\n\n    // Right button: assign workers or context action\n    if (e.button === 2) {\n      if (!scene3d) {\n        const wpt = renderer2d.screenToWorld(e.clientX, e.clientY);\n        const region = renderer2d.regionAt(wpt.x, wpt.y);\n        if (region && state.selected.size) {\n          commands.assignSelectedTo(region);\n        }\n      }\n      return;\n    }\n\n    // Left button: select\n    if (e.button === 0) {\n      mapCanvas.focus();\n\n      // 3D building and worker selection\n      if (scene3d) {\n        const rect = mapCanvas.getBoundingClientRect();\n        const ndc = new THREE.Vector2(\n          ((e.clientX - rect.left) / rect.width) * 2 - 1,\n          -((e.clientY - rect.top) / rect.height) * 2 + 1\n        );\n        const raycaster = new THREE.Raycaster();\n        raycaster.setFromCamera(ndc, scene3d.camera);\n\n        // Try worker selection first (workers are smaller, harder to hit)\n        if (worker3dManager) {\n          const workerId = worker3dManager.raycast(raycaster);\n          if (workerId) {\n            state.setSelected([workerId]);\n            worker3dManager.select([workerId]);\n            commands.assignMode = false;\n            return;\n          }\n        }\n\n        // Then try building selection\n        if (building3dManager) {\n          const buildingId = building3dManager.raycast(raycaster);\n          if (buildingId) {\n            building3dManager.select(buildingId);\n            return;\n          }\n        }\n      }\n\n      // 2D worker selection (fallback when 3D is disabled)\n      const wpt = renderer2d.screenToWorld(e.clientX, e.clientY);\n      const hit = hitTestWorker(state, wpt.x, wpt.y);\n      if (hit) {\n        state.setSelected([hit.id]);\n        commands.assignMode = false;\n        renderer2d.setSelection(false, 0, 0, 0, 0);\n        return;\n      }\n\n      // Drag select\n      isSelecting = true;\n      selectStart = { x: wpt.x, y: wpt.y };\n      renderer2d.setSelection(true, wpt.x, wpt.y, wpt.x, wpt.y);\n    }\n  });\n\n  window.addEventListener('mousemove', (e) => {\n    if (isPanning && !scene3d) {\n      const dx = (e.clientX - panStart.x) / renderer2d.camera.zoom;\n      const dy = (e.clientY - panStart.y) / renderer2d.camera.zoom;\n      renderer2d.camera.x = panStart.cx - dx;\n      renderer2d.camera.y = panStart.cy - dy;\n      clampCamera(renderer2d, mapCanvas);\n    }\n\n    if (isSelecting) {\n      const wpt = renderer2d.screenToWorld(e.clientX, e.clientY);\n      renderer2d.setSelection(true, selectStart.x, selectStart.y, wpt.x, wpt.y);\n    }\n  });\n\n  window.addEventListener('mouseup', (e) => {\n    if (e.button === 1) isPanning = false;\n\n    if (e.button === 0 && isSelecting) {\n      isSelecting = false;\n      const r = renderer2d.selection;\n      const x0 = Math.min(r.x0, r.x1);\n      const y0 = Math.min(r.y0, r.y1);\n      const x1 = Math.max(r.x0, r.x1);\n      const y1 = Math.max(r.y0, r.y1);\n\n      const ids = [];\n      const positions = [];\n      for (const w of state.workers.values()) {\n        if (w.position.x >= x0 && w.position.x <= x1 && w.position.y >= y0 && w.position.y <= y1) {\n          ids.push(w.id);\n          positions.push({ x: w.position.x, y: w.position.y });\n        }\n      }\n      state.setSelected(ids);\n      renderer2d.setSelection(false, 0, 0, 0, 0);\n      if (positions.length > 0) {\n        renderer2d.spawnSelectionPulses(positions);\n      }\n    }\n  });\n\n  mapCanvas.addEventListener('wheel', (e) => {\n    e.preventDefault();\n\n    if (scene3d) {\n      // 3D zoom handled by OrbitControls\n      return;\n    }\n\n    const factor = e.deltaY < 0 ? 1.12 : 0.89;\n    const prev = renderer2d.camera.zoom;\n    const next = clamp(prev * factor, 0.7, 2.2);\n\n    const before = renderer2d.screenToWorld(e.clientX, e.clientY);\n    renderer2d.camera.zoom = next;\n    const after = renderer2d.screenToWorld(e.clientX, e.clientY);\n\n    renderer2d.camera.x += (before.x - after.x);\n    renderer2d.camera.y += (before.y - after.y);\n    clampCamera(renderer2d, mapCanvas);\n  }, { passive: false });\n\n  // Minimap navigation\n  minimapCanvas.addEventListener('mousedown', (e) => {\n    const wpt = renderer2d.minimapToWorld(e.clientX, e.clientY);\n    animateCameraTo(renderer2d, mapCanvas, wpt.x, wpt.y, 280);\n  });\n}\n\n/**\n * Set up keyboard shortcuts.\n */\nfunction setupKeyboardShortcuts(commands, scene3d) {\n  window.addEventListener('keydown', (e) => {\n    if (e.target && /** @type {HTMLElement} */ (e.target).tagName === 'INPUT') return;\n    const key = e.key.toLowerCase();\n\n    // Command shortcuts\n    if (key === 's') commands.exec('stop');\n    if (key === 'h') commands.exec('hold');\n    if (key === 'r') commands.exec('resume');\n    if (key === 'a') commands.exec('reassign');\n    if (key === 'i') commands.exec('inspect');\n    if (key === 'x') commands.exec('terminate');\n\n    // Debug: toggle grid\n    if (key === 'g' && scene3d) {\n      toggleGrid(scene3d.scene);\n    }\n  });\n\n  // Command card buttons\n  for (const b of Array.from(document.querySelectorAll('button.cmd[data-cmd]'))) {\n    b.addEventListener('click', () => {\n      const cmd = /** @type {any} */ (b.getAttribute('data-cmd'));\n      commands.exec(cmd);\n    });\n  }\n}\n\n/**\n * Hit test workers at world position.\n */\nfunction hitTestWorker(state, wx, wy) {\n  let best = null;\n  let bestD = 999999;\n  for (const w of state.workers.values()) {\n    const dx = w.position.x - wx;\n    const dy = w.position.y - wy;\n    const d = Math.hypot(dx, dy);\n    if (d < 14 && d < bestD) {\n      best = w;\n      bestD = d;\n    }\n  }\n  return best;\n}\n\n/**\n * Clamp camera to world bounds.\n */\nfunction clampCamera(renderer, mapCanvas) {\n  const { w, h } = renderer.world;\n  const mapRect = mapCanvas.getBoundingClientRect();\n  const viewW = mapRect.width / renderer.camera.zoom;\n  const viewH = mapRect.height / renderer.camera.zoom;\n\n  renderer.camera.x = clamp(renderer.camera.x, viewW / 2, w - viewW / 2);\n  renderer.camera.y = clamp(renderer.camera.y, viewH / 2, h - viewH / 2);\n}\n\n/**\n * Animate camera to target position.\n */\nlet cameraAnimId = null;\nfunction animateCameraTo(renderer, mapCanvas, targetX, targetY, durationMs = 300) {\n  if (cameraAnimId) {\n    cancelAnimationFrame(cameraAnimId);\n    cameraAnimId = null;\n  }\n\n  const startX = renderer.camera.x;\n  const startY = renderer.camera.y;\n  const startTime = performance.now();\n\n  function step(now) {\n    const t = Math.min(1, (now - startTime) / durationMs);\n    const ease = t * (2 - t);\n\n    renderer.camera.x = startX + (targetX - startX) * ease;\n    renderer.camera.y = startY + (targetY - startY) * ease;\n    clampCamera(renderer, mapCanvas);\n\n    if (t < 1) {\n      cameraAnimId = requestAnimationFrame(step);\n    } else {\n      cameraAnimId = null;\n    }\n  }\n  cameraAnimId = requestAnimationFrame(step);\n}\n\ninit();\n"],"names":["GameState","n","line","fn","evt","category","details","lower","worker","workerId","ids","out","id","w","tokens","formatDuration","ms","total","m","s","REGIONS","regionAt","x","y","r","b","randomPointIn","region","pad","clamp","v","lo","hi","DIRECTIONS","directionFromVector","dx","dy","angle","normalizedAngle","SpriteManager","loads","d","buildings","name","path","key","resolve","reject","img","direction","buildingType","tier","spriteName","drawWorkerSprite","ctx","sprites","options","scale","alpha","tint","bob","sprite","h","drawBuildingSprite","spriteManager","BUILDING_DEFS","CITY_LAYOUT","CityManager","centerX","centerY","type","layoutIndex","layout","def","now","building","eventStats","totalEvents","a","i","tier0","buildingId","eventCount","t","tierDef","constructed","maxTier","renderBuilding","tierIndex","constructionAlpha","bodyGradient","adjustBrightness","getBuildingIcon","barX","barY","pulse","hexToRgba","hex","amount","num","g","Renderer","mapCanvas","minimapCanvas","cityManager","onProgress","reportProgress","loaded","load","src","rect","mrect","mw","mh","clientX","clientY","sx","sy","cx","cy","wx","wy","active","x0","y0","x1","y1","kind","state","last","latest","p","g1","step","pat","palette","age","selected","vx","_a","vy","_b","tintColors","colors","pipColor","positions","pos","fog","bx","by","bw","bh","tierColors","wkr","col","mapRect","viewW","viewH","ICONS","el","UIPanels","renderer","list","idleOrBlocked","hasBlocked","pct","idx","div","items","icon","hh","mm","ss","stamp","escapeHtml","wid","str","TASK_DEFS","rnd","arr","pickRegion","weighted","formatInt","MockBridge","workerIds","goal","town","start","target","taskDef","bump","still","idle","blocked","msg","CommandCenter","bridge","cmd","sel","detail","_changeEvent","_startEvent","_endEvent","_ray","Ray","_plane","Plane","_TILT_LIMIT","MathUtils","_v","Vector3","_twoPI","_STATE","_EPS","OrbitControls","Controls","object","domElement","MOUSE","TOUCH","Quaternion","Spherical","Vector2","onPointerMove","onPointerDown","onPointerUp","onContextMenu","onMouseWheel","onKeyDown","onTouchStart","onTouchMove","onMouseDown","onMouseMove","interceptControlDown","interceptControlUp","deltaTime","position","min","max","zoomChanged","prevRadius","newRadius","radiusDelta","mouseBefore","prevZoom","mouseAfter","delta","normalizedDelta","distance","objectMatrix","deltaX","deltaY","element","targetDistance","dollyScale","dist","event","needsUpdate","pointerId","mode","newEvent","mouseAction","RGBELoader","DataTextureLoader","manager","HalfFloatType","buffer","rgbe_error","rgbe_error_code","fgets","lineLimit","consume","len","chunk","RGBE_ReadHeader","magic_token_re","gamma_re","exposure_re","format_re","dimensions_re","header","match","RGBE_ReadPixels_RLE","scanline_width","data_rgba","offset","ptr_end","rgbeStart","scanline_buffer","num_scanlines","ptr","count","isEncodedRun","byteValue","l","off","RGBEByteToRGBFloat","sourceArray","sourceOffset","destArray","destOffset","e","RGBEByteToRGBHalf","DataUtils","byteArray","rgbe_header_info","image_rgba_data","data","numElements","FloatType","floatArray","j","halfArray","value","url","onLoad","onError","onLoadCallback","texture","texData","LinearSRGBColorSpace","LinearFilter","HDRI_BASE","PRESETS","LightingPresets","scene","child","THREE.AmbientLight","THREE.DirectionalLight","promises","preset","err","THREE.EquirectangularReflectionMapping","presetName","hour","presetNames","nextIndex","SPRITES_BASE","SPRITE_SHEETS","VFXSystem","THREE.TextureLoader","config","THREE.RepeatWrapping","THREE.LinearFilter","effectName","onComplete","clonedTexture","material","THREE.SpriteMaterial","THREE.AdditiveBlending","THREE.Sprite","effect","currentFrame","row","deltaMs","toRemove","index","WORLD_WIDTH","WORLD_HEIGHT","CAMERA_ELEVATION","CAMERA_ROTATION","ZOOM_MIN","ZOOM_MAX","initScene","canvas","THREE.Scene","THREE.Color","groundGeom","THREE.PlaneGeometry","groundMat","THREE.MeshStandardMaterial","ground","THREE.Mesh","gridHelper","THREE.GridHelper","aspect","frustumSize","camera","THREE.OrthographicCamera","THREE.WebGLRenderer","THREE.PCFSoftShadowMap","THREE.ACESFilmicToneMapping","controls","THREE.MOUSE","THREE.TOUCH","setupLighting","THREE.FogExp2","lighting","vfx","initEnhancements","ambient","sun","fill","rim","hemi","THREE.HemisphereLight","handleResize","width","height","toggleGrid","grid","createRenderLoop","onUpdate","clock","THREE.Clock","running","animate","PORTRAITS_BASE","PORTRAIT_STATES","MascotController","portraitElement","frame","portrait","status","workers","hasError","hasWorking","hasComplete","toTrianglesDrawMode","geometry","drawMode","TrianglesDrawMode","TriangleFanDrawMode","TriangleStripDrawMode","indices","numberOfTriangles","newIndices","newGeometry","GLTFLoader","Loader","parser","GLTFMaterialsClearcoatExtension","GLTFMaterialsDispersionExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFTextureAVIFExtension","GLTFMaterialsSheenExtension","GLTFMaterialsTransmissionExtension","GLTFMaterialsVolumeExtension","GLTFMaterialsIorExtension","GLTFMaterialsEmissiveStrengthExtension","GLTFMaterialsSpecularExtension","GLTFMaterialsIridescenceExtension","GLTFMaterialsAnisotropyExtension","GLTFMaterialsBumpExtension","GLTFLightsExtension","GLTFMeshoptCompression","GLTFMeshGpuInstancing","scope","resourcePath","relativeUrl","LoaderUtils","_onError","loader","FileLoader","gltf","dracoLoader","ktx2Loader","meshoptDecoder","callback","json","extensions","plugins","textDecoder","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","GLTFBinaryExtension","error","GLTFParser","plugin","extensionName","extensionsRequired","GLTFMaterialsUnlitExtension","GLTFDracoMeshCompressionExtension","GLTFTextureTransformExtension","GLTFMeshQuantizationExtension","GLTFRegistry","objects","nodeDefs","nodeIndex","nodeLength","nodeDef","lightIndex","cacheKey","dependency","lightDef","lightNode","color","Color","range","DirectionalLight","PointLight","SpotLight","assignExtrasToUserData","self","light","MeshBasicMaterial","materialParams","materialDef","pending","metallicRoughness","array","SRGBColorSpace","materialIndex","emissiveStrength","MeshPhysicalMaterial","extension","colorFactor","colorArray","textureIndex","textureDef","source","handler","isSupported","image","bufferView","extensionDef","decoder","res","byteOffset","byteLength","stride","result","meshDef","primitive","WEBGL_CONSTANTS","attributesDef","attributes","accessor","results","nodeObject","meshes","instancedMeshes","mesh","Matrix4","q","instancedMesh","InstancedMesh","attributeName","attr","InstancedBufferAttribute","Object3D","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","headerView","chunkContentsLength","chunkView","chunkIndex","chunkLength","chunkType","contentArray","bufferViewIndex","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","threeAttributeName","ATTRIBUTES","accessorDef","componentType","WEBGL_COMPONENT_TYPES","attribute","normalized","transform","GLTFCubicSplineInterpolant","Interpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","values","valueSize","i1","t0","t1","stride2","stride3","td","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","_q","GLTFCubicSplineQuaternionInterpolant","WEBGL_FILTERS","NearestFilter","NearestMipmapNearestFilter","LinearMipmapNearestFilter","NearestMipmapLinearFilter","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","ClampToEdgeWrapping","MirroredRepeatWrapping","RepeatWrapping","WEBGL_TYPE_SIZES","PATH_PROPERTIES","INTERPOLATION","InterpolateLinear","InterpolateDiscrete","ALPHA_MODES","createDefaultMaterial","cache","MeshStandardMaterial","FrontSide","addUnknownExtensionsToUserData","knownExtensions","objectDef","gltfDef","addMorphTargets","targets","hasMorphPosition","hasMorphNormal","hasMorphColor","il","pendingPositionAccessors","pendingNormalAccessors","pendingColorAccessors","pendingAccessor","accessors","morphPositions","morphNormals","morphColors","updateMorphTargets","targetNames","createPrimitiveKey","primitiveDef","geometryKey","dracoExtension","createAttributesKey","attributesKey","keys","getNormalizedComponentScale","constructor","getImageURIMimeType","uri","_identityMatrix","isSafari","safariVersion","isFirefox","firefoxVersion","userAgent","safariMatch","TextureLoader","ImageBitmapLoader","ext","dependencies","skinDefs","meshDefs","skinIndex","skinLength","joints","ref","updateMappings","original","clone","mappings","func","defs","bufferIndex","bufferDef","bufferViewDef","accessorIndex","itemSize","TypedArray","BufferAttribute","pendingBufferViews","bufferViews","elementBytes","itemBytes","byteStride","bufferAttribute","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","sourceIndex","sourceDef","promise","sampler","URL","sourceURI","isObjectURL","blob","imageBitmap","Texture","mapName","mapDef","colorSpace","gltfReference","useDerivativeTangents","useVertexColors","useFlatShading","pointsMaterial","PointsMaterial","Material","lineMaterial","LineBasicMaterial","cachedMaterial","materialType","materialExtensions","kmuExtension","DoubleSide","alphaMode","emissiveFactor","originalName","sanitizedName","PropertyBinding","primitives","createDracoPrimitive","addPrimitiveAttributes","cached","geometryPromise","BufferGeometry","meshIndex","materials","geometries","SkinnedMesh","Mesh","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","cameraDef","params","PerspectiveCamera","OrthographicCamera","skinDef","inverseBindMatrices","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","animationIndex","animationDef","animationName","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channel","input","output","nodes","inputAccessors","outputAccessors","samplers","tracks","node","inputAccessor","outputAccessor","createdTracks","k","AnimationClip","o","nodePending","childPending","childrenDef","skeletonPending","children","skeleton","nodeName","meshPromise","Bone","matrix","sceneIndex","sceneDef","nodeIds","reduceAssociations","reducedAssociations","targetName","TypedKeyframeTrack","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","interpolation","outputArray","jl","track","scaled","interpolantType","computeBounds","box","Box3","boxScale","maxDisplacement","vector","sphere","Sphere","assignAttributeAccessor","gltfAttributeName","ColorManagement","_taskCache","DRACOLoader","workerLimit","attributeIDs","attributeTypes","vertexColorSpace","taskConfig","taskKey","cachedTask","taskID","taskCost","geometryPending","_worker","message","geometryData","inputColorSpace","_color","responseType","useJS","librariesPending","libraries","jsContent","DRACOWorker","body","decoderConfig","decoderPending","draco","module","decodeGeometry","buffers","dracoGeometry","decodingStatus","geometryType","attributeType","attributeID","attributeResult","decodeAttribute","decodeIndex","numIndices","numComponents","numValues","dataType","getDracoDataType","MODELS_BASE","DRACO_PATH","ASSET_MANIFEST","AssetLoader","manifest","asset","model","maxPriority","toLoad","assets","info","batchSize","batch","item","assetLoader","BUILDING_TO_ASSET","BUILDING_SCALES","CANVAS_TO_WORLD_SCALE","CANVAS_CENTER_X","CANVAS_CENTER_Y","Building3DManager","THREE.BufferGeometry","THREE.PointsMaterial","THREE.Points","THREE.RingGeometry","THREE.MeshBasicMaterial","THREE.DoubleSide","ring","canvasPos","currentIds","existing","prevState","progress","assetKey","stage","placeholder","worldPos","tierScale","depth","THREE.BoxGeometry","THREE.Group","raycaster","meshArray","intersects","intersect","obj","THREE.Material","DEBUG","STATUS_COLORS","LERP_SPEED","WORKER_SCALE","Worker3DManager","axes","THREE.AxesHelper","z","marker","THREE.SphereGeometry","loadPromises","hash","posData","modelType","THREE.Vector3","statusColor","baseGeom","THREE.CylinderGeometry","baseMat","base","bodyGeom","bodyMat","cockpitGeom","cockpitMat","cockpit","arrowShape","THREE.Shape","arrowGeom","THREE.ShapeGeometry","arrowMat","arrow","lightGeom","lightMat","isTerminated","lerpFactor","dz","ringPulse","WS_URL","RECONNECT_DELAY","MAX_RECONNECT_ATTEMPTS","EventBridge","delay","listener","stats","connected","eventBridge","STORAGE_KEY","DEFAULT_MODIFIERS","TRAITS","mods","FactionSystem","teamId","league","selection","trait","modified","duration","rate","faction","stored","factionSystem","DEFAULT_ENDPOINT","RECONNECT_BASE_DELAY","MAX_RECONNECT_DELAY","EVENT_STAT_MAP","GameBridge","eventTypes","leagues","demo","fullEvent","transformToGameEvent","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","_m","_n","_o","_p","_r","_s","_t","TEAMS","LEAGUE_NAMES","FactionSelector","container","onSelect","onSkip","team","tab","teamBtn","actionBtn","action","isActive","confirmBtn","isSelected","mockStats","modifiers","traits","preview","formatters","baseStats","showFactionSelector","PREDICTION_TYPES","STAKE_CONFIG","STORAGE_KEYS","DISCONNECT_GRACE_MS","createWallet","generatePredictionId","HOUSE_EDGE","calculateOdds","probability","fairOdds","getNextScoreOdds","homeWinProb","momentum","homePct","momentumFactor","neitherPct","awayPct","adjustedHomePct","getGameOutcomeOdds","getOverUnderOdds","currentTotal","period","avgScoring","getLeagueAverageScoring","periodsRemaining","getPeriodsRemaining","expectedRemaining","getTotalPeriods","calculatePayout","stake","odds","formatMultiplier","currentPeriod","PredictionManager","gameId","choice","gameContext","prediction","relevantPredictions","prevContext","currContext","payload","homeScored","awayScored","homeWon","overUnder","predictionId","disconnectDuration","pendingPredictions","limit","resolved","wins","losses","predictions","predictionManager","PredictionUI","panel","toggleBtn","wallet","stakeInput","btn","marketBtn","optionBtn","homeTeam","awayTeam","game","homeScore","awayScore","form","typeInfo","optionsContainer","opt","winProbability","submitBtn","payoutEl","payout","gold","balanceEl","recent","winRateEl","profitEl","initPredictionUI","use3D","init","loading","loadingFill","loadingText","updateLoading","text","scene3d","building3dManager","worker3dManager","stopRenderLoop","renderer2d","portraitPanel","mascotController","predictionPanel","predictionToggle","predictionUI","gameBridge","gameEvent","liveCount","bridgeStatus","mockBridge","commands","ui","statusEl","selectedWorkers","toggleLog","collapsed","demoOn","toggleDemo","modeButtons","toggleBsiDemo","isDemo","factionBtn","updateFactionIndicator","indicator","abbr","setupInputHandlers","setupKeyboardShortcuts","clampCamera","isPanning","panStart","isSelecting","selectStart","wpt","ndc","THREE.Vector2","THREE.Raycaster","hit","hitTestWorker","factor","prev","next","before","after","animateCameraTo","best","bestD","cameraAnimId","targetX","targetY","durationMs","startX","startY","startTime","ease"],"mappings":"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","x_google_ignoreList":[8,9,14,15,16]}